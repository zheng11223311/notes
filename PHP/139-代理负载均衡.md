### 1.代理负载均衡(反向代理)

有时候,直接访问某个网站会出现无法访问,因为访问被防火墙拦截

解决方法:代理

我们访问代理的服务器,代理的服务器访问某个网站,将数据返回给我们,这样就可以绕过防火墙

**代理负载均衡(反向代理)**

比如谷歌有很多台服务器,这些服务器都由一台服务器(代理负载均衡)来分配请求到不同的服务器 

C -> S(负载均衡) ->s1.....

**1,准备工作:**

三台服务器,至少要有LNMP 或LAMP 架构

S 192.168.254.101     Nginx  (负载均衡服务)

S1 192.168.254.102	Apache 网站解析

S2 192.168.254.103	Apache 	网站解析

克隆Linux ,建立多个服务器

在虚拟机中选择虚拟机->克隆   (克隆之后要修改IP地址)

```
vim /etc/sysconfig/network-scripts/ifcfg-eth0     //网卡的信息文件
删除
HWADDR =00:0c:29:16:ad:73     //物理(硬件)地址

cd /etc/udev/rules.d/
删除
70-persistent-net.rules 文件
重启服务,才可以设置ip,因为克隆之后ip 与设备是绑定的,不能设置ip
reboot 

```

**2.配置S nginx 配置文件**

```
cd /usr/local/nginx/conf/
vim nginx.conf

在server {}  上添加
upstream myweb1{			//upstream 定义地址池,myweb1 地址池名字,因为客户端访问服务器,而服务器
由多态服务器组成
	server 192.168.254.102:80;		//添加ip 地址
	server 192.168.254.103:80;
}

server {			
	listen 80;
	server_name www/sohu.com;
	location /{     //location 使用前面的地址池
		proxy_pass http://myweb1;  //使用前面的地址池
		proxy_next_upstream http_500 http_502 http_503 error timeout invalid_header;  //故障转移,当被访问的服务器出现故障时,返回信息给代理服务器,下次请求服务器时,跳过故障服务器,http_502 等为故障代码
		proxy_set_header Host $host;    //传递域名,向后面的服务器写传递解析客户端访问的域名
		proxy_set_header  x-Forworded-For $remote_addr;		//传递客户端的ip 地址,便于服务器记录客户端的ip 地址,而不是代理的ip 地址
	}
}
```

**3.设置S1 服务器 要求正常访问,关闭虚拟机不必要的功能**

```
vim /usr/local/apache2/htdocs/index.html		//写入任意内容
```

**4.设置S2 服务器 要求正常访问,关闭虚拟机不必要的功能**

```
vim /usr/local/apache2/htdocs/index.html		//写入任意内容
```

**5.重启S Nginx 服务器 测试**

```
pkill -HUP nginx

测试 输入www.sohu.com   访问到s1 服务器,在刷新时访问到s2 服务器,再次刷新访问到s1 服务器.....一直循环切换
```

