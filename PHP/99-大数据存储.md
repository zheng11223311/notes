### 1.大数据存储

**数据库中创建一个二进制图像字段**

```sql
ALTER TABLE `newuser` CHANGE `img` `img`  LONGBLOB NOT NULL COMMENT '二进制图像';	-- 这里是再原来的img 上修改类型, LONGBLOB 大二进制数据,最大4G,过小图片无法存入进去
-- 创建图片类型字段
ALTER TABLE `newuser` ADD `type` VARCHAR(12) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '图片类型' AFTER `img`;
```

BLOB类型有以下四种，除存储的最大信息量不同外，其他都是一样的

| BLOB类型   | 可存储文件大小 |
| ---------- | -------------- |
| TinyBlob   | 最大 255B      |
| Blob       | 最大 65K       |
| MediumBlob | 最大 16M       |
| LongBlob   | 最大 4G        |

**存入图片数据**

```php
<?php
try {
    $dsn='mysql:host=localhost;dbname=lmonkey;charset=utf8';
    $pdo=new PDO($dsn,'root','');
    // 类型
    $type='image/png';
    // 图片
    $img=file_get_contents('./img/1.png');
    var_dump($img); 
    // $result1=$pdo->exec("INSERT INTO newuser(img,type) VALUES ('{$img}','{$type}')");
    // 打印PDO 的错误信息
    // var_dump($pdo->errorInfo()); 不是字符串.乱码文字

    // 预处理的方式插入数据,将整个数据作为字符串写入
    $stmt=$pdo->prepare("INSERT INTO newuser(img,type) VALUES (?,?)");

    // 执行
    $stmt->bindParam(1,$img);
    $stmt->bindParam(2,$type);
      $stmt->execute();
    //   执行方式2,直接再数组中写值
    // 数组中的所有的值都当做字符串处理
    // $stmt->execute(array());
    if($stmt->rowCount()){
        echo '成功';
    }else{
        echo '失败';
    }
} catch (PDOException $e) {
    echo $e->getMessage();
}

?>
```

**从数据库中获取图片数据并显示**

```php
<?php
try {
    $dsn='mysql:host=localhost;dbname=lmonkey;charset=utf8';
    $pdo=new PDO($dsn,'root','');
    // 预处理的方式插入数据,将整个数据作为字符串写入
    $stmt=$pdo->prepare("SELECT * FROM newuser");
    // 执行
      $stmt->execute();
    if($stmt->rowCount()){
        // echo '成功';
        $row=$stmt->fetchAll(PDO::FETCH_ASSOC);
        // var_dump($row);
              header('Content-type:image/png');
            //   echo输出 时,前面不能有其他字符的输出,比如echo '成功';,会当成图片的字节,而无法输出完整的图片
              echo $row[5]['img'];      //输出图片,显示图片
    }else{
        echo '失败';
    }
} catch (PDOException $e) {
    echo $e->getMessage();
}

?>
```

