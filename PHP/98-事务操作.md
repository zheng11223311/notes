### 1.事务操作

MySQL 默认myisam 快速存储引擎,事务操作需要使用innodb 引擎

```php
<?php
try {
    $dsn='mysql:host=localhost;dbname=lmonkey;charset=utf8';
    $pdo=new PDO($dsn,'root','');
     // 设置自动提交=>0
    //  要先设置为手动提交再执行SQL 操作
    $pdo->setAttribute(PDO::ATTR_AUTOCOMMIT,false); 
    // echo $pdo->getAttribute(PDO::ATTR_AUTOCOMMIT); 
    // 汇款操作(事务处理需要关闭自动提交,设置为false,即0,也表示手动提交)
    // 需要等到扣钱和加钱都操作成功,才提交修改(即手动提交),否者
    // ,如果中间有断电等终止行为(或者一方SQL 语句操作错误),会有一方没有执行添加,或者扣钱操作

    // 启动事务 Transaction =>事务
    // 开启自动提交,没有开启事务也会修改数据,但是会报错There is no active transaction
    $pdo->beginTransaction();
    // 扣钱操作
    $result=$pdo->exec("UPDATE newuser SET price =price-1000 WHERE name='laogao'");
    // 加钱操作
    $result1=$pdo->exec("UPDATE newuser SET price =price+1000 WHERE name='xiaogao'");
    // echo  $result;  //1
    // echo  $result1; #1
    if($result&&$result1){
        echo '成功';
        // 提交事务(确定去更改)
        $pdo->commit();

    }else{
        // 两个操作中没有都执行完成,不进行修改数据
        echo '失败';
        // 回滚事务,回滚到原来的状态
        $pdo->rollback();

    }
    // 都操作成功后,开启自动提交,不自动开启也行,下次运行会自动开启,因为mysql自动提交默认是开启的
    $pdo->setAttribute(PDO::ATTR_AUTOCOMMIT,true); 
    // echo $pdo->getAttribute(PDO::ATTR_AUTOCOMMIT); 
} catch (PDOException $e) {
    echo $e->getMessage();
}

?>
```

