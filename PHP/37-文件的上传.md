### 1.文件上传与下载

**1.什么需要使用文件上传的功能**

1. 网盘
2. 网络相册
3. 头像
4. 实名认证
5. 百度文库
6. 邮箱附件

**2.什么是文件上传呢?**

将本地的文件复制一份传送到网络服务器中储存

**3.文件上传时需要注意的事项有哪些**

1. HTML 表单部分:
   1. 上传文件时,传输方式必须是POST 方式
   2. 需要指定表单传输编码格式:enctype="multipart/form-data"
2. PHP 页面需要注意:
   1. 如果有文件上传,那么上传的文件在PHP 脚本执行中不能使用$\_POST 来接收,必须用$\_FILE来接收,其他内容依然使用$\_POST 接收
   2. PHP.ini 配置文件中默认上传文件的最大值为: upload\_max_filesize=2M
   3. PHP.ini 配置文件中默认允许上传文件: file_uploads=On
   4. PHP.ini 配置文件中默认临时存储路径: upload_tmp_dir="相应的网站路径/tmp"
   5. PHP.ini 配置文件中默认允许最大上传文件数量: max_file_uploads=20
   6. PHP.ini 配置文件中默认允许POST 最大上传: post_max_size=8M
   7. **注意:** 文件上传最大值 upload\_max_filesize 不能超过POST 的最大值post_max_size, 文件上传的被包含在POST 里面,剩余POST 可以上传的空间为post 最大值 - file 上传的文件大小

**1-php copy 14.php 文件**

```php
<?php
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件上传</title>
</head>
<body>
    <!-- method="post" enctype="multipart/form-data" 必须写 -->
    <form action="./1-php copy 15.php" method="post" enctype="multipart/form-data">
        <input type="file" name="pic" id="">
        <input type="submit" value="上传">
    </form>
</body>
</html>
?>
```

**1-php copy 15.php 文件**

```php
<?php
   var_dump($_FILES["pic"]);
    //将临时目录的文件tmp 取出
    rename($_FILES["pic"]['tmp_name'],$_FILES["pic"]['name'])

?>
```

**实现文件完整的上传**

```php
<?php
    var_dump($_FILES["pic"]);
    //将临时目录的文件tmp 取出
    // rename($_FILES["pic"]['tmp_name'],$_FILES["pic"]['name']);

    //0.判断错误,如果是0, 上传成功 才执行以下代码
    if($_FILES['pic']['error']>0){
        switch($_FILES['pic']['error']){
            case 1:
                die("超过PHP 设置的最大值");
            case 2:
                die('文件超过表单的最大值');
            case 3:
                 die("只有部分文件上传");
            case 4:
                die("没有文件上传");
            case 6:
                die('找不到临时文件');
            case 7:
                die("文件写入失败");
        }
    }
    
    //1.判断上传文件的类型是否是允许的类型
    // $type=array('image/jpg','image/jpeg','image/gif','image/png');
    // if(!in_array($_FILES['pic']['type'],$type)){
    //     die('上传的文件不合法');
    // }
    //2.判断上传的文件是否在允许的范围内
    $size=10000;
    if($_FILES['pic']['size']>$size){
        die('亲.您传的是大象吗?');
    }
    //3.需要将上传的文件重命名并保证不重复
    $path='./biran';
    if(!file_exists($path)){
        mkdir($path);
    }
    // 获取文件后缀
    $uffix=strrchr($_FILES['pic']['name'],'.');
    do{
        $name=md5(time().mt_rand(1,1000).uniqid()).$uffix;
    }while(file_exists($path.'/'.$name));    //唯一
    // echo $name;
    // echo $path.'/'.$name;
    // 4.移动保存文件
    if(move_uploaded_file($_FILES['pic']['tmp_name'],$path.'/'.$name)){
        echo '上传文件成功,文件位置:'.$path.'/'.$name;
    }else{
        echo '上传失败!';
    }




?>
```

**封装文件的上传函数**

```php
<?php
//封装文件的上传
upload('pic');  //表单提交的name值
function upload($pic,$path='./upload',$size=100000,array $type=array('image/jpg','image/jpeg','image/gif','image/png')){
     //0.判断错误,如果是0, 上传成功 才执行以下代码
     if($_FILES[$pic]['error']>0){
        switch($_FILES[$pic]['error']){
            case 1:
                return "超过PHP 设置的最大值";
            case 2:
                return '文件超过表单的最大值';
            case 3:
                return "只有部分文件上传";
            case 4:
                return "没有文件上传" ;
            case 6:
                return '找不到临时文件' ;
            case 7:
                return "文件写入失败" ;
        }
    }
      //1.判断上传文件的类型是否是允许的类型
    if(!in_array($_FILES[$pic]['type'],$type)){
        return '上传的文件不合法';
    }
    //2.判断上传的文件是否在允许的范围内
    if($_FILES[$pic]['size']>$size){
        return '亲.您传的是大象吗?';
    }
    //3.需要将上传的文件重命名并保证不重复
    if(!file_exists($path)){
        mkdir($path,0777,true); //嵌套创建
    }

      // 获取文件后缀
      $uffix=strrchr($_FILES[$pic]['name'],'.');
      do{
          $name=md5(time().mt_rand(1,1000).uniqid()).$uffix;
      }while(file_exists($path.'/'.$name));    //唯一
 
      // 4.移动保存文件
      if(move_uploaded_file($_FILES[$pic]['tmp_name'],$path.'/'.$name)){
          echo '上传文件成功,文件位置:'.$path.'/'.$name;
      }else{
          echo '上传失败!';
      }
}


?>

```

