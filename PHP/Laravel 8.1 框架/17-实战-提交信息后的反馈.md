# 提交信息后的反馈

在更新完数据库之后,控制器要给请求正确的响应,而不是`dd()`打印

在之前的学习中,已经用过一个基本的响应了,视图响应:

```php
public function index(){
    return view('login.register');
}
```

在更新完个人信息之后,可以给这个请求一个返回的响应,返回到之前提交表单的页面去,在返回到表单页面的同时,还可以携带一些数据到页面中,比如错误提示,或者是其他的信息:

```php
public function inforUpdate(Reponse $request){
   //判断执行结果,返回响应
    if($res){
        return back()->with(['success'=>'更新成功']);
    }else{
        return back()->withError('数据未做更改');
    }
}
```





**完善反馈**

`项目/resources/views/user/info.blade.php`

```php
{{.....}}
   <div class="card-body">
                        @include('common.error')
                        @include('common.success')
</div>
```



`项目/resources/views/common/error.blade.php`

```php
{{-- 表单提交的错误,捕获 --}}
@if ($errors->any())
    <div class="alert alert-danger">
        <ul>
            @foreach ($errors->all() as $error)
                {{ $error }} <br>
            @endforeach
        </ul>
    </div>
@endif

```

`项目/resources/views/common/success.blade.php`

```php
@if (session('success'))
<div class="alert alert-success">
    {{session('success')}}
</div>
@endif
```



`项目/app/Http/controllers/UserController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;

// ....

/**
     * 个人中心-修改个人信息-更新数据
     */
    public function infoUpdate(Request $request)
    {
        // dd('个人中心-修改个人信息-更新数据');
        $name = $request->input('name');
        $email = $request->input('email');

        $errors = [];
        if (empty($name)) array_push($errors, '用户名不能为空!');
        if (empty($email)) array_push($errors, '邮箱不能为空!');
        if(!empty($errors)){
            return back()->withErrors($errors);
        }


        // dd($name,$email);
        // 更新数据
        // 不能这么操作,会更新整个表,需要指定id
        // $re=DB::update(['name'=>$name,'email'=>$email]);
        // dd($re);

        // 获取用户ID
        // 使用auth 辅助函数
        // 当前登入用户
        // $uid=auth()->user()->id;
        // 或
        $uid = auth()->id();
        // 使用门面函数
        // $uid=Auth::user()->id;
        // $uid=Auth::id;
        // dd($uid);

        // 更新数据,没有做任何修改提交不会更新,并返回0
        $re = DB::table('users')
            ->where('id', $uid)
            ->update(['name' => $name, 'email' => $email]);
        // dd($re);

        //使用模型更新
        // 是一个Model 类型
        // dd(auth()->user());
        // $user=auth()->user();
        // // 修改
        // $user->name=$name;
        // $user->email=$email;
        // // 执行更新,没有做任何修改提交也会更新,并返回1
        // $re=$user->save();

        // dd($re);
        if ($re) {
            return back()->with(['success' => '更新数据成功!']);
            // 在 项目/resources/views/user/info.blade.php 中使用
        } else {
            // 错误收集在common.error 里面
            // 闪存到session 并放到$error 中
            return back()->withErrors('数据未做更新操作!');
            // return back()->withErrors(['数据未做更新操作!']);
        }
    }
```

