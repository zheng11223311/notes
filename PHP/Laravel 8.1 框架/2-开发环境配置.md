# 介绍

Laravel 致力于让整个PHP 开发体验变得更愉快,这其中也包括你的本地开发环境,Vagrant 提供了一种简单,优雅的方式来管理和配置虚拟机

Laravel Homestead 是Laravel 官方封装的Vagrant Box,它为你提供了一个完美的开发环境,让你不需要再本地开发机器上安装PHP,Web 服务器以及其他的服务器软件,你再也不用担心会弄乱你的操作系统了! Vagrant Box 完全是一次性的,如果出现问题,你可以在几分钟内删除并重新创建Box !

Homestead 可以在任何Windows,Mac 或Linux 系统上运行,它预装好了Nginx,PHP,MySQL,PostgreSQL,Redis,Memecached,Node 以及开发令人惊叹的Laravel 应用程序所需的所有其他软件

> Vagrant 最主要的作用就是文件共享,将宿主机的代码,自动同步到虚拟机中去

> Homestead 实际就是一个Ubuntu 的系统,里面安装了我们开发所需要的所有软件



# 安装

**安装前的准备**

要先安装`virtualBox 6.x`,下载地址: [下载 – Oracle VM VirtualBox](https://www.virtualbox.org/wiki/Downloads) 

接着安装`vagrant`,下载地址: [《流浪汉》作者：HashiCorp (vagrantup.com)](https://www.vagrantup.com/) 

下载好对应系统的软件,双击安装,一路下一步即可,安装完成之后,重启电脑

安装完成之后,检查一下是否安装完成`cmd`中运行:

```powershell
vagrant --version
```



**安装Homestead Vagrant Box  (1)**

`cmd`执行命令

```powershell
vagrant box add laravel/homestead
```

之后会让你选择所使用的虚拟机,输入3,选择`virtualbox`,回车:

之后等待下载完成即可,根据你的网速,你可能需要一定的时间

查看是否安装完成

`cmd` 输入`vagrant box list`,查看是否有`laravel/homestead`

```powershell
vagrant box list
```

**安装Homestead Vagrant Box  (2)**

下载地址:



> 考虑到有不会使用Git 的,所以这里就不使用Git 克隆,而是直接下载压缩包

解压到家目录下,改解压出来的目录名为`Homestead`





## 附:基于本地box 快速安装

**安装 homestead**

导入C 盘下的`homestead.box`

```powershell
vagrant box add laravel/homestead	C:\homestead.box
#出现box :Successfully 表示导入成功

vagrant box list	#查看列表,手动导入的版本为0
#laravel/homestead (virtualbox,0)	
```

> 名字一定是`laravel/homestead`

下载homestead 配置,进入用户家目录(如果有Homestead 目录,先删掉),使用git 克隆:

```
git clone https://github.com/laravel/homestead.git Homestead
```

> 不会Git 就直接去Github 下载,https://github.com/laravel/homestead.git

解压文件,终端进入到Homestead 目录,执行Homestead 里面的init.bat

```powershell
init.bat
```

修改`~/Homestead/script/homestead.rc 文件`,找到`~> 9`,改为`>=0`(因为手动导入的版本为0)

修改`~/Homestead/homestead.yaml`文件修改同步目录:

```yaml
folders:
	- map:c:\Users\xxx\Desktop\workspace	#将本机的目录同步到虚拟机的目录中,这里为工作目录
	to: /home/vagrant/code				#虚拟机目录
```

> map 是你的工作目录,这里我再桌面创建了`workspace`为工作目录

启动:

```powershell
#在~/Homestead/ 下启动,因为它要找到当前目录下的 vagrantfile 文件
vagrant up
```



## 如果ssh 认证失败

> > 如果ssh 没有认证失败,直接跳过
>
> 删除`c:\users\xxx\.vagrant.d\`下的`insecure_private_key`和`insecure_private_key.pub`
>
> 重新生成`vagrant`密钥
>
> ```powershell
> ssh-keygen -f /users/xxx/.vagrant.d/insecure_private_key		#xxx 为你的电脑用户名,即你的家目录名
> ```



## ssh 认证

终端进入`Homestead`使用`ssh` 连接,先用密码进入服务器

```powershell
vagrant ssh
#密码是vagrant
```

复制`insecure_private_key.pub`内容,加入到服务器`vagrant`用户家目录`.ssh/authorized_keys`文件



## 安装Laveral

终端连接进入服务器,更换composer 国内源

```powershell
composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/
composer clear-cache	#此步骤选择性操作,清除所有package 缓存
```

进入`/home/vagrant/code`目录,安装`laravel`

```powershell
composer create-project --prefer-dist laravel/laravel blog	#项目名为blog
```

当前目录下生成一个`blog`项目文件夹

修改代码同步目录(即将所有操作在linux 和window 一起同步),修改`~/Homestead/homestead.yaml`

```yaml
folders:
	- map:c:\Users\xxx\Desktop\workspace\blog	#将本机的目录同步到虚拟机的工作目录下的项目目录中,这样就不用同步所有项目目录,只同步指定项目目录
	to: /home/vagrant/code/blog				#虚拟机目录
sites:		#站点配置
	- map:blog.test		#站点名称,即浏览器访问的名称
	to:/home/vagrant/code/blog/public  #站点根目录
```

重启虚拟机

```powershell 
vgrant reload --provision		# --provision 重新加载配置homestead.yaml,所有的操作会同步到虚拟机中,即虚拟机中也会执行重启
```



## 域名解析

**找到系统配置文件**

在c 盘/windows/System32/drivers/etc/hosts(需要权限,属性修改写入权限)

打开文件

```
#
127.0.0.1 localhost
::1 localhost
```

**绑定自己的域名**

```
#
127.0.0.1 localhost
::1 localhost
127.0.0.1 blog.test
```







# 安装方法2

以上方式全部不需要,直接在window 下使用composer

[composer 的安装](../108-Composer 的安装.md)

## 下载 Composer

打开命令行并依次执行下列命令安装最新版本的 Composer：

复制

```bash
php -r "copy('https://install.phpcomposer.com/installer', 'composer-setup.php');"
```

复制

```bash
php composer-setup.php
```

复制

```bash
php -r "unlink('composer-setup.php');"
```

执行第一条命令下载下来的 `composer-setup.php` 脚本将简单地检测 `php.ini` 中的参数设置，如果某些参数未正确设置则会给出警告；然后下载最新版本的 `composer.phar` 文件到当前目录。

上述 3 条命令的作用依次是：

1. 下载安装脚本 － `composer-setup.php` － 到当前目录。
2. 执行安装过程。
3. 删除安装脚本。

## 局部安装

 上述下载 Composer 的过程正确执行完毕后，可以将 `composer.phar` 文件复制到任意目录（比如项目根目录下），然后通过 `php composer.phar` 指令即可使用 Composer 了！ 



 **创建项目**

```powershell
composer create-project --prefer-dist laravel/laravel blog "5.5.*"      
 
# composer          使用composer 创建
# create-project   创建项目
# laravel/laravel  创建的项目为laravel 项目
# blog             项目名称
# "5.5.*"		  项目的版本号
```

如果只有composer.phar

将composer.phar 放置在工作目录下,哪里需要composer 就放到哪里

```powershell
php composer.phar  create-project --prefer-dist laravel/laravel blog "5.5.*"   #结果同上
php composer.phar  create-project --prefer-dist laravel/laravel blog "8.5.*"	#这里安装8.5以上的版本,需要php 7.3 之后的版本,否则报错,修改环境变量php 的路径为7.3 版本的路径
```

在`blog`项目路径下,使用

```powershell
php artisan  --version   #查看当前laravel 版本,	artisan  为项目目录下的一个文件
#Laravel Framework 8.83.11
```

 **启动项目** 

 进入到刚刚创建的项目下，运行如下命令，会默认在8000端口上开启服务 

```powershell
php artisan serve
```

 可以使用如下命令自定义端口 

```powershell
php artisan serve --port=8888
```

 也可以通过如下方法，改变主机地址 

```powershell
php artisan serv --host=localhost
```



# vscode 插件

安装laravel 插件和laravel format 格式化插件

