# 邮件发送

参考手册 :  [发送邮件 | 继续深入 |《Laravel 9 中文文档 9.x》| Laravel China 社区 (learnku.com)](https://learnku.com/docs/laravel/9.x/mail/12233) //



**掌握**

- 配置
- 邮件视图
- 发送邮件



## 简介

发送邮件并不复杂。Laravel 基于 Symfony Mailer 组件提供了一个简洁、简单的邮件 API。Laravel 和 Symfony 为 Mailer SMTP 、Mailgun 、Postmark 、 Amazon SES 、 及 sendmail （发送邮件的方式）提供驱动，允许你通过本地或者云服务来快速发送邮件。

 Laravel 的邮件服务可以通过 `config/mail.php` 配置文件进行配置。 

```php
// 默认使用smtp 驱动
    'default' => env('MAIL_MAILER', 'smtp'),

'mailers' => [
        // 各种驱动的配置
        //在env 中配置
        'smtp' => [
            'transport' => 'smtp',
            'host' => env('MAIL_HOST', 'smtp.mailgun.org'),
            'port' => env('MAIL_PORT', 587),
            'encryption' => env('MAIL_ENCRYPTION', 'tls'),
            'username' => env('MAIL_USERNAME'),
            'password' => env('MAIL_PASSWORD'),
            'timeout' => null,
            'auth_mode' => null,
        ],
//...
    
    
    // 全局的邮件地址和发送方的名字
    'from' => [
        'address' => env('MAIL_FROM_ADDRESS', 'hello@example.com'),
        'name' => env('MAIL_FROM_NAME', 'Example'),
    ],
```



`.env`

```
MAIL_MAILER=smtp
MAIL_HOST=smtp.		//smtp 中的服务地址
MAIL_PORT=456
MAIL_USERNAME=自己邮件账号xxx@163.com
MAIL_PASSWORD=邮件设置中开启popt/smtp 时接收到的一次性授权码
MAIL_ENCRYPTION=ssl		//安全验证
MAIL_FROM_ADDRESS=自己邮件账号xxx@163.com
MAIL_FROM_NAME="博客"		//发送发的名字
```





## 生成 Mailables

在构建 Laravel 应用程序时，应用程序发送的每种类型的电子邮件都表示为一个 mailable 类。 这些类存储在 app/Mail 目录中。 如果您在应用程序中看不到此目录，请不要担心，因为它会在您使用 make:mail Artisan 命令创建第一个可邮寄类时为您生成：

```powershell
php artisan make:mail OrderShipped
```





## 创建一个单函数控制器用于测试

```powershell
php artisan make:controller Test8Controller --invokable

#Controller created successfully.
```



`项目/routes/web.php`

```php
<?php
    
use App\Http\Controllers\Test8Controller;
use Illuminate\Support\Facades\Route;

Route::get('/test8',Test8Controller::class);
// Route::get('/test8/{id}',Test8Controller::class);
```



`项目/app/Http/Controllers/Test8Controller.php`

```php
<?php

namespace App\Http\Controllers;

use App\Mail\OrderShipped;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Mail;

class Test8Controller extends Controller
{

    public function __invoke(Request $request)
    {
        // 使用mail 门面模式,发送邮件,to 接收方邮件 OrderShipped() 传递参数
        Mail::to('z32404243334@qq.com')->send(new OrderShipped('hello'));
    }
}

```

`app\Mail\OrderShipped.php`

```php
<?php

namespace App\Mail;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Mail\Mailable;
use Illuminate\Queue\SerializesModels;

class OrderShipped extends Mailable
{
    use Queueable, SerializesModels;
    protected $str;

    // 执行构造函数就会执行build() 里面的代码
    public function __construct($str)
    {
        //接收到传递过来的参数$str
        $this->str=$str;
    }

    /**
     * Build the message.
     *
     * @return $this
     */
    public function build()
    {
        // view指向 resources/views 
        return $this->view('emails.order',['str'=>$this->str]); //使用模板
    }
}

```

`resources\views\emails\order.blade.php`

```php
<h3>{{$str}}你有新的邮件</h3>
{{-- 注意:邮件的加载归邮件类管理,这里的模板使用的css 因该写在模板中
    不能使用link 去加载css,link 是浏览器的操作 --}}
```

