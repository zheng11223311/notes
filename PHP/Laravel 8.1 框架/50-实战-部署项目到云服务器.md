# 部署项目到云服务器



服务器的购买 参考:

 [1.服务器.md](D:\学习\wanye\服务器与域名购买使用\1.服务器.md)

 [2-阿里云双11云服务器购买与使用.md](D:\学习\wanye\服务器与域名购买使用\2-阿里云双11云服务器购买与使用.md)

上传到服务器文件不包括`项目/vendor`和`node_modules`文件,因为这些会根据配置文件生成

上传后

```powershell
php composer.phar install  #安装依赖,需要有php 和composer.phar
```

网站的入口要指向项目的`public` 目录

导出本地的数据库的数据表,上传到服务器

修改`.env`配置文件,修改数据库的账户为服务器上数据库的账号和密码

访问: [🧨 SQLSTATE[42S02\]: Base table or view not found: 1146 Table 'mydb.sessions' doesn't exist (SQL: select * from `sessions` where `id` = fnJYRO2zxbJHDsTFkjFLD0rDMFnIbeu89vA6yJhu limit 1)](http://120.24.51.158/php/laravel/blog/public/) 

报错,找不到session 表(此报错,建立在已经可以连接数据库的基础上,如果不能连接数据库,还会有数据库连接的报错,需要下载数据库驱动php7.4-mysql 安装(apt install php7.4-mysql))

执行数据迁移

```powershell
php artisan migrate
```

或同时生成默认数据

命令 `migrate:refresh` 首先会回滚已运行过的所有迁移，随后会执行 `migrate`。这一命令可以高效地重建你的整个数据库：

```
php artisan migrate:refresh --seed
```



**开启路由缓存**

```powershell
php artisan route:cache		#为所有路由开启缓存,清除原先的路由缓存,再次缓存
#Route cache cleared!
#Routes cached successfully!
```

**关闭路由缓存**

```powershell
php artisan route:clear
```

**开启配置缓存**

```powershell
php artisan config:cache	#所有的配置都会被缓存,修改.env 等配置文件都没有效果,直接从缓存中读取配置,必要的话,重新刷新缓存,重新执行命令即可
#Configuration cache cleared!
#Configuration cached successfully!

php artisan config:clear #清除缓存
```

如果访问出现报错

# The GET method is not supported for this route. Supported methods: POST.

清除一下缓存`php artisan route:clear`,但是先使用`php artisan route:cache`好像没有效果

然后再次缓存路由

```
php artisan route:cache
```



访问  [](http://120.24.51.158/php/laravel/blog/public/) 

不需要设置指定的根路径,需要访问`public`下,所有的路由都在`public`下



需要重新生成软连接用来存储图像,执行,否则图片不能正常访问

```powershell
php artisan storage:link

#看到如下正确指示放向才正确,有时生成的是指向自己public的位置,这是错误的
#The [/www/wwwroot/cv2.yyqx.tech/myblog/php/laravel/blog/public/storage] link has been connected to [/www/wwwroot/cv2.yyqx.tech/myblog/php/laravel/blog/storage/app/public].
#The links have been created.
```

