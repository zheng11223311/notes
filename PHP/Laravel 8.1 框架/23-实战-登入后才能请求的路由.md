# 登入后才能请求的路由

参考手册  [用户认证 | 安全相关 |《Laravel 8 中文文档 8.5》| Laravel China 社区 (learnku.com)](https://learnku.com/docs/laravel/8.5/authentication/10397) 



将之前设置的`CheckAge`的中间件清除掉

优化`web.php`文件,增加路由分组和路由中间件

```php
<?php

use App\Http\Controllers\Blogcontroller;
use App\Http\Controllers\CommentController;
use App\Http\Controllers\IndexController;

use App\Http\Controllers\UserController;
use Illuminate\Support\Facades\Route;

// 用户认证中间件
// 需要登入的页面
// 中间件用户认证中间件是自带已经注册好的,可以直接使用
Route::middleware('auth')->group(function () {
    // 登入后,博客相关的路由
    Route::prefix('blog')->name('blog.')->group(function () {
        //改变博客的状态,发布与不发布
        Route::patch('/{id}', [Blogcontroller::class, 'status'])
            ->name('status');
        //评论路由
        Route::post('/{id}/comment', CommentController::class)
            ->name('comment');
    });


    // 个人中心相关的路由
    // prefix 路由前缀,路径添加前缀
    // name('user.') 命名前缀,如果这里没有. 里面的所有路由命名前面都需要加上.
    Route::prefix('user')->name('user.')->group(function () {
        //个人中心-修改个人信息-页面
        Route::get('/', [UserController::class, 'infoPage'])
            // ->name('user.info');
            ->name('info');

        //个人中心-修改个人信息-更新数据
        Route::put('/', [UserController::class, 'infoUpdate'])
            ->name('info.update');

        //个人中心-头像-页面
        Route::get('/avatar', [UserController::class, 'avatarPage'])
            ->name('avatar');

        //个人中心-头像-更新数据
        Route::put('/avatar', [UserController::class, 'avatarUpdate'])
            ->name('avatar.update');

        //个人中心-所有博客
        Route::get('/blog', [UserController::class, 'blog'])
            ->name('blog');
    });
});



// 博客资源路由
// 定义博客资源路由,上面的基础路由可以去掉
Route::resource('blog', Blogcontroller::class)->except([
    'index',    //将此路由去除,首页使用自己定义的路由
]);

// 博客首页
Route::get('/', [IndexController::class, 'index'])->name('index');

// php artisan route:list 查看路由列表以及请求方式




// 登入注册相关的路由,将会直接使用laravel 提供的,这里就不写了

// 访问测试模板路由
// Route::get('test',function(){
//     return view('test');
// });
// 直接定义 视图路由
// Route::view('test','test');

Route::middleware([
    'auth:sanctum',
    config('jetstream.auth_session'),
    'verified'
])->group(function () {
    Route::get('/dashboard', function () {
        return view('dashboard');
    })->name('dashboard');
});

```



**控制器使用中间件**

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class Blogcontroller extends Controller
{

     /**
     * 实例化一个新的控制器实例
     *控制器中间件
     * @return void
     */
    public function __construct()
    {
        $this->middleware('');
        // 此控制器都使用auth 中间件,排除show 方法
        $this->middleware('auth')->except('show');
    }

    /**
     * 添加博客的页面
     */
   
    public function create()
    {
        // dd('添加博客的页面');
        return view('blog.create');
    }

    /**
     * 执行博客的添加
     */
    public function store(Request $request)
    {
         dd('执行博客的添加');
    }

   /**
    * 查看一条博客的详情
    */
    public function show($id)
    {
        // dd('查看一条博客的详情'.$id);
        return view('blog.show');
    }

    /**
     * 编辑页面
     */
    public function edit($id)
    {
        // dd('编辑页面'.$id);
        return view('blog.edit');
    }

    /**
     * 执行更新
     */
    public function update(Request $request, $id)
    {
        dd('执行更新'.$id);
    }

    /**
     * 删除博客
     */
    public function destroy($id)
    {
        dd('删除博客');
    }

    /**
     * 修改博客状态
     */
    public function status($id)
    {
        dd('修改博客状态'.$id);
    }

    
}

```

