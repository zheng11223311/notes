# 创建博客需要的控制器

创建控制器要使用到`php artisan` 命令,如果你的本机没有安装`php`,请在`vagrant`虚拟机中的项目所在目录,执行相关的`artisan` 命令

创建普通控制器的命令:

```powershell
php artisan make:controller  IndexController	#博客首页
```

```powershell
php artisan make:controller  UserController		#个人中心
```

创建资源控制器:

```powershell
php artisan make:controller  CommentController Blogcontroller	--resource	#同时创建两个资源控制器	评论资源控制器 博客资源控制器
```

创建单行为控制器:

```powershell
php artisan make:controller  CommentController --invokable		#创建评论单行为控制器,上方的评论资源控制器不创建
```



# 将web.php 路由文件中的闭包改写为控制器

```php
<?php

use App\Http\Controllers\Blogcontroller;
use App\Http\Controllers\CommentController;
use App\Http\Controllers\IndexController;
use App\Http\Controllers\UserController;
use Illuminate\Support\Facades\Route;

// 博客资源路由
// 定义博客资源路由,上面的基础路由可以去掉
Route::resource('blog',Blogcontroller::class)->except([
    'index',    //将此路由去除,首页使用自己定义的路由
]);

// 博客首页
Route::get('/',[IndexController::class,'index'])->name('index');

// php artisan route:list 查看路由列表以及请求方式

//改变博客的状态,发布与不发布
Route::patch('/blog/{id}', [Blogcontroller::class,'status'])
->name('blog.status');


//个人中心-修改个人信息-页面
Route::get('/user',[UserController::class,'infoPage'])
->name('user.info');

//个人中心-修改个人信息-更新数据
Route::put('/user',[UserController::class,'infoUpdate'])
->name('user.info.update');

//个人中心-头像-页面
Route::get('/user/avatar',[UserController::class,'avatarPage'])
->name('user.avatar');

//个人中心-头像-更新数据
Route::put('/user/avatar',[UserController::class,'avatarUpdate'])
->name('user.avatar.update');

//个人中心-所有博客
Route::get('/user/blog',[UserController::class,'blog'])
->name('user.blog');

//评论路由
Route::post('/blog/{id}/comment',CommentController::class)
->name('blog.comment');

// 登入注册相关的路由,将会直接使用laravel 提供的,这里就不写了
```



**项目/app/Http/Controllers/IndexController.php**

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class IndexController extends Controller
{
    /** 使用/** 热键 就会自动生成注释
     * 博客首页
     */
    public function Index(){
        dd('博客首页');
    }
}

```



**项目/app/Http/Controllers/Blogcontroller.php**

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class Blogcontroller extends Controller
{
   
    /**
     * 添加博客的页面
     */
   
    public function create()
    {
        dd('添加博客的页面');
    }

    /**
     * 执行博客的添加
     */
    public function store(Request $request)
    {
         dd('执行博客的添加');
    }

   /**
    * 查看一条博客的详情
    */
    public function show($id)
    {
        dd('查看一条博客的详情'.$id);
    }

    /**
     * 编辑页面
     */
    public function edit($id)
    {
        dd('编辑页面'.$id);
    }

    /**
     * 执行更新
     */
    public function update(Request $request, $id)
    {
        dd('执行更新'.$id);
    }

    /**
     * 删除博客
     */
    public function destroy($id)
    {
        dd('删除博客');
    }

    /**
     * 修改博客状态
     */
    public function status($id)
    {
        dd('修改博客状态'.$id);
    }

    
}

```



**项目/app/Http/Controllers/UserController.php**

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class UserController extends Controller
{
    /**
     * 个人中心-修改个人信息-页面
     */
    public function infoPage(){
        dd('个人中心-修改个人信息-页面');
    }

    /**
     * 个人中心-修改个人信息-更新数据
     */
    public function infoUpdate(){
        dd('个人中心-修改个人信息-更新数据');
    }

    /**
     * 个人中心-头像-页面
     */
    public function avatarPage(){
        dd('个人中心-头像-页面');
    }

    /**
     * 个人中心-头像-更新数据
     */
    public function avatarUpdate(){
        dd('个人中心-头像-更新数据');
    }

    /**
     * 个人中心-所有博客
     */
    public function blog(){
        dd('个人中心-所有博客');
    }
}

```



**项目/app/Http/Controllers/CommentController.php**

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class CommentController extends Controller
{
    /**
     * 评论博客
     */
    public function __invoke(Request $request)
    {
        dd('评论博客');
    }
}

```



为保护数据的安全,这里需要重新打`crfs`

需要在`项目/app/Http/Kernel.php`下修改

```php
    protected $middlewareGroups = [
        'web' => [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            // \Illuminate\Session\Middleware\AuthenticateSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
             \App\Http\Middleware\VerifyCsrfToken::class,		//将这段注释重新打开即可
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'api' => [
            'throttle:api',
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],
    ];
```

