# 控制器

参考手册: [控制器 | 基础功能 |《Laravel 8 中文文档 8.x》| Laravel China 社区 (learnku.com)](https://learnku.com/docs/laravel/8.x/controllers/9368) 



**掌握内容**

- 定义控制器
- 资源型控制器
- 命名资源路由
- 补充资源控制器



作用:将在路由中请求中的处理逻辑代码提取出来放置在一个文件中

```php
Route::get('/blog/{id}', function ($id) {
    dd('查看的博客id 是 :'.$id);	//逻辑代码提取出来放置单独的文件中
})->name('blog.show')->where('id','[0-9]+');
```



**命令行创建 基础控制器**

```powershell
php artisan make:controller	控制器名称

#创建 基础控制器 TestController(一个class 类)
php artisan make:controller	TestController
# 项目/app/Http/Controllers/TestController.php
```

 控制器被存放在 `app/Http/Controllers` 目录。 

**注:app/Http/Controllers/controller.php  是所有控制的基类** 



**命令行创建 [单行为控制器](https://learnku.com/docs/laravel/8.x/controllers/9368#e3f079) (即这个控制器类中只有一个方法)** 

```powershell
php artisan make:controller ShowProfile --invokable
# 项目/app/Http/Controllers/ShowProfile.php
```



**命令行创建 资源型控制器( 资源路由通过单行代码即可将典型的「CURD (增删改查)」路由分配给控制器。 )**

```powershell
php artisan make:controller PhotoController --resource
#使用资源控制器,会自动在路由中注册资源控制器里面的方法
# 简化手动对路由的注册操作
#使用 php artisan route:list 可以查看到已经注册
# 项目/app/Http/Controllers/PhotoController.php
```





在`项目(blog)/routes/web.php `编写路由

```php
<?php

use App\Http\Controllers\PhotoController;
use App\Http\Controllers\ShowProfile;
use App\Http\Controllers\TestController;
use Illuminate\Support\Facades\Route;


// 使用控制器, [控制器,控制器中的方法]
// 可以写上整个路径,也可以使用use 先导入在使用
// Route::get('/test',[App\Http\Controllers\TestController::class,'test'])
// Route::get('/test',[TestController::class,'test']);


// 传递参数
Route::get('/test/{id}',[TestController::class,'test']);

// 使用单行为控制器
// 因为但行为控制器中只有一个方法__invoke ,所以不需要指定方法名
//访问 http://127.0.0.1:8000/test1/12123
Route::get('/test1/{id}',ShowProfile::class);

// 使用资源型控制器
// 使用资源控制器,会自动在路由中注册资源控制器里面的方法
// 简化手动对路由的注册操作
// 使用 php artisan route:list 可以查看到
// Route::resource('photo',PhotoController::class);

//使用部分资源控制
// except 下的PhotoController 方法将不会被注册到路由中,其余PhotoController
// 的方法会被注册
// only 效果相反,相同操作
// 需要的注意的是:如果两个Route::resource 同时使用同一个资源类
// 一个排除方法,一个没有排除,最终会显示没有排除的
Route::resource('photo',PhotoController::class)->except([
    'create','store','update','destroy'
]);

// 命名资源路由名称
Route::resource('photo',PhotoController::class)->except([
    'create','store','update','destroy'
])->name([
    'index'=>'aa.cc'    //重新定义路由名称
]);



// 命名资源路由参数
Route::resource('photo',PhotoController::class)->except([
    'create','store','update','destroy'
])->name([
    'index'=>'aa.cc'    //重新定义路由名称,photo.index 变成aa.cc
])->parameters([
    'ph'=>'ph2'   //路由传递的photo/{ph}参数名称改变为photo/{ph2}
]);


// 补充资源路由
// 需要定义在资源路由使用前,否则会被其优先级覆盖掉
// 需要在PhotoController 中添加ppp 方法
Route::get('/photo/ppp',[PhotoController::class,'ppp']);

Route::resource('photo',PhotoController::class);
```







`项目/app/Http/Controllers/TestController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

// 需要继承基础控制器Controller
class TestController extends Controller
{
    // public function test(){
    //     dd('test');
    // }

    // 接收参数
    public function test($id){
        dd($id);
    }

}
```



`项目/app/Http/Controllers/ShowProfile.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class ShowProfile extends Controller
{
 
    public function __invoke($id)
    {
        dd($id);
    }
}

```



`项目/app/Http/Controllers/PhotoController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class PhotoController extends Controller
{

    public function index()
    {
        //
    }


    public function create()
    {
        //
    }


    public function store(Request $request)
    {
        //
    }


    public function show($id)
    {
        //
    }


    public function edit($id)
    {
        //
    }


    public function update(Request $request, $id)
    {
        //
    }


    public function destroy($id)
    {
        //
    }
}

```









**执行Route::resource 注册资源路由**

**需要的注意的是:如果两个Route::resource 同时使用同一个资源类, 一个排除方法,一个没有排除,最终会显示没有排除的**