# 用户登入与注册

参考手册: [用户认证 | 安全相关 |《Laravel 8 中文文档 8.x》| Laravel China 社区 (learnku.com)](https://learnku.com/docs/laravel/8.x/authentication/9381) 



**安装组件**

```powershell
php composer.phar require laravel/jetstream		#不仅生成路由(route:list 查看),还生成 项目/database/migrations 生成迁移文件夹

#2 选1
# 使用 Livewire 栈安装 Jetstream...		传统普通界面,这里使用这种方式
php artisan jetstream:install livewire

# 使用 Inertia 栈安装 Jetstream...	vue 界面
php artisan jetstream:install inertia
```



**配置数据库**

`项目/config/database.php`

```php
//找到
 'default' => env('DB_CONNECTION', 'mysql'),	//默认使用mysql

//不需要直接修改此配置文件,因该再 项目/.env 文件中修改,这里引入 .env 的配置变量
        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DATABASE_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'forge'),
            'username' => env('DB_USERNAME', 'forge'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],
```



` 项目/.env`

```env
//数据库的名字要与Homestead.yaml 文件中的databases: -homestead 一致,即数据库为homestead

#修改
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=homestead		//这里修改为homestead
DB_USERNAME=homestead		//用户名修改learavel 为默认的homestead
DB_PASSWORD=secret			//密码 修改为 默认的secret
```

**我自己的配置**

```
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel8	//数据库
DB_USERNAME=root		//用户名
DB_PASSWORD=			//密码
```



**执行数据迁移**

```powershell
php artisan migrate	
```

**如果报错**

```
 Syntax error or access violation: 1071 Specified key was too long; max key length is 1000 bytes")
```

`升级mysql到7.0` 或 `修改 项目/config/database.php 字符集`

```php
 'mysql' => [
            'driver' => 'mysql',
            'url' => env('DATABASE_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'forge'),
            'username' => env('DB_USERNAME', 'forge'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => 'utf8',	//修改为utf8
            'collation' => 'utf8_unicode_ci',	//修改为utf8
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],
```



**删除数据库中因为迁移创建出来的表(删除所有表), 重新执行数据迁移**

```
php artisan migrate	
```

数据表创建成功



**默认会创建专门的用户登入界面**

存放在`项目/resources/views/auth/`的所有文件



更改原有的`项目/resources/views/auth/login.blade.php`文件

> 将自己的编写的`项目/resources/views/login/login.blade.php`,复制到`项目/resources/views/auth/login.blade.php` 内,并将原有的内容注释一下,以后要用到



**post 提交数据时,报错**

```
Trait 'Laravel\Sanctum\HasApiTokens' not found
```

**安装 即可解决**

```powershell
php composer.phar require laravel/sanctum
```



**设置为中文（验证提示为中文）**

1. 修改**config** 目录下的**app.php** 文件

```php
 'locale' => 'en',
//修改为
 'locale' => 'zh-CN',

//这个配置使用的时 项目/resources/lang/en 语言包
//没有中文语言包,需要自己下载
```

**下载中文语言包**

```
php composer.phar require caouecs/laravel-lang:~3.0
```

下载完后,在`项目/vender/`会生成一个`caouecs`文件夹,里面包含各种语言包,找到`caouecs/src`下的`zh-CN` 文件夹,我们使用这个语言包,将这个`zh-CN` 文件夹复制放入`项目/resources/lang/`下



# 自定义错误提示组件

`项目/resources/views/common/error.blade.php`

```php
{{-- 表单提交的错误,捕获 --}}
@if ($errors->any())
    <div class="alert alert-danger">
        <ul>
            @foreach ($errors->all() as $error)
                {{ $error }} <br>
            @endforeach
        </ul>
    </div>
@endif

```



# 注册页面

**查看注册方式**

```powershell
php artisan route:list 
```

更改原有的`项目/resources/views/auth/register.blade.php`文件

> 将自己的编写的`项目/resources/views/login/register.blade.php`,复制到`项目/resources/views/auth/register.blade.php` 内,并将原有的内容注释一下,以后要用到



**修改注册后跳转的默认主页**

在`项目/app/Providers/RouteServiceProvider.php`

```php
public const HOME = '/dashboard';	//默认主页
//修改为
public const HOME = '/user';

```

登入之后也会重定向到`/user`

