# 响应宏

参考手册   [响应 | 基础功能 |《Laravel 8 中文文档 8.x》| Laravel China 社区 (learnku.com)](https://learnku.com/docs/laravel/8.x/responses/9370#response-macros) 



**掌握内容**

- 自定义响应



## 创建一个单函数控制器用于测试

```powershell
php artisan make:controller Test7Controller --invokable

#Controller created successfully.
```



`项目/routes/web.php`

```php
<?php
    
use App\Http\Controllers\Test7Controller;
use Illuminate\Support\Facades\Route;

Route::get('/test7',Test7Controller::class);
// Route::get('/test7/{id}',Test7Controller::class);
```



`项目/app/Http/Controllers/Test7Controller.php`

```php
<?php

namespace App\Http\Controllers;

use App\Models\Blog;
use Illuminate\Http\Request;

class Test7Controller extends Controller
{
    public function __invoke(Request $request)
    {
        // $blog=Blog::all();
        // $resData=[
        //     'code'=>200,
        //     'msg'=>'seccuess',
        //     'time'=>time(),
        //     'data'=>$blog
        // ];
        // return response()->json($resData);


        // 使用响应宏
        return response()->api('成功', 200, Blog::all());
    }
}

```



 如果你想要定义一个自定义的可以在多个路由和控制器中复用的响应，可以使用 `Response` 门面上的 `macro` 方法。例如，在某个 [服务提供者](https://learnku.com/docs/laravel/8.x/providers) 的 `boot` 方法编写如下代码： 

`app\Providers\ResponseMacroServiceProvider.php`

```php
<?php

namespace App\Providers;

use Illuminate\Support\Facades\Response;
use Illuminate\Support\ServiceProvider;


// 创建的文件ResponseMacroServiceProvider.php 需要添加到配置
// config/app.php 配置文件中'providers'  字段中,进行自动加载
class ResponseMacroServiceProvider extends ServiceProvider
{
    /**
     * 注册响应宏
     *
     * @return void
     */

    public function register()
    {
        //
    }

    public function boot()
    {
        // 在控制器中使用 response()->api($msg,$code,$data)
        Response::macro('api', function ($msg='',$code=200,$data='') {
            $resData=[
                'code'=>$code,
                'msg'=>$msg,
                'time'=>time(),
                'data'=>$data
            ];
            return response()->json($resData);
        });


        // 定义多个响应宏
        Response::macro('wechat', function ($msg='',$code=200,$data='') {
            $resData=[
                'code'=>$code,
                'msg'=>$msg,
                'time'=>time(),
                'data'=>$data
            ];
            return response()->json($resData);
        });
    }
}
```



`config\app.php`

```php
//........  
/*
    |--------------------------------------------------------------------------
    | Autoloaded Service Providers
    |--------------------------------------------------------------------------
    |
    | The service providers listed here will be automatically loaded on the
    | request to your application. Feel free to add your own services to
    | this array to grant expanded functionality to your applications.
    |
    */

    'providers' => [
		//.....
	        /*
         * Application Service Providers...
         */
        App\Providers\AppServiceProvider::class,
        App\Providers\AuthServiceProvider::class,
        // App\Providers\BroadcastServiceProvider::class,
        App\Providers\EventServiceProvider::class,
        App\Providers\RouteServiceProvider::class,
        App\Providers\FortifyServiceProvider::class,
        App\Providers\JetstreamServiceProvider::class,
        
        // 将创建的ResponseMacroServiceProvider.php 文件注册
        App\Providers\ResponseMacroServiceProvider::class,

    ],
```

**修改配置文件后,需要重新加载配置**

`package.json`修改后也需要重新加载

```powershell
php composer.phar dump-autoload
```

