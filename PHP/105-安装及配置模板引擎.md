### 1.安装及配置模板引擎

安装及使用地址:[twig/twig - Packagist](https://packagist.org/packages/twig/twig)

底部:Read the [documentation](https://twig.symfony.com/documentation) for more information. 下查看文档

安装命令

```
composer require twig/twig
```

**根目录下composer.json下会多出twig**

```json
{
    "require": {
        "noahbuscher/macaw": "dev-master",
        "twig/twig": "^3.3"
    },
    "autoload": {
		"psr-4": { 
			"yyqx\\app\\":"app/"
		 }
	}
}
```

**web-project\composer.json**

```php
{
    "require": {
        "noahbuscher/macaw": "dev-master",
        "twig/twig": "^3.3"
    },
    "autoload": {
		"psr-4": { 
			"yyqx\\app\\":"app/"
		 }
	},
    "files":[
        "app/dbconfig.php"
    ]
}

```



**web-project\app\controllers\baseControllers.php**

```php
<?php
namespace yyqx\app\controllers;

class baseControllers{
    private $data=array();
    private $twig;
    // 建立模板
    function __construct(){
        $loader = new \Twig\Loader\FilesystemLoader(dirname(__DIR__).'/view');
        $this->twig = new \Twig\Environment($loader, [
            // 'cache' => '/path/to/compilation_cache',
        ]);
        
    }
    // 定义加载模板的方法
    function display($template){
        // name 为index.html 模板字符串的键{{name}},得到结果 '自己测试'
        // var_dump( $this->data);
        echo  $this->twig->render($template.'.html',$this->data);
    }
    // 分配变量的方法
    function assign($var,$vals=null){
        if(is_array($var)){
            // 合并数组
            $this->data=array_merge($this->data,$vals);
        }else{
            $this->data[$var]=$vals;
        }
    }
}
?>
```

**web-project\app\controllers\web\index.php**

```php
<?php
namespace yyqx\app\controllers\web;

use yyqx\app\controllers\baseControllers;
class index extends baseControllers{
    function show(){
        echo '这是显示前台的方法';
        // __DIR__  当前文件所在的目录
        // var_dump(__DIR__);  //'C:\wamp64\www\php\web-project\app\controllers\web'
        // 获取目录部分
        // var_dump(dirname(__DIR__)); //'C:\wamp64\www\php\web-project\app\controllers'
        // var_dump(dirname(dirname(__DIR__))); //'C:\wamp64\www\php\web-project\app'
    //     $loader = new \Twig\Loader\FilesystemLoader(dirname(dirname(__DIR__)).'/view');
    //     $twig = new \Twig\Environment($loader, [
    //         'cache' => '/path/to/compilation_cache',
    //     ]);
    //     // name 为index.html 模板字符串的键{{name}},得到结果 '自己测试'
    //     echo $twig->render('web/index.html', ['name' => '自己测试',"date"=>"第二个替换文字"]);

        // 分配变量
        $this->assign('data',"替换的变量");
        $this->display('/web/index');
    }
}
?>
```

**web-project\app\view\web\index.html**

**模板**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    这是一个HTML 文件{{data}}
</body>
</html>
```

**web-project\index.php**

```php
<!-- 主入口文件 -->
<?php
// 包含路由组件
require('vendor/autoload.php');
// 包含
use \NoahBuscher\Macaw\Macaw;

// Macaw::get('/', function() {
//     echo '这是主页目录';
//   });
//   // 配置.htaccess 路由规则 才能访问到
// Macaw::get('/goods', function() {
//     echo '这是商品目录';
//   });



  // 命名空间 yyqxx/app/controllers/admin/admin@index admin类下的index 方法(命名空间下的amdin)
  // 需要在根目录下的composer.json 配置路由才能识别这个类的路径
  // Macaw 下的composer.json 配置无效,不要搞错
  // "autoload": {
	// 	"psr-4": { 
	// 		"NoahBuscher\\Macaw\\": "./",
	// 		"yyqx\\app\\":"app/"  当访问到yyqx\\app\\ 下,路径指向app下面 ,\\表示转义成\
	// 	 }
	// }
  // 配置后需要在根目录下执行命令composer dump-autoload 重新加载
  // 返回结果
  // Generating autoload files
  // Generated autoload files
  // 在 composer 下的autoload_psr4.php 会加载这个配置,执行命令才会重新加载
  // 加载出'yyqx\\app\\' => array($baseDir . '/app'),
  // 后台
  $admin='yyqx\app\controllers\admin\\';
  // 前台
  $web='yyqx\app\controllers\web\\';
Macaw::get('/admin', $admin.'admin@index');
Macaw::get('/admin/show', $admin.'admin@show');

Macaw::get('/',$web.'index@show');

Macaw::dispatch();
?>

```

### 2.模板语法

```php
 //解析字符串
{{data}} 

//遍历一维数组
{% for item in datas%}
{{item}}
{%endfor%}

//循环10次
{%for i in 0..10 %}
{{i}}
{%endfor%}

//流程控制
{% if item.sex==0%}
女
{% elseif item.sex==1%}
男
{%else%}
保密
{%endif%}

//三目运算符
{{item.sex==0?'男':'女'}}

//输出常量
{{constant(NAME)}}

//过滤器 date是系统自带的,注意要先设置时区,不然时间不准确date_default_timezone_set("PRC");
{{time1 | date("Y/m/d H:i:s")}}

//解析标签
{% autoescape false%}
{{'<h1>哈哈哈</h1>'}}
{% endautoescape%}

//继承(导入)其他的html 模板
{% extends 'index1.html'%}
//index1.html
内容..
    需要在被导入文件中留有至少一个空间块(content 为自定义变量名),其他文件导入后才能在其自己的文件中添加其他内容
{% block content  %}{%endblock%}
//导入index1.html 的文件,需使用
{% block content  %}
内容,被替换到index1.html 的块空间
{%endblock%}

//包含文件
{% include 'index2.html'%}
```

**web-project\app\bdconfig.php**

```php
<?php

date_default_timezone_set("PRC");
// 模板用来导入常量,在composer.json 中配置
// "files":[
//     "app/dbconfig.php"
// ]
// 执行命令 composer-dumpautoload
// prs_4.php文件自动加载
const NAME="哈哈哈";

// 在index.html 模板中使用{{constant(NAME)}} 输出
?>
```

**web-project\vendor\composer\autoload_psr4.php**

```php
<?php

// autoload_psr4.php @generated by Composer

$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    'yyqx\\app\\' => array($baseDir . '/app'),
    'Twig\\' => array($vendorDir . '/twig/twig/src'),
    'Symfony\\Polyfill\\Mbstring\\' => array($vendorDir . '/symfony/polyfill-mbstring'),
    'Symfony\\Polyfill\\Ctype\\' => array($vendorDir . '/symfony/polyfill-ctype'),
    'NoahBuscher\\Macaw\\' => array($vendorDir . '/noahbuscher/macaw'),
);

```

