### 1.长连接

- 简单介绍

  保持持续连接

- 作用

  实时获取消息

- 实现方式

  - 轮询(定时器不断请求,请求到消息时,停止请求)

  - 长轮询

    不间断发送请求,请求等待服务器(阻塞)返回数据时,再次发送请求,适用聊天

  - SSE

    - Server Sent Event

      浏览器向服务器发送一个HTTP 请求,然后服务器不断单向的向浏览器推送'信息'

    - 客户端

      ```php
      var es=new EventSource('./server.php')
      es.addListener('message',function(e){
          console.log(e.data)		//数据aaa
      })
          //监听指定事件test
      es.addListener('test',function(e){
          console.log(e.data)		//数据aaa
      })
      ```

    - 服务器端(server.php)

      ```php
      header('Content-type:text/event-stream');
      
      while(true){
          //event:test 指定事件的监听才能返回数据,没有指定事件的监听,使用默认的message 就可以监听到
          echo "data:数据aaa\nevent:test\n";
          //echo "data:数据aaa\n\n";
          //如果存在输入缓冲区,echo 的输入都将进入输出缓冲区,如果不存在输出缓冲区,会直接返回数据给客户端
          //强制清除输出缓冲区,将数据返回给客户端,需要同时使用两个函数
          ob_flush();
          flush();
          sleep(3);
      }
      ```

      

  - Socket.io

    - 是什么?

      > 是一个nodejs 平台下的javascript 软件包

    - 作用

      > 能够实现客户端和服务端的双向实时通信

    - 使用

      - 安装依赖包

        ```
        express 和 socket.io 和 ejs
        ```

      - 服务端app.js(文件名随意)

    - 网址

**socket 示例**

**服务端**

```js
//app.js
//引入express 包
var express =require('express');

//创建应用
var app=express();

//静态目录设置
app.use(express.static('./static'));
//模板引擎配置
app.set('views','./views');	//模板目录
app,set('view engine','ejs')	//使用引擎

//创建http 服务
var server=require('http').createServer(app);

//创建socket 服务
var io=require('socket.io')(server);

//路由
app.get('/',function(req,res){
    res,render('index')
})

//监听socket 连接
io.on('connection',function(socket){
	//接收,监听message 的事件,名称任意,只要和发送emit 的事件名一致即可
    socket.on('message',function(data){
        console.log(data)
    })
    
    //发送
    setInterval(function(){
        socket.emit('message','嘿嘿嘿');
        //广播发送,给所有客户端发送消息
       // socket.broadcoast.emit('message','嘿嘿嘿');
    },2000)
})

//监听端口
server.listen(8080);
console.log('server is running port 8080')
```

**客户端**

```html
<script scr='/socket.io/socket.io.js'></script>
<script>
	//创建socket 客户端
    var socket =io()
    
    //监听指定频道(事件名)
    socket.on('message',function(data){
        console.log(data)
    })
    
    //发送到指定message 频道
    socket.emit('message','客户端发来的内容')
</script>
```

