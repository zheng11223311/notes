### 1.错误异常处理

1. 网站报错结果
   1. 给懂程序的人看
      1. 懂程序的人->泄露网站信息->想办法破解->添加广告病毒->用户登入发全是广告病毒->下次不再来->人气下降->没有流量->没钱->失业->继续没钱->没媳妇->没孩纸->没人养老->孤独终老
   2. 给不懂程序的人看
      1. 不懂程序的人看>下次不再来->人气下降->没有流量->没钱->失业->继续没钱->没媳妇->没孩纸->没人养老->孤独终老
2. 如何防止报错
   1. 打开php.ini 文件,搜索error ,显示各种报错等级
   2. 认识错误

```
E_ALL 	所有错误
E_ERROR	致命性的错误(程序已经运行不下去了)
E_WARNING	警告级别的错误(还能运行,但是已经报警了)
E_NOTICE	提示级别的错误(轻微的一个错误)
E_STRICT	编码标准化警告
E_CORE_ERROR	PHP 启动时初始化过程中的错误(即PHP 没有启动成功)
E_CORE_WARNING	PHP 启动时初始化过程中的警告
E_COMPILE_ERROR	编译时的致命性错误
E_COMPILE_WARNING	编译时的警告性错误
E_USER_ERROR	用户自定义的致命性错误
E_USER_WARNING	用户自定义的警告性错误
E_USER_NOTICE	用户自定义的提示错误
...
```

**2.错误的三个级别**

```php
<?php
//提示错误	算不上错误
echo $name;	//没有$name

//警告错误	不会终止程序的运行
include './aaaa.txt';	//没有这个文件

//致命性错误    会终止程序的运行
//连接MySQl 数据库的函数
//$link=mysqli_connect('127.0.0.1','root','');	//IP地址127.0.0.1,默认root,密码默认为空
$link=mysqli_connect('127.0.0.1','root','xxx');	//密码错误
var_dump($link);

    
?>
```

**3.如何解决错误**

1.让该看到的人看到

2.让不该看到的人看不到(老板,客户,黑客)

1. 使用错误抑制符@,抑制错误,只能屏蔽单行错误而且效率低
2. 修改php.ini 文件的display_errors 的On 为Off,重启apache  (设置为On 为显示所有错误,Off 为不显示所有错误)
3. 修改php.ini 文件的error_reporting 为E_ALL &~E_NOTICE &~E_WARNING,重启apache   (表示显示所有错误,除了E_NOTICE 和 E_WARNING 错误不显示, & 表示并且, ~ 表示除了)
4. 使用error_reporting() 函数,可以和配置文件中的error_reporting  选项设置实现相同的效果,设置的值也是一样的

```php
<?php
@echo $name;	//没有$name

@include './aaaa.txt';	//没有这个文件

@$link=mysqli_connect('127.0.0.1','root','xxx');	//密码错误
var_dump($link);
?>
```

```php
<?php
// & 表示并且, ~ 表示除了
error_reporting(E_ALL &~E_NOTICE &~E_WARNING);
echo $name;	//没有$name

include './aaaa.txt';	//没有这个文件

$link=mysqli_connect('127.0.0.1','root','xxx');	//密码错误
var_dump($link);
?>
```

### 2.错误日志输出: 让该看到的人看到(网站开发人员)

1. 关闭配置文件中的display_errors,display_errors  设置为Off
2. 设置错误的存储类型,设置配置文件中的error_repeating 选项指定需要存储的错误类型
3. 开启错误日志记录的开关,设置配置文件中的log_errors=On
4. 找到配置文件error_log=syslog 注释掉,syslog 默认错误记录位置 (window 系统错误位置 ==> 控制面板->管理工具->计算机管理->事件查看器->Windows 日志),尽量不要用
5. 修改error_log=syslog  上方的error_log="自己指定文件的位置/php_error(自定义文件名).log"

### 3.比较灵活的处理错误的方式:

**set_error_handler() 用户接管错误处理方式**

**注意:对于回调函数需要接收至少4个参数,分别是错误号,错误内容,错误文件,及错误所在的行**

```php
<?php
set_error_handler('doError');	//自定义回调函数doError


echo E_NOTICE;	//8	不同错误的错误号
echo E_WARNING;	//2
echo $name;	//没有$name

include './aaaa.txt';	//没有这个文件

$link=mysqli_connect('127.0.0.1','root','xxx');	//密码错误
var_dump($link);

//制作错误回调函数 这里必须接收4个参数,还有1个可选参数,省略没写
function doError($error_no,$error_str,$error_file,$error_line){
    $error='当前错误号为'.$error_no."\r\n错误内容为:".$error_str."\r\n错误文件为:".$error_file."\r\n错误行为:".$error_line."\r\n";
    echo $error;
    
//    设置指定错误写入到指定文件中
    switch($error_no){
        case 2:	//warning
            //写入文件函数
            file_put_contents('./warning.log',$error,FILE_APPEND);	//FILE_APPEND 表示追加,不写默认覆盖
            break;
        case 8:	//notice    
            file_put_contents('./notice.log',$error,FILE_APPEND);
            break;
    }
}
?>
```

