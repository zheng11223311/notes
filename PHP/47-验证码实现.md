### 1.实现验证码

```php
<?php

//1.创建基于调色板的画布
$img=imagecreatetruecolor(100,40);
//2.为每一张图片分配随机颜色,使用颜色强一点的
$color=imagecolorallocate($img,mt_rand(200,255),mt_rand(200,255),mt_rand(200,255));
$color1=imagecolorallocate($img,mt_rand(200,255),mt_rand(200,255),mt_rand(200,255));
//3.使用相关函数进行绘色
    //1.将红色分配到这个画布的背景色
    $res=imagefill($img,0,0,$color);
    //2.画一个边框
    imagerectangle($img,0,0,99,39,$color1);
    //3.画干扰线
    for($i=0;$i<10;$i++){
        $color2=imagecolorallocate($img,mt_rand(150,180),mt_rand(150,180),mt_rand(150,180));
        imageline($img,mt_rand(2,98),mt_rand(2,38),mt_rand(2,98),mt_rand(2,38),$color2);

    }
    //4.画干扰点
    for($i=0;$i<300;$i++){
        $color3=imagecolorallocate($img,mt_rand(120,150),mt_rand(120,150),mt_rand(120,150));
        imagesetpixel($img,mt_rand(2,98),mt_rand(2,38),$color3);
    }
    //5.定义验证码的字符
    $str='1234567890qwertyuiopasdfghjklzxcvbQWERTYUIOPASDFGHJKLZXCVBNM';
    //定义新的字符串变量
    $len='';
    //循环挑选4个不同的字符 为了后期保存使用
    for($i=0;$i<4;$i++){
        $len.=$str[mt_rand(0,strlen($str) - 1)];
    }
    // var_dump($len);
    //循环将字符写入到画布中
    for($i=0;$i<4;$i++){
        // 定义字体的颜色
        $x=100/4*$i+mt_rand(1,8);
        $y=mt_rand(5,25);
        $color4=imagecolorallocate($img,mt_rand(10,120),mt_rand(10,120),mt_rand(10,120));
        imagechar($img,4,$x,$y,$len[$i],$color4);
    }

//4.通知浏览器图片相关信息
header("Content-type:image/png");//自己随便定义
// //5.将图片显示到浏览器还是保存到本地
imagepng($img);    //与 image/jpeg 对应,如果是jpg,使用imagejpg()



//6.释放资源
imagedestroy($img);
?>

```

**函数版验证码**

```php
<?php
function mycode($w=100,$h=40,$num=4,$fontFamily='C:\wamp64\www\php\fontFamily\STCAIYUN.TTF'){
    //1.创建基于调色板的画布
    $img=imagecreatetruecolor($w,$h);
    //2.为每一张图片分配随机颜色,使用颜色强一点的
$color=imagecolorallocate($img,mt_rand(200,255),mt_rand(200,255),mt_rand(200,255));
$color1=imagecolorallocate($img,mt_rand(200,255),mt_rand(200,255),mt_rand(200,255));
//3.使用相关函数进行绘色
    //1.将红色分配到这个画布的背景色
    $res=imagefill($img,0,0,$color);
    //2.画一个边框
    imagerectangle($img,0,0,$w - 1,$h - 1,$color1);
    //3.画干扰线
    for($i=0;$i<10;$i++){
        $color2=imagecolorallocate($img,mt_rand(150,180),mt_rand(150,180),mt_rand(150,180));
        imageline($img,mt_rand(2,$w - 2),mt_rand(2,$h - 2),mt_rand(2,$w - 2),mt_rand(2,$h - 2),$color2);

    }
    //4.画干扰点
    for($i=0;$i<300;$i++){
        $color3=imagecolorallocate($img,mt_rand(120,150),mt_rand(120,150),mt_rand(120,150));
        imagesetpixel($img,mt_rand(2,$w - 2),mt_rand(2,$h - 2),$color3);
    }
    //5.定义验证码的字符
    $str='1234567890qwertyuiopasdfghjklzxcvbQWERTYUIOPASDFGHJKLZXCVBNM';
    //定义新的字符串变量
    $len='';

    //循环挑选4个不同的字符 为了后期保存使用
    for($i=0;$i<$num;$i++){
        $len.=$str[mt_rand(0,strlen($str) - 1)];
    }
    // var_dump($len);
    // 开启session,可以做到跨页面使用变量
    session_start();
    // 将得到的验证码存储到$_SESSION['code']
    $_SESSION['code']=$len;
    //循环将字符写入到画布中
    for($i=0;$i<$num;$i++){
        // 定义字体的颜色
        $x=$w/$num*$i+mt_rand(5,8);
        $y=mt_rand(30,$h/1.2);
        $color4=imagecolorallocate($img,mt_rand(10,120),mt_rand(10,120),mt_rand(10,120));
        // imagechar($img,4,$x,$y,$len[$i],$color4);
        imagefttext($img,mt_rand($h/2.5,$h/2),mt_rand(0,45),$x,$y,$color4,$fontFamily,$len[$i]);
    }

//4.通知浏览器图片相关信息
header("Content-type:image/png");//自己随便定义
// //5.将图片显示到浏览器还是保存到本地
imagepng($img);    //与 image/jpeg 对应,如果是jpg,使用imagejpg()



//6.释放资源
imagedestroy($img);
}

mycode();
    
    
?>

```

**使用验证码图片**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    使用验证码
    <form action="./1-php copy 35.php" method="post">
    <img src="./1-php copy 33.php" alt="" srcset="" onclick="this.src='./1-php copy 33.php?'+Math.random()">
    输验证码:<input type="text" name="code">
    <input type="submit" value="提交">
</form>
    
</body>
</html>
```

**1-php copy 35.php**

```php
<?php
session_start();
//实现验证码的验证
var_dump($_POST);
//获取session 种验证码的值
var_dump($_SESSION);

if (strtolower($_POST['code'])===strtolower($_SESSION['code'])) {
   echo '成功';
}else{
    echo '失败';
}
    
    
?>
```

![Snipaste_2021-10-21_23-44-48](D:\学习\wanye\PHP\img\Snipaste_2021-10-21_23-44-48.png)

