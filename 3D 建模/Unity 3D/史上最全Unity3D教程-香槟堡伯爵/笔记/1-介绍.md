# Unity 3D 介绍

### 简介

- Unity 3D

  - 由 Unity Technologies 公司开发的用于轻松创建游戏引擎和三维互动内容的开发工具,是一个国际领先的专业游戏引擎

- 游戏

  - 在移平台,Unity 几乎成为3D 游戏开发的标准工具,使用它开发的游戏数不胜数
  - 2D 游戏: 视角完全锁定,二维坐标
  - 3D 游戏:可以任意变化视角,无锁定,三维坐标

- 虚拟现实

  - **Virtual Reality**
    - 当今世界前沿科技之一
    - 利用电脑模拟产生一个三维空间的虚拟世界,并提供视觉,听觉,触觉等感官的模拟,使用者通过各种输入设备与虚拟环境中的事物进行交互,从而产生身临其境的体验
  - **VR 设备:移动端头显设备**
    - 只需要将手机放入即可,使用方便,价格低廉,但受硬件性能制约,用户体验感不足
  - **VR 设备:外接式头戴设备**
    - 需要连接至PC ,具有更强劲的性能,更良好的体验,可以捕捉肢体动作,但价格过高,需要额外硬件的支持
  - **VR 设备: 一体式头戴设备**
    - 具备独立的运算,输入输出功能,不收空间和其它设备(PC, 手机)限制,但目前还不成熟,产品偏少
  - **VR 其它设备: Xbox One + Kinect, zSpace ....**
  - **VR 应用:**
    - 军工
    - 科研
    - 游戏
    - 视频
    - 教育
    - 旅游
    - 家装
    - 虚拟驾驶
    - 房产地项目展示
    - ....
  - **增强现实: Augmented Reality**
    - 通过电脑技术,将虚拟的信息应用到真实世界,真实的环境和虚拟的物体实时叠加到了同一个画面或空间同时存在
  - **AR 与 VR 区别**
    - VR 看到的场景和人物全是假的,是把你的意识代入一个虚拟的世界,AR 看到的场景和人物,一部分是真的,一部分是假的,是把虚拟的信息带入到现实世界中

- 游戏引擎

  - 程序的框架,一款游戏最最核心的代码
  - 包含以下系统: 渲染引擎,物理引擎,碰撞检测系统,音效,脚本引擎,动画系统,人工智能,网络引擎,以及场景管理
  - 使用游戏引擎,开发者可以重用已有的核心技术,将精力集中在游戏逻辑和设计上,从而简单快速的创建游戏

- Unity 特点

  - 简单易用

  - 开发效率高

  - 价格便宜

  - 新手居多

  - 23 个平台自由迁移,出色的部署,完全的覆盖

    发布平台包括:`IOS`,`Android` ,`Windows Phone`,`Windows` , `Web` ,`微软Xbox360`,`索尼PS3`,`任天堂Wii` 等

  - **全球游戏引擎市场份额**

    - unity 45%
    - closest competitor 17%
    - Others 38%

- 著名游戏公司的加入

  - 2014 年10月 ,Unity 公司创始人兼CEO 宣布转任执行副总裁,接替他的人选是曾任EA 公司CEO 的约翰.里奇蒂耶洛(John Riccitiello)
  - 2015 年5 月,Unity CEO 宣布,前 Epic Games 总裁,迈克.卡普斯(Mike Capps) 将会正式加入Unity
  - **使用Unity 3D 开发的游戏**
    - 腾讯游戏---全名破坏神,我叫MT2 
    - 搜狐畅游---天空八部3D ,秦时明月2
    - 完美世界---格斗宝贝,御天降魔传
    - ....

- 历史

  - 2004 年丹麦哥本哈三位热爱游戏的年轻人决定开发一个易于使用的,与众不同并且费用低廉的游戏引擎,帮助所有喜爱游戏的年轻人实现游戏创作梦想
  - 2005 年发布了Unity 1.0 版本,并将总部设在美国旧金山
  - 2007 年发布员了Unity 2.0 版本---新增了地形引擎,实时动态阴影,网络多人联机功能等
  - 2009 年发布了Unity 2.5 版本---推出Windows 版本,支持IOS 和WII 任天堂游戏机
  - 2010 年发布了Unity 3.0 版本----支持Android 平台
  - 2012 年发布了Unity 4.0 版本--- 支持Web 及其他游戏平台
  - 2012 年Unity 上海分公司成立,正式进军中国市场
  - 同年苹果公司一份报告,在App Store 中55% 的3D 游戏都是使用Unity 开发的,而Android 的市场应该比苹果更大
  - 截止2013 年6月, Unity Technologies 公司在中国,加拿大,丹麦,英国,日本,韩国,立陶宛,瑞典等国家和地区都建立了相关机构,在全球拥有30 个不同国家和地区的超过290 名雇员
  - 2015 年3 月发布Unity 5.0 版本--包括了许多新功能及改进,如:实时全局光照,音频,动画系统等

- 游戏公司大致分工

  - 策划
  - 美工
  - 软件工程师
  - 测试工程师
  - 客服等



### 课程体系

- **Unity 引擎基础**
  - Unity 环境搭建
  - C# 语言的基础
  - Unity API
  - 物理引擎1
  - 3D 数学基础
  - UGUI
- **Unity 高级应用**
  - Unity  高级组件
  - IO,协程,多线程
  - Unity 高级组件应用
  - 常用数据结构
  - AR 项目,VR 项目
  - NGUI-ARPG 项目贯穿
  - 美术资源性能优化
  - Shader
- **游戏架构设计**
  - 面向对象
  - 类库开发
  - 设计模式
  - 人工智能
- **完整项目实战**
  - 美术规范化及优化
  - XML 及JSON
  - 数据库
  - 项目制作



### 工具介绍

- 面板
  - Project 项目资源面板
  - Hierarchy 层次面板
  - Scene 场景面板
  - Game 游戏面板
  - Inspector 检视面板
- 工具条
  - 变换工具
  - 变换切换
  - 播放控件
  - 视图





### 安装及创建项目注意事项

- 必须要为英文路径,否则创建失败

- project 右键导入/导出 成一个package 文件(包文件),便于导入/导出这个项目

- unity 对每个项目都有一个唯一的标识,所以不要再资源管理器中对文件进行移动或其他操作

- Game 游戏面板,你所做的画面在游戏中所显示的画面就是Game 所显示的那样

- 上方的播放按钮 为播放游戏动画效果






### 鼠标操作

- 右键->移动鼠标,旋转效果

- 按下鼠标滚轮->移动鼠标->前进后退,拖动效果

- 选中一个物体,按f 键,使物体居中在屏幕中间/或在hierarchy(层级) 面板双击物体

- alt +左键,围绕物体旋转

- 点击右键同时按下W /S /A /D ,实现场景漫游

- **顶点吸附**:对两个物体进行对齐,吸附在一起

- 选中一个物体,按下V 键不放,按下选中物体上的一个点,,不松开鼠标并移动鼠标,靠近另一个物体时,会自动吸附过去


- ctrl+D 复制并粘贴




### hierarchy(层级)面板

- 显示当前场景中所有游戏对象的层级关系
- 包含了当前场景的游戏对象(GameObject) ,其中一些是资源文件的实例,如3D 模型和其他预制组件的实例

**右键->3D 对象,创建新的物体**



### Inspector 检视面板(检查器)

- 显示当前选定游戏对象附加的组件及其属性信息
- 为重要游戏物体选择图标



### 变换切换

- 左边是改变游戏对象的轴中心
  - Center ：设置轴心点在物体中心	
  - Privot： 使用物体本身的轴心
- 右边是改变物体的坐标
  - Global： 世界坐标，即模型在场景中的坐标
  - Local ：自身坐标，即模型自身的坐标轴



### 播放控件

- 从左到右依次是 预览游戏,暂停游戏,逐帧播放
- 查看游戏最终运行后的画面,在运行模式下,任何更改都只是暂时的,在退出运行时会重置复位



### 视图

- `IOS`:正交观察模式
- `Persp`:透视观察者模式(近大远小)
- `视图角度`:上下左右前后



### 基础概念

- 坐标
  - 坐标：`X 红色,Y 绿色,Z 蓝色`
  - 世界坐标:`整个场景的固定坐标,不随物体旋转而改变`
  - 本地坐标:`物体自身坐标,随旋转而改变`
- 场景Scene
  - 一组相关联的游戏对象的集合,通常游戏中每个关卡就是一个场景,用于展现当前关卡中的所有物体
- 物体
  - 游戏对象GameObject
  - 运动时出现在场景中的游戏物体
  - 例如:人物,地形,树木....
  - 是一种容器,可以挂载组件
  - 父,子物体
    - 在Hierarchy(层级)面板中,将一个物体拖拽到另一个物体中
    - 子物体将继续继承父物体的移动,旋转和缩放属性,但子物体不影响父物体
- 组件Component
  - 是游戏对象的功能模块
  - 每一个组件都是一个类的实例
  - Transform 变换组件:`决定物体的位置,旋转,缩放比`
  - Mesh filter:`网格过滤器:用于从资源中获取网格信息(获取顶点信息)`
  - Mesh Renderer 网格渲染器:`从网格过滤器中获得几何形状,在根据变化组件定义的位置进行渲染`
  - 网格过滤器 与网格渲染器 联合使用,使模型显示到屏幕上
  - 创建立方体
    - 创建空物体:层级面板中,右键->创建空对象(其实只要选中一个物体即可)
    - 创建网格过滤器:在选中物体的基础上,在检查器(Inspector) 最下方点击添加组件->Mesh(网格)->Mesh filter(网格过滤器)->Mesh->点击右方的小点,选择网格(即形状)
    - 创建网格渲染器:在选中物体的基础上,在检查器(Inspector) 最下方点击添加组件->Mesh(网格)->Mesh Renderer( 网格渲染器)->Maters->点击右方的小点,选择材质



在层级面板中,选中一个物体,拖动到另一个物体上,就会形成父子级关系,会显示文件夹层级的样子

此时子物体调整的位置是相对于父物体,而不是相对于世界坐标

一般以空对象(即空物体)为父物体





# 材质Material

- 简介
  - Material
  - 纹理,着色器与材质的关系
  - 物理着色器
- 属性
  - Rendering Mode
  - Main Maps



### Material

- 材质:物体的质地,指色彩,纹理,光滑度,透明度,反射率,折射率,发光度等,实际就是Shader 的实例
- Shader 着色器:专门用来渲染3D 图形的技术,可以使纹理以某种方式展现,实际就是一段嵌入到渲染管线中的程序,可以控制GPU 运算图像效果的算法
- Texture 纹理:附加到物体表面的贴图

> 创建材质并使用

在Project(项目),选中文件夹并右键->创建->材质,选中创建的材质,在检查器(Inspector)中的Main Maps 下的反射率 选择右边的吸管->自己选择材质颜色

选中场景中的物体,在检查器(Inspector) 中的网格渲染器(如果没有,需要自己在底部点击添加组件,添加网渲染器) 中的材质(material) ,将项目层级中的材质拖动到其中,场景中的物体就会使用其材质

**即材质必须给网格渲染器才能生效**



### 纹理贴图

将Project 项目中的图片拖动至场景中的物体上,就会形成贴图**(需要先在网格渲染器中使用材质)**

实质上,是在(选中物体时)Inspector 检查器面板中创建了一个Material 材质,在其中`Main Maps` 中的反射率 左边显示以映射的纹理图片(可以将图片拖动至此处,纹理图片也会加载进来)

同时在项目中会创建一个Materials 文件夹,里面存放着纹理图片



### Rendering Mode 渲染模式

Material 材质,在其中`Main Maps` 上方有一个Rendering Mode ,其中选项:

- Opaque 不透明
  - 此时图片完全无修改当做纹理图片
- Cutout 显示透明效果,并显示器透明的地方
  - 如果有些图片是抠出来的图片,会有背景透明度,此模式会显示其透明效果,并显示器透明的地方
- Fade 显示透明效果,但不显示其器透明的地方
  - 同上,但不显示其器透明的地方,用于淡入淡出现象
- Transparent 透明的材质
  - 使用此模式,会是整个物体显示为透明效果(不会显示纹理图像,且整个物体透明,Fade 也可以同样操作,但是会显示带有透明度的纹理图像),需要在反射率中调节颜色透明度a 通道



### 物理着色器

- 基于物理特性的Shader 是Unity 5.x 的重大革新之一,所谓物理着色器(Physically Based Shading ,PBS) 就是遵从物理学的能量守恒定律,可以创建出在不同光照环境下都接近真实的效果



### Main Maps

- Albedo 基础贴图:决定物体表面纹理与颜色
- Metallic 金属:使用金属特性模拟外观
- Spercular 镜面反射:使用镜面特性模拟外观
- Smoothness 光滑度:设置物体表面光滑程度
- Normal Map 法线贴图:描述物体表面凹凸程度
- Emission 自发光:控制物体表面自发光颜色和贴图
  - --None 不影响环境
  - Realtime 实时动态改变
  - Backed 烘焙生效
- Tilling 平铺:沿着不同的轴,纹理平铺个数
- Offset 偏移:滑动纹理



### 纹理,着色器与材质的关系

![](D:\学习\wanye\3D 建模\Unity 3D\史上最全Unity3D教程-香槟堡伯爵\笔记\img\1-1.png)

Material 只是Shader 的一个面板,MAterial 中所拥有的功能都是Shader 所赋予的



### Shader

shader 文件以 `.shader` 结尾,可以使用 vs(c# 专用的vs) 编辑器打开并进行编辑

在Project 项目中,将.shader 文件拖入材质.mat文件,即为此材质设定指定的shader(即在Inspector  视图层级中材质的shader 属性)



# 摄像机Camera

### 简介

- 附加了摄像Camera 组件的游戏对象
- 向玩家捕获和显示世界的设备
- 场景中摄像机的数量不受限制



### 组件

- Transform 变换组件
  - 相机的旋转,缩放(注意:缩放对摄像机没有效果),平移
- Camera 摄像机:向玩家捕获和显示世界
- Flare Layer 耀斑层:激活可显示光源耀斑
- GUI Layer: 激活可渲染二维GUI 元素
- Audio Listener 音频监听器:接收场景输入的音频源Audio Source 并通过计算机的扬声器播放声音
- ![](D:\学习\wanye\3D 建模\Unity 3D\史上最全Unity3D教程-香槟堡伯爵\笔记\img\1-2.png)

### 属性

(选中相机后,Inspector 检查器层级下的属性)

- Clear Flags 清除标识;决定屏幕的空白部分(场景中所有没有物体的部分)如何处理
  - Skybox 天空盒:空白部分显示天空盒图案
  - Solid Color 纯色:空白部分显示背景色
  - Depth Only 仅深度:画中画(一个画面叠加到另一个上面)效果时,小画面摄像机选择该项可清除屏幕空部分(即空白部分)信息,只保留物体的颜色信息(需要小屏的深度值大于主屏,才能使小屏显示在主屏上方)
  - Dont Clear 不清除:不清除任何颜色或深度缓存,不怎么使用,会出现花屏现象
- background 背景:所有元素绘制后,没有天空盒的情况下,剩余屏幕的颜色
- Culling Mask 选择/剔除遮蔽层:选择要照射的层Layer,即用于隐藏物体的遮罩层
- Projection 投射方式:
  - Perspective 透视:透视图,物体具有近大远小效果
  - Orthographic 正交:摄像机会均匀的渲染物体,没有透视感,通常小地图使用
- Size 大小(正交模式):摄影机视口的大小
- Field of view 视野(透视模式):设置相机视野的远近距离
- Clipping Planes 裁剪面:相机到开始和结束渲染的距离
  - Near 近:绘制的最近点,镜头拉近
  - Far 远:绘制的最远点,镜头拉远
- Viewport React 视图大小
  - 渲染在显示屏上显示的大小
  - w: 宽度, 0-1,1 为全屏宽度
  - h 高度 ,0-1
  - X 摄像机输出在X轴的位置,当渲染的w,h 不是全屏的时候,需要移动位置
  - Y Y 轴位置
- Depth 深度值 ,如果两个摄像机同时显示画面(比如游戏的小地图),决定哪一个摄像机显示在最上层
- 即决定谁先渲染,值越小越先渲染,后渲染的画面覆盖先渲染的画面
- 如果两个摄像机的深度值都一样,后修改的值在最上面



### 天空盒

- 围绕整体场景的包装器,用于模拟天空的材质
- 天空盒材质种类:6 Sided(6个面组成), Procedural (程序的),Cubemap
- 在Inspector 检查层级中的Masterial 中的Shader  属性的skybox 选项中

- 使用天空盒
  - 设置摄像机Clear Flags 属性为Skybox
    - 方式一:摄像机在Inspector 检查层级中点击添加组件->Skybox
      - 将天空盒材质拖入skybox 的custom Skybox 属性中,即可实现场景中的天空盒
    - 方式二:光照窗口
      - Window-> Lighting-> Environment Lighting -->Skybox
      - 现在版本是Window-> Rendering-> Lighting settings 
      - 其中环境 属性中有一个天空盒材质(Sky box) 属性
      - 可作为反射源将天空色彩反射到场景中物体
  - 如果场景中没有显示天空盒,在场景窗口中选择下拉三角形,勾选天空盒
  - ![](D:\学习\wanye\3D 建模\Unity 3D\史上最全Unity3D教程-香槟堡伯爵\笔记\img\1-3.png)



### 6 Sided 属性

- Tint COlor 色彩
- Exposeure 亮度
- Rotation 旋转



### Procedural 属性

- Sun 太阳模式
  - None 场景中没有太阳
  - Simple 简单,外圈无光晕
  - Height Quality 高质量,外圈有光晕
  - Atmoshpere Thickness 大气层厚度
  - Ground 底面颜色
  - 如果为Environment Lighting 的Sun 属性设置一个平行光,场景中会根据平行光角度自动创建太阳,并且位置随平行光旋转而改变,如果不设置,系统将默认选择场景中最亮的平行光
- Sky Tiny 天空颜色
- Ground 地面颜色
- Exposeure 亮度



**shift+f 将摄像机移动到视图中指定位置**

选中一个物体,按shift+v 将,摄像机对准到物体上

**ctrl+shift+f 将摄像机移动到视图中指定位置**

选中一个物体,按shift+v 将摄像机对准到物体上,水平方向与物体一致

多个相机可以显示多个画面,但是只能有一个监听音频声音的,其他相机需要在Inspector 检查层级 面板中,选择相机的属性中的 监听音频Audio Listener 属性,右键移除

相机如果使用拍摄俯视图画面,建议使用正交相机拍摄,透视图会导致近大远小,高大的树会产生巨大的遮挡

俯视图下,要想小地图上一样使任务变成一个点,只需要在任务上方增加一个平面,增加三角形的方向 纹理

使用摄像机的layer 属性 用于隐藏物体的遮罩层



### layout 遮蔽层

选中摄像机,在Inspector 中 的图层(Layout,默认属性值为Default) ,点击选着框,选择添加图层,添加一个自定义图层名

重新点击选着框,点击自己定义好的图层

在相机的 Culling Mask 选择/剔除遮蔽层 属性中,勾选自己定义的图层,即表示显示该图层

给人物物体的图层(Layout,默认属性值为Default) 添加一个自己定义好的图层

实际上,小地图不会再使用一个相机拍摄,而是使用一张图片替代,节省渲染开销



# InstantOC

- 渲染管线
  - 顶点处理
  - 图元配置
  - 光栅化
  - 像素处理
  - 缓存

- Occlusion Culling
  - 即时遮挡剔除
  - 步骤
  - 属性

- LOD
  - 多细节层次
  - 步骤
  - 属性





### 渲染管线

- 图形数据在GPU 上经过运行处理,最后输出到屏幕的过程

游戏-------->图形API------------>CPU 与GPU 分界线----------------->顶点处理-------->图元装配---------->光栅化------->像素处理------>缓存

绘制调用(Draw Call) : 每次引擎准备数据并通知GPU 的过程,通俗讲,每帧调用显卡渲染物体的次数

在游戏场景中,上方导航栏中的状态(status) 属性中有Batches:6 即绘制调用(Draw Call) 的次数,即一帧调用6次

存在一个物体Batches 就会+1 ,但是存在光的情况下,增加就不止1 ,因为光照是非常复杂的



### 顶点处理

- 接收魔性顶点数据
- 坐标系转换



### 图元装配

- ​	组装面:连接相邻的顶点,绘制为三角面



### 光栅化

- 计算三角面上的像素,并为后面着色阶段提供合理的插值参数



### 像素处理

- 对每个像素区域进行着色
- 写入到缓存中



### 缓存

(缓存数据,不用每次计算)

- 一个存储像素数据的内存块,最重要的缓存数据是帧缓存与深度缓存
- 帧缓存:存储每个像素的色彩,即渲染后的图像,帧缓存常常在显存中,显存不断读取并输出到屏幕中
- 深度缓存z-buffer: 存储像素的深度信息,即物体到摄像机的距离,光栅化时便计算各像素的深度值,如果新的深度值比现有值更近,则像素颜色被写到帧缓存,并替换深度缓存的值