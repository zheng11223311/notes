**Node.js Stream(流)**

> stream 是一个抽象接口,Node 中有很多对象实现了这个接口,例如,对http 服务器发起请求的requests 对象流是一个Stream ,还有stdout(标准输出)
>
> Node.js 有四种流类型:
>
> Readable:可读操作
>
> Writeable:可写操作
>
> Duplex:可读可写操作
>
> Transform:操作被写入数据,然后读出结果
>
> 所有的Stream 对象都是EventEmitter的实例,常用的事件有:
>
> data:当有数据可读时触发
>
> end:没有更多的数据可读时触发
>
> error:在接收和写入过程中发生错误时触发
>
> finish:所有数据已被写入到底层系统时触发

**从流中写入文件**

```js
//index.js 文件
// 文件流
//文件流的flags 都带了s
let fs =require('fs')

//1.创建写入流
//语法:fs.createWriteStream(文件路径,可选的配置操作)
let ws=fs.createWriteStream('hello.txt',{flags:'w',encoding:'utf-8'})
console.log(ws);        //ws 对象的各种属性方法

// 监听事件
ws.on('ready',function(){
    console.log('文件准备写入状态');
})

ws.on('open',function(){
    console.log('文件打开了');
})
ws.on('close',function(){
    console.log('文件写入完成');
})

// 文件流失写入,当一个文件特别大时,内存不够读取所有的文件,流失一部分一部分的写入
ws.write('hello写入',function(err){
   if(err){
        console.log(err);
   }else{
       console.log('内容流入完成');
   }
})

// 流失写入，逐个写入
ws.write('内容流入流式写入11111',function(err){
   if(err){
        console.log(err);
   }else{
       console.log('内容流入完成');
   }
})


ws.write('内容流入流式写入111111222222222',function(err){
   if(err){
        console.log(err);
   }else{
       console.log('内容流入完成');
   }
})


ws.write('内容流入流式写入111113333333333',function(err){
   if(err){
        console.log(err);
   }else{
       console.log('内容流入完成');
   }
})


ws.write('内容流入流式写入11111444444444',function(err){
   if(err){
        console.log(err);
   }else{
       console.log('内容流入完成');
   }
})
ws.end(function(){
    console.log('文件写入关闭');
})

// 文件打开了
// 文件准备写入状态
// 内容流入完成
// 内容流入完成
// 内容流入完成
// 内容流入完成
// 内容流入完成
// 文件写入关闭
// 文件写入完成
```

**从流中读取文件**

```js
//index.js 文件
// 从流中读取文件
 let fs =require('fs')

//  创建读取流，语法：fs.createReadStream(路径,可选配置项)
let rs=fs.createReadStream('hello.txt',{flags:'r',encoding:'utf-8'})

rs.on('open',function(){
    console.log('读取的文件打开');
})

rs.on('close',function(){
    console.log('读取流结束');
})

// 每一次部分数据流入完成(批量读取数据)
//视屏等大文件会有分批效果   大小>65536 kb
// 可以将读入的视屏写入自己的.MP4 文件,相当于复制视频
rs.on('data',function(data){
    console.log('单批数据流入'+data.length);  //单批流入数据的最大大小65536 kb
    console.log(data);      //返回的数据
})

// 读取的文件打开
// 单批数据流入
// hello写入内容流入流式写入11111内容流入流式写入111111222222222内容流入流式写入111113333333333内容流入流式写入11111444444444

// 读取流结束

```

**视屏的读入和写入**

```js
//index.js 文件
 let fs =require('fs')
let rs=fs.createReadStream('1.mp4',{flags:'r'})  //不需要ut-8
let ws=fs.createWriteStream('a.mp4',{flags:'w'})

rs.on('open',function(){
})

rs.on('error',function(){
})

rs.on('close',function(){
    ws.end()  //读取完时关闭
})

rs.on('data',function(data){
     console.log('单批数据流入'+data.length);
    console.log(data);      //返回的数据
    ws.write(data,function(){
        console.log('单批输入流入完成');
    })
})
```

**管道流**

> 管道提供了一个输出流到输入流的机制,通常我们用于从一个流中获取数据并将数据传递到另外一个流中
>
> 
>
> 教程官网:www.sxt.com
>
> 管道流直接将读入的视屏写入到b.mp4 文件

```js
//index.js 文件
// 管道流
 let fs =require('fs')
let rs=fs.createReadStream('1.mp4',{flags:'r'})  //不需要ut-8
let ws=fs.createWriteStream('b.mp4',{flags:'w'})

rs.on('open',function(){
})

rs.on('close',function(){
    ws.end()  //读取完时关闭
})

rs.pipe(ws)
```



