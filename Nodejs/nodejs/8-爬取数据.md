**axios 库**

安装 npm install axios

**axios 请求**

```js
//index.js 文件
let axios=require('axios')
console.log(axios);

let httpUrl='https://www.dytt8.net/index.htm'
// let httpUrl='https://www.qweather.com/'
axios.get(httpUrl,{
    headers:{
        'X-Requested-With':'XMLHttpRequest',
        'User-Agent':'Mozilla/5.0',
        "Upgrade-Insecure-Requests":1
    }
}).then(res=>{
    console.log(res);
})
```

**reuqest 库**

安装 npm i request

**request 请求**

```js
//index,js 文件
let request= require('request')
console.log(request);
let httpUrl='https://www.dytt8.net/index.htm'
let httpUrl='https://www.qweather.com/'
request.get(httpUrl,(err,response,body)=>{
    console.log(err);
    console.log(response);
    console.log(body);
})       //会有乱码问题
```

**解决reuqest 请求乱码问题**

```js
//index.js 文件
// 对于gb2312编码的网页，直接用request去获取会得到乱码的结果，解决方法很简单：
let request= require('request')
// npm install iconv-lite
var iconv = require('iconv-lite');
let httpUrl='https://www.dytt8.net/index.htm'
request.get({
    url:httpUrl,
    encoding:null,      //让body 直接拿buffer
},(err,response,body)=>{
    console.log(err);
    console.log(response);
    var buf =  iconv.decode(body, 'gb2312');
    console.log(buf);
})
```

**爬取1905 网站视频信息**

```js
//index.js 文件
let request= require('request')
let fs=require('fs')
// npm install iconv-lite
var iconv = require('iconv-lite');
let httpUrl='https://www.1905.com/vod/list/n_1/o3u1p1.html?fr=vodhome_js_lx'
 var url_list=[]
request.get({
    url:httpUrl,
    encoding:null,      //让body 直接拿buffer
},(err,response,body)=>{
    // console.log(err);       //null
    // console.log(body.toString());  //将缓冲区的二进制转化为内容(字符串)
    // console.log(response);       //response.statusCode == 200 状态码
    var buf =  iconv.decode(body, 'gb2312');
    // console.log(buf);
    let reg=/<span class="search-index-L">类型(.*?)<div class="grid-12x">/igs
    //  s表示可以匹配换行符
    
    // 解析html 内容
    let result=reg.exec(body)[1]
    // exec() 方法用于检索字符串中的正则表达式的匹配。
    // 如果字符串中有匹配的值返回该匹配值，否则返回 null
    // console.log(result);     //获取到一个数组,打印一下,取出第一个 
    //result 0 或1 都取出一样的?



    // 获取起始页面的所有分类
    // 正则.exec(str)   每次执行exec(),循环匹配下一个,直到没有 显示null
    // [
    //   `这一次匹配到的第一个内容`,
    //   `(.*?)匹配到的内容`,
    //   '',
    //   index: 67,
    //   input:   文本
    // ]
    //str.match(正则) 
    //str.search(正则) 
    //test
    let reg1=/onclick="location\.href='(.*?)';return false/igs
    let result1=reg1.exec(result)
    let result2=reg1.exec(result)
    let result3=reg1.exec(result)
    let result4=reg1.exec(result)
    let result5=reg1.exec(result)
    let result6=reg1.exec(result)
    let result7=reg1.exec(result)
    let result8=reg1.exec(result)
    let result9=reg1.exec(result)
    let result10=reg1.exec(result)
    let result11=reg1.exec(result)
    let result12=reg1.exec(result)
    let result13=reg1.exec(result)
    let result14=reg1.exec(result)
    let result15=reg1.exec(result)
    let result16=reg1.exec(result)
    let result17=reg1.exec(result)
    // console.log(result1[1]);        //url 链接
    // console.log(result2[1]);
    // console.log(result3[1]);
    // console.log(result4[1]);
    // console.log(result5[1]);
    // console.log(result6[1]);
    // console.log(result7[1]);
    url_list=[result2[1],result3[1],result4[1],result5[1],result6[1],result7[1],result8[1],result9[1],result10[1],result11[1],result12[1],result13[1],result14[1],result15[1],result16[1],result17[1]]
    // console.log(url_list);
    // for( let url of url_list){
    // getMovies(url)
    // }
    getMovies(url_list[1])
    async function getMovies(url){
         
            await request.get({
                url:url,
                encoding:null,      //让body 直接拿buffer
            },(err1,response1,body1)=>{
                // console.log(1);
                // console.log(body1.toString());
                //获取分类里的电影链接
                // console.log('分类电影链接');
                let regg=/<a class="pic-pack-outer" target="_blank" href="(.*?)" title="(.*?)"><img/igs
                let movie_url1=[]
                var movie_url
                while(movie_url=regg.exec(body1.toString())){
                // console.log('电影:'+movie_url[2],'链接:'+movie_url[1]);
                movie_url1.push({
                    '电影:':movie_url[2],
                    '链接:':movie_url[1]
                })
                }
                // console.log(movie_url1);
                //  for( let url of url_list){
                //     getMovies(url)
                // }
                //解析页面
                parserPage(movie_url1[1]['链接:'])
                // console.log(movie_url1[1]['电影:']);
                async function parserPage(url2){
                        await request.get({
                        url:url2,
                        encoding:null,      //让body 直接拿buffer
                    },(err2,response2,body2)=>{
                        // console.log(body2.toString());
                        var buf2 =  iconv.decode(body2, 'gb2312');
                        console.log(buf2);
                        // blob:https://www.1905.com/eb9356cf-9a61-453e-af33-26d705f88258
                        // 加密链接,干扰爬虫
                        // fs.writeFile(path,content,(err)=>{
                        //     console.log(err);
                        // })
                    })
                }
        })
    }
})

```

