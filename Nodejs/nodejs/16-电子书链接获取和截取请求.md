```js
//index.js 文件
let puppeteer =require('puppeteer')
let axios=require('axios')
var url = require('url')		//解析路径
let fs=require('fs')

console.log(url);
(async function(){
    let option={
        defaultViewport:{       //设置视窗的大小
            width:1200,
            height:600
        },
        headless:false,      // headless:false 有界面
    }
   
try{
        let browser=await puppeteer.launch(option)
        // 将延迟函数封装成Promise 对象
        // function lcWait(ms){
        //     return new Promise(function(resolve,reject){
        //         setTimeout(function(){
        //             resolve('等待中....')
        //         },ms)
        //     })
        // }
    async function getPageInfo(pageObj){
        let page=await browser.newPage()
        //截取谷歌请求
        await page.setRequestInterception(true)
        //监听事件请求,并对请求进行拦截
        page.on('request',interceptedRequest=>{
            // 通过URL 模块对请求的地址进行解析
            let urlObj=url.parse(interceptedRequest.url())
            if(urlObj.hostname=='googleads.g.doubleclick.net'){
            //如果是谷歌的广告请求,那么就放弃当次请求,因为谷歌广告响应太慢
                interceptedRequest.abort()
            }else{
                interceptedRequest.continue()
            }
        })
        await page.goto(pageObj.href)
        let eleadd
       
       if( page.$('.dltable tr:nth-child(3) a:last-child')=='null'){
             console.log(await page.$('.dltable tr:nth-child(3) a:last-child'));
             await page.close()
            return
        }else{
           await getBook()
             
        }
         async function getBook(){
             eleadd=await page.$('.dltable tr:nth-child(3) a:last-child')
             let arrTitle=await page.$$eval('.article-header .article-title a',(element)=>{
            let eleTitle=''
            // 获得的是DOM 元素
            // console.log(element);
            element.forEach((item,i)=>{
              eleTitle=item.innerHTML
              console.log(eleTitle);
            })
            return eleTitle
        })
        let aHref=await eleadd.getProperty('href')
        // 获取链接属性
         aHref=await aHref._remoteObject.value
        //  console.log(eleadd);
        aHref=aHref.split('?url=')[1]
        let content=`{"title":"${arrTitle}","href":"${aHref}"}\n`
          console.log(aHref); 
        fs.writeFile('book.txt',content,{flag:'a'},function(){
            console.log(arrTitle+'--写入成功');
            page.close()
        })
       
         
         }

       
       }
    //从11000 开始有书籍 到18312 结束   到16226  下载不用验证
    for(let i=11030;i<=11100;i++){
        // await    等待一个页面加载完成时在加载下一个
       await getPageInfo({href:'https://sobooks.cc/books/'+i+'.html'})
    }
        
}catch(err){
    console.log(err);
}
})()

//获取等待js 动态ajax 请求渲染出来的元素,等待这个元素可见时
//await page.waitForSelector('.class',{visible,true})

//获取页面
//await browser.pages()

//获取页面地址
//pages.url

//监听请求完成(比如下载完成的监听)
//page.on('requestfinished',(req)=>{
		//req.url()  获取请求地址
		//console.log('下载完成')
})

```

