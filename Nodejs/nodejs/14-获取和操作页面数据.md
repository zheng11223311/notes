**获取和操作页面数据**

**1.使用 page.$$eval()  获取元素**

```js
//index.js 文件
//Puppeteer
let puppeteer =require('puppeteer')

//因为所有的事件都需要时间等待,所以使用异步执行
async function test(){
    //pupeteer.launch 实例启动浏览器,可以传入一个option 对象,可以配置为
    //无界面浏览器,也可以配置为有界面浏览器
    //无界面浏览器性能更高更快,有界面一般用于调试
    
    let option={
        defaultViewport:{       //设置视窗的大小
            width:1200,
            height:800
        },
        headless:false      // headless:false 有界面
    }
    let browser=await puppeteer.launch(option)

    //打开新页面
    let page=await  browser.newPage()
    //访问页面
    await page.goto('https://www.dytt8.net/index.htm')
    // 截屏,截取当前打开的页面,存放为screenshot.png
    await page.screenshot({path:'screenshot.png'})
    //获取页面内容,获取所有a 标签
    //$$eval 函数使得,我们回调函数可以运行在浏览器中,并且可以通过浏览器的方式进行输出
   let elements=await page.$$eval('#menu li a',(elements)=>{
        // console.log(elements);
        //创建一个数组去收集元素的信息,这里我们需要收集地址和内容
         let eles=[]
        elements.forEach((item,i)=>{
            //这里的 console 是在浏览器上输出
            // console.log(item.innerHTML);
            if(item.getAttribute('href')!='#'){
                 var eleObj={
                href:item.getAttribute('href'),
                text:item.innerText
                    }
                eles.push(eleObj)
            }
            
        // console.log(eleObj);
        })

        return eles     //得到的Promise 对象,需要返回出去
    })

    // 打开国内页面
    let gnPage=await browser.newPage()
    await gnPage.goto(elements[2].href)
    console.log(elements);
    // 浏览器可以监听控制台的输出
    // page.on('console',(...args)=>{
    //     console.log(args);
    // })
    // page.on('console',(evemtMsg)=>{
    //     //在cmd 上输出
    //     console.log(evemtMsg.text());
    // })
}

test()
```

**2.使用page.$$() 获取元素**

```js
//index.js 文件
let puppeteer =require('puppeteer')
async function test(){
    let option={
        defaultViewport:{       //设置视窗的大小
            width:1200,
            height:800
        },
        headless:false,      // headless:false 有界面
        //设置放慢每个操作步骤的毫秒数
        slowMo:250
    }
    let browser=await puppeteer.launch(option)
    let page=await  browser.newPage()
    await page.goto('https://www.dytt8.net/index.htm')
    //page.$$('#menu li a')  获取页面对象(用来做点击事件的方式获取),获取多个元素
    //通过点击页面的方式跳转
    // let elementHandles=await page.$$('#menu li a')
    // elementHandles[2].click()

    //通过表单输入进行搜索
    // page.$('#menu li a')  获取一个元素
    let inputEle=await page.$('.searchl .formhue')
    //让光标进入输入框
    await inputEle.focus()   //返回的是Promise 对象,需要等待一下
    //往输入框输入内容
    await page.keyboard.type('蝙蝠侠')

    // 找表单阻止冒泡,而不是搜索元素
    await page.$eval('.bd3rl>.search',(element)=>{
        element.addEventListener('click',function(e){
            //因为这个标签在广告标签a 里面,点击会跳转到广告,要阻止跳转
            //IE 的阻止冒泡e.canceBubble
            e.canceBubble=true
        })
    })

    //点击搜索按钮
    let btnEle=await page.$('.searchr input[name="Submit"]')
    await btnEle.click()
    //点击有广告,两次点击,一次进入到搜索结果
    await btnEle.click()

  
}

test()
```

