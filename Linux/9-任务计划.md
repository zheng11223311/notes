# 任务计划

## 一.一次性调度执行at

**Schedule one-time tasks with at**

### 1.语法格式

at \<TIMESPEC>

### 2.\<TIMESPEC> 示例

**now +5min**

**teatine tommorrow (teatine is 16:00)**

**noon +4 days**

**5pm august 3 2029**

**4:00 2019-11-27**

### 3.例子

**初始一次性任务计划**

**设置一个定时创建用户的任务**

```shell
at now +1min	#1分钟后
# 随后等待输入内容
useradd aaa		#创建用户
id aaa		#查看,后台执行,不会看到
#  输入完毕,ctrl+d提交任务
# 显示 <EOT>	job 1 at ....


at 11:45  1.mp4		#11.45 分打开1.mp4
```

**查询任务**

```shell
atq			#查看等待执行的命令
```

**验证结果**

```shell
id aaa 	#验证aaa 用户是否创建
```

## 二.循环调度执行cron

**Schedule recurring jobs with cron**

### 1.简介

> cron 的概念和crontab 是不可分割的
>
> crontab 是一个命令,常见于Unix 和Linux 的操作系统之中
>
> 用于设置周期性被执行的指令
>
> 该命令从标准输入设备读取指令,并将其存放于"crontab" 文件中,以供之后读取和执行

### 2.查看进程状态

crond 程序运行是计划任务执行的根本

```shell
systemctl status crond.service		#查看crond.service 的状态
#Active:active(running)	活跃状态 inactive 进程死了   die 进程挂掉了

#systemctl status httpd 		查看httpd 状态
#或ps 检查任务状态
ps aux |grep crond			#检查crond 程序的运行
```

### 3.cron 示例

#### 1.计划任务存储位置

```shell
ls /var/spool/cron/
```

#### 2.管理方式

**创建计划**

```shell
#crontab -e Edit jobs for the current user	-e 编辑当前用户的计划任务
```

**查询计划**

```shell
#crontab -l List the jobs for the current user
#管理员可以使用-u username,去管理其他用户的计划任务
```

**删除计划**

```shell
#crontab -rRemove all jobs for the current user
```

#### 3.语法格式 Job format

```shell
ls /var/spool/cron/

crontab -e		#使用文本编辑任务,每行一个任务
#任务格式:	* * * * * command
#第一个* :  minute(0-59)
#第二个* : hour(0-23)
#第三个* : day of month(1-31)
#第四个* : month(1-12) or jan,feb,mar,apr
#第五个* : day of week(0-6)(Sunday=0 or 7) or sun,mon,tue,wed,thu,fri,sat
#即: 分 时 日 月 周 执行的命令或脚本程序(六个部分用空格隔开)

5 15 1 1 * useradd ss	#每年的1 月的1号 15点5分执行seradd ss
5 15 1 * * useradd ss	#每月的1号 15点5分执行seradd ss
5 15 * * * useradd ss	#每天 15点5分执行seradd ss

* * * * * useradd ss	#每分钟执行seradd ss
* * * * * ./1.sh	#每分钟执行脚本1.sh 

*/5 * * * * ./1.sh	# */5  每隔5 分钟执行脚本1.sh 
* */5 * * * ./1.sh	# */5  每隔5 小时执行脚本1.sh 

0 2,4,6 * * * ./1.sh	#每天的2,4,6 小时执行脚本1.sh 

0 2-6 * * * ./1.sh	#每天的[2,6] 小时执行脚本1.sh 

#不写月日,仅周生效
0 2 * * 5 ./1.sh	#每月的每周的周五2 点执行脚本1.sh 

#写月日,月日和周同时生效,相当于并集
0 2 * * 5 ./1.sh	#每月的每周的周五2 点 和每天2 点,执行脚本1.sh 

00 02 * * 5 ./1.sh	#每月的每周的周五2 点执行脚本1.sh 
```

