# 一.重定向

date

```shell
date		#输出当前时间  2022年 03月 20日 星期日 13:31:31 CST
```

data 输出的结果,能否在下次开机查看

```shell
data > time.txt    #将信息覆盖写入到time.txt 文件中,如果文件不存在则创建
```

## 1.FD 简介

file descriptors,FD,文件描述符

进程使用文件描述符来管理打开的文件

FD 是访问文件的标识,即链接文件,省去了冗长的绝对路径

0 是键盘只读

1,2 是终端可以理解成屏幕,1 stdout , 2 stderr

3+ 是文件,可读可写

**示例:**

```shell
#通过一个终端,打开一个文本
vim file.txt

#通过另一个终端,查询文本程序的进程号
ps aux |grep vim
#显示
#root        4304  0.0  0.4  46620  8368 pts/0    S+   14:00   0:00 vim file.txt
#root        4355  0.0  0.0  12320   992 pts/1    R+   14:00   0:00 grep --color=auto vim

#在/proc 目录中查看文本程序的FD
ls proc
#显示,查找到4304 的进程号
#....
#1341  173   1913  2372  2529  4304  523  558  946  irq          uptime
#....

ls /proc/4304
#显示,fd 文件夹
#...
#autogroup        fd         mountstats     root          syscall
#...

ls -l /proc/4304/fd
#显示,链接文件
总用量 0
lrwx------. 1 root root 64 3月  20 14:05 0 -> /dev/pts/0
lrwx------. 1 root root 64 3月  20 14:05 1 -> /dev/pts/0
lrwx------. 1 root root 64 3月  20 14:05 2 -> /dev/pts/0
lr-x------. 1 root root 64 3月  20 14:05 3 -> /var/lib/sss/mc/passwd
lrwx------. 1 root root 64 3月  20 14:05 4 -> 'socket:[73776]'
lrwx------. 1 root root 64 3月  20 14:05 5 -> /root/bb/.file.txt.swp

#写入123 到终端0 ,第一个终端在vim 下会实时显示123
echo 123 > /dev/pts/0
#时间会显示在第二个终端上,即当前终端,此时的显示效果等同于当前终端输入 date 后回车的效果
date > /dev/pts/1
```

软连接

```shell
ln -s 123.txt 333			#创建文本和其软连接,ln  link  -s 软连接   
#123.txt 333

#读取文本
cat 123.txt 
cat 333			#读取的也是123.txt

```

## 2.重定向案例

### 1.输出重定向即综合案例

​	输出重定向分为:

- 正确输出

  - 1> (等价于>) 

    - ```shell
      echo 123 1> /dev/pts/0			# > 是覆盖原文件, >> 是追加到原文件
      #等同于
      echo 123 > /dev/pts/0
      ```

  - 1>>(等价于>>)

    - ```shell
      echo 123 >>1.txt     
      echo 456 >>1.txt    
      
      cat 1.txt
      #123
      #456
      
      mkdir 111 > 1.txt    #创建文件夹,但是没有写入到1.txt 中,因为mkdir 在创建时没有输出信息,使用mkdir 222 查看终端时,创建成功时没有输出信息
      mkdir 222		# 回车后无信息
      mkdir -v 222 		# -v 显示创建过程才会输出信息
      mkdir -v 222 > 1.txt	# 将输出到显示器的重定向到输出到文本中
      cat 1.txt
      #mkdir: 以创建目录 "222"
      ```

- 错误输出(用于输出错误信息)

  - 2>

    - ```shell
      ls /home/ 2> list.txt	#显示器有输出ls 信息,没有生成list.txt 文件,因为没有错误产生
      
      ls /aaa 2>list.txt		#不存在aaa 文件夹时,有错误会写入到文件中
      ```

  - 2>>

- 正确和错误都输入到相同的位置

  - ```shell
    ls /home/ /aaa	&> list.txt		#& 是后台, &> 与& 不同
    ```

- 正确和错误输入到各自的位置

  - ```shell
    ls /home/ /aaa	1> true.txt	 2> false.txt		
    ```

- 正确和错误输入到回收站

  - ```shell
    ls /home/ /aaa	&> /dev/null	#/dev/null 为黑洞文件
    ```

### 2.输入重定向即综合案例

**标准输入:**

<  (等价 0<)	

程序在左 < 文件在右

```shell
#编写邮件
mail -s "标题"  alice			#mail  -s "标题" 发送给谁(得是本计算机上的账号)
#文件内容
1231313.
#输入点 .   回车发送, 点代表邮件编辑以结束

#切换用户,查看邮箱
su - ss
mail		#显示当前用户有一条消息,一条新消息,以及版本
#输入1 回车,查看接收到的信息,q 退出,再 exit  退到管理员root
```

**使用重定向快速创建邮件**

如果已经有了现成的邮件内容呢,如何快速输入邮件内容,就可以用重定向创建邮件

先准备一段邮件内容

```shell
vim word.txt
```

```shell
mail -s '标题11' ss <word.txt
```

原理:利用输出重定向,把文件内容代替人为的输入

### 3.输出与输入重定向一起使用

```shell
vim 1.sh   #shell 命令文件
#输入
cat >/1.txt << EOF
123123
12312321
EOF

#先执行输入再执行输出,EOF 取消段落标记,可以再.sh 命令文件中EOF 中的内容不会因为中间回车而被执行
#将EOF 中内容cat 读取,再输出到1.txt 文件中,

#输入:输入到程序
#输出:输出到文本
```

执行1.sh

```shell
chmod +x 1.sh
./1.sh
```

# 二.管道

## 1.进程管道Piping

1. 管道命令可以将多条命令组合起来,一次性完成复杂的处理任务

   1. 语法:command1|command2|command3|......

   2. 示例:

      ```shell
      cat /etc/passwd |tail -3	#以末尾3行显示passwd 文件信息
      ps aux |grep 'sshd'		#查找含有 sshd的进程
      ```

## 2.tee 管道

tee 不但可以完成进程管道的事情(输出信息到其他命令中),同时还能再输出到其他位置

三通管道,即交给另一个程序处理,有保存一份副本

```shell
cat /etc/passwd | tee 88.txt|tail -1		#tee 将前面命令执行后的信息保存到88.txt,再提交给下一个命令

cat /etc/passwd | tee |tail -1  #不加文件,直接输出到显示器上
```

## 3.参数传递Xargs

cp rm 一些特殊命令就是不服其他程序

**案例:**

1.环境准备,准备一些文件用来删除

```shell
touch /home/file{1..5}		#创建file1, file2 ....file5
ls /home/
```

2.接到消息,部分文件需要删除

```shell
vim file.txt
#写入
/home/file1
/home/file2
/home/file3
/home/file4
/home/file5
```

3.使用管道

```shell
cat file.txt |rm -rvf		#失败	r 递归 v 可视 f 强制
```

4.貌似之前的不行,下面加上xargs

```shell
cat file.txt |xargs rm -rvf		#成功删除文件中指定路径的文件
```

cut 

```shell
cat /etc/passwd |grep ntp |cut -d: -f1		#将文件以: 来切割 -d 指定使用切割的参数 -f 指定切割出第几列
#ntp
```

