### 用户的权限

**目录**

- 基本权限UGO(user  group other)
  - 设置权限的两个基本元素
    - 权限对象
    - 权限类型
  - 权限的三类对象
    - 属主:u
    - 属组:g
    - 其他人:o
    - 特殊对象:所有人:a(u+g+o)
  - 权限的三种类型
    - 读:r=4( 4 这个权限对应的数字)
    - 写:w=2
    - 执行:x=1
- 基本权限ACL(access control list 限制用户对文件的访问),是UGO 的补充,或则说是加强版
- 特殊权限(了解)

#### 一.基本权限UGO(user  group other)

##### **1.设置权限**

###### **1.更改权限**

**使用符号**

使用符号:u用户 g组 o其他 r 读 w写 x执行

语法:chmod 对象(u/g/o/a) 赋值符(+,-,=)权限类型 文件.目录

(+为赋予(追加)权限, - 为取消权限 , =为覆盖(重新赋予权限)原来的权限)

root 用户拥有所有权限,无法取消root 用户的权限,root 新创建的文件也没有可执行权限,防止病毒执行,root 后期可自己添加权限

```shell
chmod u+r 1.txt 		#设置权限(change modify),命令 对象加减权限	文件或目录(目录需要使用 -R 参数,递归授权下面所有文件.没有-R 只是授权这个文件夹,没有授权文件夹下面的文件)
chmod u= 1.txt  		#u 权限为空(无权限)
chmod a=rx  1.txt		#赋予所有人对1.txt 的可执行可写权限
chmod u+rwx bb -R		#u 授权当前用户,对bb 文件夹及其子文件可读可写可执行权限
chmod g+rwx bb -R		#g 授权当前组,对bb 文件夹及其子文件可读可写可执行权限
chmod o= 	bb -R		# 授权其他人,对bb 文件夹及其子文件没有任何权限
chmod o-rwx bb -R		# 授权其他人,对bb 文件夹及其子文件没有任何权限
chmod o=--- bb -R		# 授权其他人,对bb 文件夹及其子文件没有任何权限
chmod o=-   bb -R		# 授权其他人,对bb 文件夹及其子文件没有任何权限
chmod o=-,u=rwx   bb -R		# 授权其他人,对bb 文件夹及其子文件没有任何权限,用户有所有权限
chmod o=-,ug=rwx   bb -R		# 授权其他人,对bb 文件夹及其子文件没有任何权限,用户和组有所有权限
```

查看文件的权限

```shell
ls -l 或ll 或ll  1.txt
# -rw-r--r--. 1 root root    0 3月  14 12:29 22.txt
# drw-r--r--. 1 root root  120 3月  14 12:02 aa

# drw-r--r--. (类型和权限(9位) 共 11 位)   
#
# d         					rw-    				 r--    		r--		  .	
#文件类型( - 普通文件, d 文件夹)	属主权限(- 为无权限)	 属组权限		其他人权限 暂不解释

# 1     				  root      root    	0 			
#发送到桌面的链接次数			属主		属组		  大小(字节)		

# 3月  14 12:29 		22.txt
# 创建时间				文件名/目录名
```

案例

```shell
#创建文件
cd /tmp
ls -l -d /tmp/     #-d 表示只看文件夹的权限,而不是看里面文件的权限
touch file1			#创建file1
ll file1

#编写编程
vim file1
echo 'hello'		#控制台输出信息
read -p '请输入你的姓名:' name		#搜集用户输入的信息 -p print 打印一段话
echo "哈哈$name是大笨蛋"		#双引号可以解析变量,单引号不行

#增加执行权限,可执行文件的颜色是绿色的,文件夹是蓝色的,普通文件是白色的
chmod u+x file1

#运行测试
./file1			#直接file1 不能运行,需要使用相对路径
#或使用
bash file1		#无视权限执行
```

**使用数字**

```shell
chmod 751	1.txt		#用户具有所有权限(7,4+2+1),组具有读执行权限(5,4+1),其他人具有执行权限(1)
chmod 000	1.txt	 #都没有权限
chmod 777	bb -R		#递归修改文件夹bb 和其下所有的文件权限
```

###### 2.更改属主,属组

chown 命令

设置一个文件属于谁,属主

语法: chown 用户名.组名 文件

```shell
chown alicer.hr	1.txt	#change owner    改属主,属组
#-rw-r--r--. 1 alicer hr 120 3月  14 12:02 1.txt
 chown alice 1.txt		#只修改属主
 chown .hr  1.txt		#只修改属组
```

chogrp 命令

设置一个文件属于哪个组,属组

语法:chgrp 组名 文件 -R 是递归的意思

```shell
chgrp it 1.txt		#改文件属组
chgrp ir dir1		#改目录属组,目录下的文件不会被改变
chgrp -R ir dir1	#改目录属组,目录下的会被递归改变
```

一个文件不能同时对多个用户实现多个不同的权限

#### 二.基本权限ACL

ACL 文件权限管理:设置不同的用户,不同的基本权限(r,w,x),对象数量不同

UGO 设置基本权限:只能一个用户,一个组和其他人

语法:setfacl -m u:alice:rw /home/test.txt			//-m 设置 -d 删除

命令: 设置 用户或组:用户名或组名:权限 文件对象

```shell
setfacl -m u:alice:rw 1.txt		#设置用户的权限
setfacl -m g:hr:rwx 1.txt	#设置组的权限
setfacl -m o::r-- 1.txt  	#设置其他人的权限
```

查看文件有那些权限

```shell
getfacl 1.txt
#显示

[root@localhost bb]# getfacl 22.txt 
# file: 22.txt		#文件名
# owner: root		#属主
# group: root		#属组
user::rw-			#属主权限,对应 owner 的值的权限	,对多个user 用户设置权限
user:alice:rw-			#属主权限:用户:权限
group::rwx			#属组权限
group:hr:rwx			#属组权限,对应 group 的值的权限
other::r--			#其他人权限

```

setfacl 的权限会uGO 权限叠加到一起

```
-rw-r--r--+    +表示叠加,文件叠加的权限根据文件内容而定,当删除所有acl 权限时+ 消失,有+ 使用getfacl 看更好
```

删除

```shell
setfacl -x g:hr 1.txt		#删除组hr 的acl 权限
setfacl -b 1.txt			#删除所有(扩展出来的)acl 权限
```

#### 三.特殊权限

**特殊位suid**

suid,(sgid) 针对文件/程序时,具备临时提升权限

```shell
ll /usr/bin/cat		#仔细观察输出的信息
chmod u+s /usr/bin/cat 		#对cat 命令进行临时提权,比如此时普通用户也可以使用cat 进行查看超管才能查看/root 下的文件
ll /usr/bin/cat	
#	drws rw-rw-

chmod u-s /usr/bin/cat 		#取消临时提权
```

**文件属性chattr**

如果一个文件很重要,那他万一被超管删除了怎么办,靠特殊的i 权限

用途:常用于锁定某个文件,拒绝修改

分类:

| 类型              | 描述                                                       |
| ----------------- | ---------------------------------------------------------- |
| a(append)         | 允许在文件中进行追加操作                                   |
| A                 | 这个属性不允许更新文件的访问权限                           |
| c (compressed)    | 启用这个属性时,文件在磁盘上会自动压缩                      |
| d (dump)          | 不能使用dump 命令备份文件                                  |
| D                 | 设置了文件的D 属性时,更改会在同步保存的磁盘上              |
| e (extent format) | 它表明,该文件使用磁盘上的块的映射扩展                      |
| i (immutable)     | 在文件上启用这个属性时,我们不能更改,重命名或者删除这个文件 |
| j (journaling)    | 设置了这个属性时,文件的数据首先保存在日志中,然后再写入文件 |
| S (synchronous)   | 设置了这个属性时,变更或更改同步保存到磁盘上                |

chattr 属性中可以使用的不同选项:

- -R 递归地修改文件夹和子文件的属性
- -V chattr 命令会输出带有版本信息的冗余信息
- -f 忽略大部分错误信息

```shell
chattr +i file		#不能更改,不能删除,重命名 change attrbuite
lsattr file 		#查看不同的属性
#----i--------------- file
chattr -i file		#去除属性
```

**进程掩码umask**

修改文件创建时的默认权限,新建文件.,目录的默认权限会受到umask 的影响,umask 表示要减掉权限

重启服务器会恢复初始值0022

```shell
#在shell 进程中创建文件,先查看当前用户的umask 权限
umask
# 0022		系统创建文件夹的时候权限是755, 0777-0022=0755
#系统为了保护自己,所以在创建的文件上,去掉了所有的执行权限 0755-0111=0644
touch file
mkdir dir1
ll -d dir1 file	

umask 0000		#设置掩码为0000
```

```shell
chmod u+s file		#- rwS r--r--	S 是大写的,S 是因为没有执行权限x,s 是有执行权限的
chmod u+x file 		#- rws r--r--	#S+x= s
chmod u-x file		#- rwS r--r--     去掉x 权限变回S

chmod 4777 file 	# 4777		特殊 主 组 其他,  4为 suid,2为... , 1为... 0为无特殊权限
```

