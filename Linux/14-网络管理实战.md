# 网络管理实战

跨网络通信,需要网络层,需要IP 地址

## 一.网络层

### 1.IP 地址

#### 1.简介

32 位二进制数

IP 用于主机在互联网中的标识

**4组十进制表示:**

IP 地址每八位为一组,用 "." 分割,用十进制表示,可知,每一组最大值为255

192.168.0.1



#### 2.分类

以IP 的第一组划分(比如: 192)

- A 类(1~126)
  - 127 : 回环地址:我自己
- B 类(128~191)
- C 类(192~223)
- D 类(224~239) 组播
- E 类(240~255)科研

C类IP :IP 地址前三组统称为网络部分,后一组称为主机部分

B 类 IP: IP 地址前2 组统称为网络部分,后2 组称为主机部分

A 类 IP : IP 地址前1 组统称为网络部分,后3 组称为主机部分

#### 3.私有IP 分类

私有IP 相当于在家穿的私有鞋子,出门(上网) 就换共有的鞋子(公网 IP )

- A 类 10.0.0.0~10.255.255.255
- B 类 172.16.0.0~172.31.255.255
- C 类 192.168.0.0~192.168.255.255

#### 4.子网掩码

32位进制数

**作用: **运算出IP 地址的网络部分,同一网段可以直接通信,不需要使用交换机

**分类: **

- A 类: 255.0.0.0
- B 类: 255.255.0.0
- C 类: 255.255.255.0

**方法:**

子网掩码中为1 的部分,对应IP 地址的网络位

IP 地址和子网掩码,逻辑运算

**举例:**

验证两个IP 地址是不是同一网络(A 类IP 对应使用A 类的子网掩码)

1. IP 地址转换2 进制

   1. 192.168.1.2
   2. 1100 0000. 1010  1000. 0000 0001. 0000 0010

2. 子网掩码转换2 进制

   1. 255.255.255.0
   2. 1111 1111. 1111 1111. 1111 1111. 0000 0000

3. IP 地址和子网掩码逻辑运算(且运算,都为1 的1,否则为0)

   1100 0000. 1010  1000. 0000 0001. 0000 0010		IP 地址

   1111 1111. 1111  1111. 1111 1111. 0000  0000		子网掩码

   \-------------------------------------------------------------------

   1100 0000. 1010  1000. 0000 0001. 0000  0000

   规律:

   子网掩码中1 的位置,对应的 IP 地址照抄

   子网掩码中 0的位置,对应的 IP 地址全为0

4. 得出网络地址(这个IP 属于哪个网络)

   1. 1100 0000. 1010  1000. 0000 0001. 0000  0000  =>192.168.1.0 (网络地址:代表一群地址, 即 1.0 的IP 地址大家都用,不能给主机配置这样的IP 地址)

**问题:**

192.168.1.2 这个IP 地址和哪些IP 是同一个网段的?

> 总数是256 个,可用的IP 地址是254 个(即除去网络地址(1.0  地址,所有地址的统称,相当于一个班号,虽然是一个数字,但是不能把这个数字给学生 ) 和广播地址(1.255 ) 因为一个 IP 要通过 1.255 地址进行广播,其他IP 通过1.255 接收) 
>
> 不要配第一个地址和最后一个地址,因为被路由器使用

**问题:**

我有260 个人的公司,能否使用标准的C 类地址?

> 不能,使用B 类地址,65536 个地址,2 的16 次方
>
> 172.16.1.1 		IP 地址
>
> 255.255.0.0		子网掩码
>
> 172.16.0.0			网络地址
>
> 172.16.0.0~172.16.255.255 	网络范围

**问题:**

超过6万人的局域网,使用什么类型的地址

> A 类(1600万个地址 ),因为B 类不够

#### 5.网络地址

网络地址相同,IP 地址是同一网段

网络地址不同,IP 地址不是同一网段

**问题:**

两个网络如何通信?世界就如何通信?

192.168.1.1

中间必须由路由器(分割网络,连接不同的网络,需要寻址)

192.168.2.3

### 2.网络层封装

IP 数据包格式,20个字节,即160 位

格式: 32 位版本号(IPV4 还是IPV 6 ) +首部长度+检验和+ 标识标志偏移量+TTL+协议类型+可选项 +32位目标IP + 32位源IP +信息数据

计算机发现,访问的地址是其他网段,把这个数据包丢给网关(路由器)

### 3.路由器工作原理

#### 1.路由

**概念**

跨越从源主机到目标主机的一个互联网络来转发数据包的过程

每个路由器都有一个路由表

路由表由网段和接口组成

| 网段 | 接口 |
| ---- | ---- |
| 1.0  | E0   |
| 2.0  | S0   |

![路由器工作原理](D:\学习\wanye\Linux\img\路由器工作原理.png)

1.0 网段传递到4.0 时,由路由器A 发送出去,当第二个路由器B 接收到包是,查看包的目标IP ,是否与自己的对应,对应就把包交给本段的交换机,路由器是双向通信的,接收到数据后要返回信息(就像访问百度时,百度要返回数据,百度不能只接收数据,而不返回数据给我们)

路由器之间的连线不属于两个通信网段之中任何一个网段,即属于除通信中的网段之外的网段

两个路由器连线时各自有一个网段,需要网段都在同一网段上,路由器之间才能通信

**路由表形成![路由表的由来](D:\学习\wanye\Linux\img\路由表的由来.png)**

直连网段: 两台主机连接在同一个路由器上

非直连网段: 两台主机连接在不同路由器上,由于空间原因不同地区的主机不可能连接在同一个路由器上

**路由协议**

静态路由(实现部分)

动态路由(略)

### 4.示例

**两个网络的互通**

1. 建立两个局域网(每个局域网,一台交换机两台主机,注意IP 地址,不同的局域网下IP 地址网段不同)
2. 所有的主机的默认网关需要配置为路由器与其相同网段下的 路由器的IP 地址(即配置出口)
3. 使用一台路由器连接两个网络
4. 为路由器的接口,配置本网段的IP 地址(路由器连接多少个网段就配置多少个IP )并通电(即配置中启用端口状态),同网段下的主机能ping 通路由器
5. 配置好后,右边(左边)的主机能ping 通左边的主机(右边)

![路由器示例](D:\学习\wanye\Linux\img\路由器示例.png)

192.168.1.1/24   中 /24 表示 子网掩码为24位,即255.255.255.0  ,一组有8位,24=8x3

/16 表示8位, 255.255.0.0

/6 表示4位,255.0.0.0

```
show ip route	#查看路由表,此命令不是shell 命令,而是Cisco Packet Tracer软件的路由器的命令行
```

**三个网络的互通**

![多个路由器示例](D:\学习\wanye\Linux\img\多个路由器示例.png)

主机的默认网关要与同一侧的路由器的同一侧的IP 通网段,否则无法通信

路由器之间的网段要与主机使用的网段不一致

所有连线都是绿色的表示能联通

路由器之间的ping 通: 在一台路由器的命令行上ping 另一台路由器,!!! 表示两台路由器成功联通

两个主机之间能ping 通,需要路由表存在记录

为路由器1,添加静态路由

```
#在路由器1 的命令行
show ip route	#查看路由表
enable			#特权
config t		#进入配置
ip route  192.168.2.0 255.255.255.0 f0/1		#ip route 路由配置 目标192.168.2.0 255.255.255.0     方向f0/1 ,即指定发送的目标,同时写入到路由表中
```

路由器2,添加静态路由同理

```
#在路由器1 的命令行
show ip route	#查看路由表
enable			#特权
config t		#进入配置
ip route  192.168.1.0 255.255.255.0 f0/1		#ip route 路由配置 目标192.168.2.0 255.255.255.0     方向f0/1 ,即指定发送的目标,同时写入到路由表中
```

此时,两个主机之间能ping 通
