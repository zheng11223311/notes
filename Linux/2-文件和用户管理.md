### 1.文件和用户管理

**Linux 目录结构**

- /
  - bin		//binary  二进制,所有的命令都在这里
  - boot     //计算机启动有关的目录
  - dev       //驱动设备,硬盘,鼠标,光驱,显示器,U盘等看得见的设备
  - etc        //配置文件/控制台文件,经常使用
  - home   //存储用户自己的文件,比如创造\拷贝的文件,普通用户的家目录
    - alice
    - bob
    - eve
  - root     //root 文件夹除了root 用户,其他用户都不能进(访问到),root 用户的home
  - run      //临时的运行文件
  - sbin     //与bin 一样,只是只有root 管理员特有的命令, super bin
  - tmp     //template 临时目录
  - usr     //应用程序,用来安装应用软件的
    - bin
    - local
    - sbin
    - tmp
  - var     //类似run,tmp ,里面装的是可变文件,比如日志,邮件
    - tmp
  - proc  //处理器进程

**命令**

使用 命令 --help 查看命令的用法,比如

```
cd --help
```

使用键盘上的tab 键对命令进行补齐

使用上下键翻出历史命令

ctrl+c 终止命令的执行

cd

```shell
cd /    #切换到根目录   change directory
cd		#切换到根目录
cd etc  #切换到当前文件夹下的etc 文件夹
cd .	#切换到当前目录
cd ..	#切换到上级目录
```

pwd

```shell
pwd   #输出当前文件夹路径  print word directory
```

ls

```shell
ls  	#列出当前文件夹下的文件和文件夹 list 简写
ls -l 	#列出文件的长格式(详细信息)
ll   	#列出文件的长格式(详细信息)
ls -l / # 列出/ 目录下的文件的长格式(详细信息)
#显示
#-rw------  root root 1874 2月 10 23:03 1.txt  
#第一个- 为文件,第一个如果是d ,即文件夹(蓝色),
#第一个为c 为设备文件(字符设备) 打印机 ,终端/dev/tty1
#b  为设备文件(块设备 block)存储设备硬盘,终端 /dev/sda, /dev/sda1
#l 链接文件link (淡蓝色)
#s 套接字文件
#p 管道文件
```

clear

```shell
clear  #清屏.等同于ctrl+l
```

exit

```shell
exit  #退出终端
```

### 2.文件管理

> 命令短小的原因,从前电脑租用时,按字节进行收费,所以简化字节

1. **改变目录**

   cd

   ```shell
   cd /    #切换到根目录   change directory
   cd		#切换到根目录
   cd etc  #切换到当前文件夹下的etc 文件夹
   cd .	#切换到当前目录
   cd ..	#切换到上级目录
   cd ../etc # 切换到上级文件夹下的etc 文件夹
   ```

   ls

   ```shell
   ls  	#列出当前文件夹下的文件和文件夹 list 简写
   ls -l 	#列出文件的长格式(详细信息)
   ll   	#列出文件的长格式(详细信息)
   ls -l / # 列出/ 目录下的文件的长格式(详细信息)
   #显示
   #-rw------  root root 1874 2月 10 23:03 1.txt  
   #第一个- 为文件,第一个如果是d ,即文件夹(蓝色),
   #第一个为c 为设备文件(字符设备) 打印机 ,终端/dev/tty1
   #b  为设备文件(块设备 block)存储设备硬盘,终端 /dev/sda, /dev/sda1
   #l 链接文件link (淡蓝色)
   #s 套接字文件
   #p 管道文件
   ```

   tree

   ```shell
   tree	#以树状形式显示当前目录结构
   tree /   #以树状形式显示/ 下所有的文件
   ```

2. **创建文件**

   touch

   ```shell
   touch  #路径和名字	
   touch /etc/file1.txt  # /etc/ 下创建file1.txt
   touch /file2    #/ 下创建file2 文件
   touch /file2/1.txt 2.txt    #/file2 下创建1.txt 在当前文件夹下创建2.txt
   ```

3. **创建目录**

   mkdir

   ```shell
   mkdir 路径和目录名
   mkdir /etc/file1  # /etc/ 下创建file1 文件夹
   mkdir /file2    #/ 下创建file2 文件夹
   mkdir dir1 -v		#可视化创建文件夹dir1,可视创建过程,visible
   mkdir /etc/file1 -p # /etc/ 下创建file1 文件夹,如果父级文件夹不存在,创建父文件夹, -p parent
   mkdir /home/{one,two} 	#在/home 下创建one 和two 文件夹
   mkdir /home/{one,two/{dir1,dir2}} -pv	#在/home 下创建one 和two 文件夹,在two 文件夹下创建dir1,dir2文件夹
   ```

4. **复制**

   cp

   ```shell
   cp 源文件 目标文件			#copy
   cp /usr/1.txt /etc/		#将/usr/1.txt 复制到/etc
   cp /usr /etc -r   #将文件夹/usr 复制到/etc 下,-r 递归复制文件夹下的内容,recursive 递归
   cp aa bb -r #将当前目录下的aa 目录 复制到 当前目录下的bb 目录下
   
   cp 源文件 源文件 源文件  目标文件		#将多个源文件拷贝到一个目标文件
   cp aa bb cc -rv #将当前目录下的aa 目录,bb 目录 复制到 当前目录下的cc 目录下,v 可视
   cp aa bb rfn #强制无提示复制.f force 强制,n 不提示
   ```

5. **移动(重命名)**

   mv

   ```shell
   mv 源文件路径 目标文件路径		#move
   mv aa bb  #将aa 文件夹移动到bb 文件夹
   mv 1.txt 2.txt  #将当前目录下 1.txt 移动到当前目录下 起名为2.txt (重命名)
   ```

6. **删除**

   rm

   ```shell
   rm 源文件		#remove
   rm 文件或目录		#删除当前目录下文件或指定文件
   rm -rf 文件或目录	#递归无提示删除当前目录下所有文件或指定文件 r recursive   f force
   rm *   #删除当前目录下所有文件
   rm *.txt   #删除所有后缀为txt 的文件
   rm *1   #删除所有带1 的文件或文件夹
   rm 1.txt 2.txt  #删除1.txt 2.txt 两个文件
   rm -rf /*  #删库跑路,不会删除隐藏文件,需要手动删除
   ```

7. **查看文件内容**

   cat

   ```shell
   cat 1.txt    #查看文件的所有内容
   ```

   head

   ```shell
   head -3 1.txt  	#只看文件的前3行
   ```

   more

   ```shell
   more 1.txt   #文件过大时,翻页显示,回车每次显示一行,空格每次翻页
   ```

   tail

   ```shell
   tail -2 1.txt  #尾部查看2行
   ```

   grep

   ```shell
   grep c 1.txt    #查找1.txt 中的c,过滤关键字
   ```

8. **修改文件内容**

   重定向

   ```shell
   ls >1.txt      #列出当前目录下的所有内容,并写入1.txt,如果文件存在则覆盖,不存在则创建
   cat 1.txt >>2.txt  # 查看1.txt 并追加到2.txt,如果文件存在则覆盖,不存在则创建
   ```

   gedit

   ```shell
   gedit 1.txt   #图形编辑器,g 图形,edit 编辑,呼出编辑器进行编辑,如果文件不存在则创建
   ```

   vi , vim (  vim 是vi 的升级版,带有颜色)

   ```shell
   vim 1.txt     #编辑1.txt,不存在则创建
   #此时输入i或a或o或A,进入编辑模式,(a 当前光标向后一位插入文本,i 当前光标下插入文本,o 新行插入文本,A 当前光标行尾插入文本)
   #按esc 退出编辑模式,进入command 命令行模式,按shit+:(末行模式) 输入wq 保存退出,q! 强制不保存退出(无提示退出),
   #shit+: 下输入set number 或 set nu 设置显示行数
   #set list 显示回车控制字符
   #set nonu 取消设置行号
   #set nolist 取消显示回车控制字符
   
   #esc 退出编辑模式,进入命令行模式时,按yy(2下y) 为复制,按p 为粘贴
   #dd 为删除当前光标所在的一行
   #按 3yy 表示复制当前及以下的共3行,多行复制
   #按 5yy 表示删除当前及以下的共5行,多行删除
   #按 u 撤销上一步操作,undo
   #按 x 删除一个字
   #按 v 可视化多选 选中/取消选中 字节,在按一个y 即可复制,可视化模式下一个y 就行,按d 删除选中的字节
   
   #光标定位,命令行模式下
   #hjkl 或上下左右键					#上下左右
   #0 $ 或 Home End 键	   			   #首行尾行, n(除0) 向下跳n行 
   #gg G 或 ctrl+Home,ctrl+End 键	   #页首页尾
   #3G 								#进入第三行, ngg 或 nG 跳到第n 行
   #/string (n N 可以循环的) 	#查找字符,按n 键选下一个查找到的(重要),按N 键选上一个查找到的,比如查找aa, /aa ,取消查找到的高亮文字颜色,/查找不到的字符 即可
   
   #查找替换,末行模式下
   # :范围 s/原内容/新内容/全局
   # :1,5 s/root/root1/g		#1到5 行中全局查找root 替换为root1,s 是替换命令switch 交换,g 表示全局,所有匹配到的,不加g 只替换第一个匹配到的
   #1,$ s/root/root1/g	 	#1到尾行
   
   #读入文件/写入文件(另存为),末行模式下
   #:w /tmp/aa.txt  #另存为 /tmp/aa.txt
   ```
   
   **vim 不能使用 > 和>> 写入到文本中,因为vim 是一个应用程序,不是shell 自带的命令**
   
   **shell**
   
   中文:壳
   
   功能:命令解释器
   
   shell 有ashell,bshell,cshell ,dshell 到现在最终现在使用的bash 是结合两个的shell功能,输入错误的命令报错显示
   
   bash:... 错误信息
   
   如果vim 时没有正常的保存,shell 会创建一个 /.文件名.扩展名.swap 的临时备份文件,再次编辑此文件时,会显示发现交换文件,如果不需要这个临时文件,删除即可
   
   ```shell
   ls -a   #查看所有文件,包括隐藏文件 all
   rm 文件	#删除文件
   ```

### 3.用户管理

```shell
[root@localhost ~]#
#[用户@服务器名称 家目录(/ 为根目录)]root 权限   $为普通用户权限
```

#### 1.用户/组基本概念

**用户基本信息文件 /etc/passwd	**

```shell
head -1 /etc/passwd		#读取passwd 中一行
# 显示
# root:x:0:0:root:/root:/bin/bash		:将其分成七列
# 用户名:x:uid:gid:描述:HOME:shell
#用户名:登入系统的名字,不允许重名,不能用数字
#x:密码占位符,具体的密码存在其他文件中,为此密码占位
#uid:(user identification 用户的身份证号码) 0 特权用户,1-499 系统用户(操作系统运行需要的自行创建的用户,如SYSTEM) 1000+ 普通用户,
#gid:group ,组id,一般和用户一样
#描述:对用户的描述,比如经理 manager
#家目录:/root,root 用户登入系统时,所在的目录,普通用户登入时,所在的目录为/home/用户名
#shell:/bin/bash,命令解释器
```

**科普:IDC (internet database center 互联网数据中心)** 

此带宽为20~50 T

它的电源设计:

每台服务器都有双电:(市电(城市用电) , UPS(不间断供电系统) , 油机发电机)

**用户密码信息文件 /etc/shadow**

```shell
head -1 /etc/shadow		#读取shadow 中一行
#显示
# root:$6$fiSBDe.mS.X6KNBD$/tPYTbniKozhA5hR94y.8PotDXcz3KkZFJ1LipScHNenCSXhEjBiRLfI0NdXtzGRbBJs.2Ti5sFbtOWN2CRBf0::0:99999:7:::				#第一个:和第二个:之间是加密后的密码
#加密算法$id$salt$encrypted
#$1:MD5
#$5:SHA-256
#$6:SHA-512

#1."登入名"是与/etc/passwd 文件中的登入名相对一致的用户账号
#2."口令"字段存放的是加密后的用户口令,如果为空,则对应用户没有口令,登入时不需要口令.星号代表账号被锁定,双感叹代表这个密码已经过期了
#$6$ 开头的,表明是用SHA-512 加密的
#$1$ 表明是用MD5 加密的
#$2$ 表明是用Blowfish 加密的
#$5$ 表明是用SHA-256 加密的
#3."最后一次修改时间"表示的是从某个时刻起,到用户最后一次修改口令的天数,时间起点对不同的系统可能不一样,例如在SCOLinux 中,这个起点是1970年1月1日
#4."最小时间间隔"指的是两次修改口令之间所需的最小天数
#5."最大时间间隔"指的是口令保持有效的最大天数,最大值为99999
#6."警告时间" 字段表示的是从系统开始警告用户到用户密码正式失效之间的天数,即离失效还有多少天时提示块失效了
#7."不活动时间"表示的是用户没有登入活动但账号仍能保持有效的最大天数.(软限制,到期后多少天就不能用账号了,禁用,但是可以解禁)
#8."失效时间"字段给出了的是一个绝对的天数,如果使用了这个字段,那么就给出相对应账号的生存期,期满后,该账号就不再是一个合法的账号,也就不能在用来登入了(硬限制)
#9.保留
```

**组信息文件 /etc/group**

```shell
head -1 /etc/group		#读取group 中一行
#显示
# root:x:0:
#组名:组密码:组ID:组成员

```

#### 2.用户/组管理

##### **用户**

**创建用户 未指定选项**

如果创建一个用户时,未指定任何选项,系统创建一个和用户名相同的组作为用户的Primary Group 

```shell
useradd user01  #创建user01 用户,密码默认无,用户的家目录为/home/user01
查看是否创建用户(查询用户)
grep user01 /etc/passwd 
或 ls /home/ 
或 id user01
#uid=1000(user01) gid=1000(user01) 组=1000(user01),10(wheel)
```

**修改用户密码**

```shell
passwd user01	
#显示 
#新的密码:

passwd 		#不带用户名,当前是哪个用户就修改哪个用户的密码
```

> 普通用户不能创建用户,普通用户touch 创建的文件在/home/ 下

whoami

```shell
whoami      #user01
```

**创建用户指定选项**

```shell
useradd user02 -u 1503		#指定创建的用户的uid
#查看用户
tail -2 /etc/passwd			#查看文件尾部的2行

useradd user03 -d /user03 			#指定创建用户的家目录为/user03 directory
```

**删除用户**

```shell
userdel -r user01		#删除用户,-r 表示一同删除其家目录,这样就不会有遗留的家目录文件夹没有删除
#查看是否删除
id user01
#或
ls /home/   #如果删除用户没有加-r ,则这里仍会有文件夹
```

**修改用户属性**

```shell
usermod -s/sbin/nologin user03		#修改登入SHELL,禁止使用user03 账号登入,-s shell,/sbin/nologin 地址只要不是 tail -1 /etc/passwd 显示当前账号的/bin/bash 都可以禁止登入
tail -1 /etc/passwd     #显示的/bin/bash 变成/sbin/nologin
```

##### **用户组**

**创建用户组**

```shell
groupadd hr		#创建hr 组
cat /etc/group 	#查看组的信息,添加hr 组到最后
grep hr /etc/group	#查看group 中组中hr 信息
```

**创建用户组 带选项**

用户名和组名不能是纯数字,会和id 混淆

```shell
groupadd hr -g 2000  	#创建用户指定组号为2000
```

**删除组**

```shell
groupdel hr		
```

**修改组号**

```shell
groupmod -g 1512 DDD		#修改DDD 组号为1512
#查看组ID
grep DDD /etc/group
```

**组的分类**

1. 基本组:随用户而创建,组名同用户名,在/etc/passwd 中查看组号
2. 附加组:用户加入的其他组

用户可以有多个组

基本组和附加组是相对用户来说的,如果用户不在哪个组中,那么这个组既不是基本组也不是附加组

**案例**

- useradd 是创建用户的命令
- usermod 是修改用户的命令
- groupadd 是创建组的命令
- -u 指定用户的UID
- -g 指定用户的基本组
- -G 指定用户的附加组
- /etc/passwd 可以查看的是用户的基本组
- /etc/group 可以查看用户的附加组,id 命令也可以看
- 创建用户AAA,同时生成基本组AAA
  - useradd AAA
- 创建用户BBB,同时生成基本组BBB
  - useradd BBB
- 创建组CCC
  - groupadd CCC
- 修改用户AAA 的基本组为CCC
  - usermod AAA -g CCC
- 查看AAA  的基本组
  - grep AAA  /etc/passwd
- 修改用户BBB 的附加组为CCC
  - usermod BBB -G CCC
- 查看BBB 的附加组CCC
  - grep CCC /etc/group

**从组中移除用户**

```shell
gpasswd -d AAA GROUP 		#AAA 是用户名,GROUP 是组名,把AAA 从GROUP 移除,用户必须有最少一个组,只有一个组的用户无法删除
```

#### 3.提权

**永久提权(Switching users width su)**

```shell
useradd one			#普通用户使用添加用户会报错,需要切换到root 用户
su - root  或su      #切换到root,直接su 也是切换到root, su - AAA ,切换到AAA 用户,使用su 也可以省略 - ,比如 su AAA ,切换到AAA,带- 与不带有一定的区别,以后会讲
whoami				#查看当前的用户
```

exit

```shell
exit 	#登出用户,返回切换前的用户 或 退出终端  ,reboot 是重启服务器(电脑)
```

**临时提权(Running commands as root width sudo)**

可以完成部分特权指令

```shell
user machine =commands		#用户 登入的主机=(可以变换的身份)可以执行的命令

#示例
#以root 身份授权普通用户xunlei
vim /etc/sudoers
#在第197 行查看,允许wheel 用户组中的用户在不输入该用户的密码的情况下使用所有的命令,ALL 的权限最大
#wheel 在机器装机时就存在的用户组
# %wheel ALL =(ALL) NOPASSWD:ALL


useradd xunlei -G wheel
id xunlei
passwd xunlei

#切换到xunlei 用户登入
useradd gougou   #提示权限不够
sudo useradd gougou 	#创建用户成功
id gougou		#查看用户
```

