# 网络管理

**图形化方式联通两个电脑**

虚拟机->虚拟机设置->网络适配器->使用NAT 模式(这样配置的多台虚拟机在物理上是可以相互互通的)

在设置->网络,打开有线连接

ipconfig 查看是否网络联通

虚拟机的 IPv4 地址前三段一样,表示可以相互联通

一台可以互通的Linux 服务器yum -y install httpd 并关闭防火墙,另一台在浏览器输入前一台的ip 地址就可以访问到其服务器

**使用命令行联通**

```shell
ls /etc/sysconfig/network-scripts/		#查看网卡配置位置
# ifcfg-ens160			#网卡配置文件,有多少个网卡就有多少个文件

#如果vim 编辑这个文件时将其杀死,会产生.swap 隐藏文件,导致网卡失效
#解决方法:ls -a 查看隐藏文件,并删除隐藏文件
```



## 一.简介

### 1.网络接口名称规则

> 传统上,Linux 中的网络接口被枚举为eth0 (ethernet 以太网), eth1 , eth2 等,然而设置这些名称可能会导致更改哪个接口获取作为设备添加和删除的名称,RedHatEnterpriseLinux7 中的默认命名行为是基于固件,设备拓扑结构和设备类型
>
> 接口名称包含以下字符:
>
> 以太网接口以en 开头,WLAN 接口以wl 开头,WWAN 接口以ww 开头
>
> 下一个字符表示适配器的类型,其中o 表示板载, s 表示热插拔插槽, p 表示PCI 地理位置
>
> 默认情况下不使用,但管理员也可以使用,x 用于合并MAC 地址
>
> 最后,数字N 用于表示索引,ID 或端口
>
> 如果无法确定固定名称,将使用传统名称,例如ethN
>
> 例如,第一嵌入式网络接口可以被命名为eno1 ,而PCI 卡网络接口可以被命名为enp2s0
>
> 如果用户知道端口和端口名之间的关系,则新名称可以更容易的区分两者,但是取舍是,用户不能假设一个具有一个接口的系统调用该接口eth0

### 2.NetworkManager 服务

网络管理器(NetworkManager ) 是一个动态网络的控制器与配置系统,它用于当网络设备可用时保持设备和连接开启并激活

默认情况下,CentOS/RHEL 7 已经安装网络管理器,并处于启用状态

```shell
#查看网络管理程序的状态
systemctl status NetworkManager

#NetworkManager.service - Network Manager
#   Loaded: loaded (/usr/lib/systemd/system/NetworkManager.service; enabled; ven>
#   Active: active (running) since Thu 2022-03-31 21:09:14 CST; 52min ago		
#active (running)  表示程序正在运行

#     Docs: man:NetworkManager(8)
#使用 man NetworkManager 查看文档

# Main PID: 1172 (NetworkManager)
#此程序的PID 

#    Tasks: 3 (limit: 11160)
#子进程数量 3个

#   Memory: 5.9M
#   CGroup: /system.slice/NetworkManager.service
#           └─1172 /usr/sbin/NetworkManager --no-daemon
#
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 21:54:13 localhost.localdomain NetworkManager[1172]: <info>  [1648734853>
#3月 31 22:01:36 localhost.localdomain NetworkManager[1172]: <info>  [1648735296>

#查看网络子管理程序的状态
systemctl status network		#修改ip 地址时,需要用到systemctl restart network
```

### 3.配置网络的工具

#### 1.图形配置

**简易图形:nmtui**

```shell
nmtui		#弹出图形界面
```

**图形界面:nm-connection-editor**

```shell
nm-connection-editor		#弹出图形界面
```



#### 2.命令配置:

**配置文件:vim**

```shell
ls /etc/sysconfig/network-scripts/		#查看网卡配置位置
vim /etc/sysconfig/network-scripts/ifcfg-ens160		#编写网卡配置文件  ifcfg-ens160
```

**命令行:nmcli**

如果没有这个命令,可以执行` yum -y install NetworkManager`,nmcli 配置网络比较复杂,不常用

```shell
nmcli device	#显示网卡

# DEVICE      TYPE      STATE   CONNECTION 
# ens160      ethernet  已连接  ens160     	#ethernet 为真正的网卡
# virbr0      bridge    已连接  virbr0     	#其他的都是虚假网卡
# lo          loopback  未托管  --         
# virbr0-nic  tun       未托管  --    
```



## 二.配置网络参数

### 1.配置IP

#### 1.方法

**配置网卡参数**

先备份网卡配置文件，在修改

```shell
[root@localhost ~]# cp /etc/sysconfig/network-scripts/ifcfg-ens160  .		# . 表示当前目录下,此时目录是 [root@localhost ~] 下的家目录 ~

vim /etc/sysconfig/network-scripts/ifcfg-ens160

#值 有无 "" 都可以,比如 TYPE=Ethernet
# 内容的顺序不重要,都可以
TYPE="Ethernet"		
BOOTPROTO="dhcp"			#获取IP(IPV4) 地址的方式,相当于手机获取手机卡, boot 启动 protocol 协议,值有三种:dhcp(自动) none(手动) static(静态)	
#dhcp 动态主机配置协议,自动为 等待vnware 给我们发
#手动配置IP 地址
#BOOTPROTO=none	
#IPADDR=192.168.142.131		#每一个电脑的ip 是不一样的,瞎配不能上网,根据自动获取的机制进行配置(如果两台电脑IP 一样,会起冲突,因为用人用过了,导致都下线,类似手机号 ),IP 互联网协议 ADDRESS 地址
#NETMASK=255.255.255.0		#子网掩码,为解决ip 地址不够,与ip 成对存在,就像手机掩码区分手机卡是联通还是移动的,此时的掩码分两部分,一部分255 (网络,前三段),一部分是0 (主机,后一段)
#IP 地址是一台主机在网络中的标识,同一个网络中可以直接通信,子网掩码决定是否是同一个网络,如果两个掩码一样,表示在同一个网络中,下节课讲
# IP 用来定义主机 ,掩码 用来定义网络,表示这个IP 的网络

#前面的为了通信,后面的配置为了上网
GATEWAT=10.18.43.1		#网关,也叫默认路由,带你上网的路由器地址,(怎么出去)
DNS1=8.8.8.8			#DNS,域名解析,当你输入域名访问时,他告诉你IP 地址,找到这台服务器,(出去找谁)Domian Name ,根据查看IP 时看到的DNS 配置,需要在DNS 后接数字,只能接1 或2
#IPV6INIT="yes"		#IPV6 的配置只在实验中使用,公司一般都不使用,IPV6 是IPV4 的升级版,拥有更多的地址
#IPV6_AUTOCONF="yes"
#IPV6_DEFROUTE="yes"
#IPV6_FAILURE_FATAL="no"
#IPV6_ADDR_GEN_MODE="stable-privacy"

ONBOOT="yes"		#是否启用该设备,即网卡禁不禁用,开机是否启动,等同于 图形化操作,设置>网络>打开有线连接,但是需要重启网卡文件内容才会修改,使用systemctl restart network 重启网卡


#网卡信息.这三是网卡的身份证号,不需要动
NAME="ens160"
UUID="e5d98583-83ef-4d27-b891-e1d04a6364be"
DEVICE="ens160"
```

**重启网络服务**

```shell
#配置完后需要重启网络
systemctl restart network	#不报错即配置正确,报错还原备份,重新配置
```

**查看IP 地址**

```shell
ip a

#ping 另一台主机的IP 地址看是否联通
ping 192.168.142.131
```

### 2.主机名

**查看主机名**

```shell
hostname		#查看主机名
hostname aaa		#临时修改主机名
```

**配置主机名**

```shell
hostnamectl set- hostname qianfeng.example.com	#ctl 为control 控制指令,永久修改主机名,改的也是  /etc/hostname	修改主机名是为了区别不同的主机,但有得主机名会被其他服务器列入黑名单
```

**查看和配置主机名**

```shell
cat /etc/hostname		#这里也可以查看和配置主机名,永久修改主机名
vim  /etc/hostname
```

**重启生效**

```shell
reboot
```

### 3.网络测试工具

**测试工具**

```shell
ip a			#查看所有IP (ifconfig)
ip route		#查看路由,查看网关
ip r			#查看路由,查看网关
ip neigh		#另一台主机ping 通,查看邻居,需要先ping 通信后才会显示邻居
ping 127.0.0.1	#127.0.0.1 代表本机,如果本机不通,那么其他服务器也不能与此机通信

#ping (Packet Internet Groper) ,因特网包探索器
#两台虚拟机要通信,vment 一定要相同,即都为 虚拟机设置->网络适配器->网络连接->NAT 模式
```

**ports and services**

**安装示例**

```shell
yum -y install httpd vsftpd
systemctl start httpd vsftpd
```

**Show TCP Sockets**

```shell
[root@localhost ~]# ss -tnl			#查看端口号 t tcp, n number ,l list
State     Recv-Q    Send-Q       Local Address:Port        Peer Address:Port    
LISTEN    0         128                0.0.0.0:111              0.0.0.0:*       
LISTEN    0         32           192.168.122.1:53               0.0.0.0:*       
LISTEN    0         128                0.0.0.0:22               0.0.0.0:*       
LISTEN    0         5                127.0.0.1:631              0.0.0.0:*       
LISTEN    0         128                   [::]:111                 [::]:*       
LISTEN    0         128                   [::]:22                  [::]:*       
LISTEN    0         5                    [::1]:631                 [::]:*   
```

### 4.初始化服务器

**最小化安装**

**1.为你的服务器配置root 密码**

**2.配置IP 地址(VMNAT8)**

**3.配置YUM 源**

1. 自动挂载光驱/阿里YUM
2. 配置YUM 库

**4.关闭防火墙**

```shell
systemctl stop firewalld	#临时关闭,开机会自启
systemctl disable firewalld		#禁止自启
systemctl status firewalld		#查看防火墙的状态


● firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service;` disabled (禁止自启)`; vendor >
   Active:` inactive (dead 已经关闭)`
     Docs: man:firewalld(1)

4月 02 21:40:24 localhost.localdomain systemd[1]: Starting firewalld - dynamic >
4月 02 21:40:26 localhost.localdomain systemd[1]: Started firewalld - dynamic f>
4月 02 21:40:26 localhost.localdomain firewalld[1075]: WARNING: AllowZoneDrifti>
4月 02 22:02:03 localhost systemd[1]: Stopping firewalld - dynamic firewall dae>
4月 02 22:02:03 localhost systemd[1]: Stopped firewalld - dynamic firewall daem>
lines 1-10/10 (END)

```

**5.selinux**

这是另一道防火墙

```shell
setenforce 0			#临时关闭,数字0,不是o, set enforce ,还有getforce 命令
vim /etc/sysconfig/selinux		#永久关闭
SELINUX=disabled		# 将SELINUX=enforcing 改为SELINUX=disabled
```

**6.安装常用程序**

```shell
yum install -y lrzz systat elinks wget net-tools bash-completion
```

**7.关机,快照**

