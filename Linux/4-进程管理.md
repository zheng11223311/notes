### 一.进程管理 PS(process status)

- 进程管理
- 作业管理
- 虚拟文件系统

**什么是进程?**

进程是已启动的可执行程序的运行实例,进程有以下组成部分:

- 一个文件
- 被分配内存的地址空间
- 有权限限制
- 程序代码的一个或多个副本(也叫执行线程)
- 像人一样拥有状态

which

```shell
which passwd	#查找命令文件所在的位置	/usr/bin/passwd
```

#### 1.静态查看进程ps

```shell
ps aux	
# USER   			PID 	     %CPU         %MEM    			VSZ   
#运行进程的用户	  进程的序号	  	cpu 占用率		内存占用率		占用虚拟内存的大小(硬盘分配出来的部分空间)	

# RSS			     TTY      					STAT  	START        TIME     COMMAND
#占用实际内存的大小 进程运行的终端(在哪个shell 窗口)	  进程状态    进程启动时间   运行占用cpu的时长	进程文件

#stat 的状态有:sleeping 休眠中,在内存中没有停,但是没有给cpu(Ss),zombie 僵死状态(程序未响应,占用cpu)(Z), running 运行中(R), Stopped 暂停(T), D 不可中断的睡眠(等待),N(nice) 低优先级任务 ,s  进程是会话期首进程,+ 进程属于前台进程组,l 进程是多线程的,< 高优先级任务,....
#TTY  ? 本机打开的终端, pts  远程登入(pts/0 第一个远程窗口,pts/1 第二个窗口)

ps aux | less		#使用less 翻页查看进程信息, | 管道符
```

**进程的生命周期**

父进程复制自己的地址空间(fork)创建一个新的(子)进程结构

每个新进程分配一个唯一的进程ID (PID),满足跟踪安全性之需

任何进程都可以创建子进程

所有进程都是第一个系统进程的后代

> Centos 5/6 系统进程: init
>
> Centos 7 系统进程:systemd

**命令参数说明:**

```shell
ps a	#显示现行终端机下的所有程序	all
ps u 	#以用户为主的格式来显示程序状况 user
ps x	#不以终端机来区分
```

##### 1.进程排序

语法:ps aux --sort %cpu

```shell
ps aux --sort %cpu		#按照%cpu 升序排序
ps aux --sort user		#按照user 升序排序
ps aux --sort -%cpu		#按照%cpu 降序排序,- 为降序
```

##### 2.进程的父子关系

语法:ps -ef

```shell
ps -ef
# UID      PID    		PPID  		C 		STIME 	TTY          TIME 			CMD
# 用户	进程的序号	父进程的序号				启动时间 进程的终端		运行时长		进程文件
```

**自定义显示字段**

语法:ps axo

```shell
ps axo  user,pid,ppid,%mem	|head -3	#自定义查看user,pid,ppid,%mem 字段的前3行	,o 自定义显示列
```

#### 2.动态查看进程top

```shell
top 
#显示
#性能部分
top - 12:01:12 up  1:41,  1 user,  load average: 0.01, 0.02, 0.00
#程序名-系统时间	运行时间  登入用户数量 CPU负载 		5分钟,10分钟,15分钟的状况
Tasks: 313 total,   1 running, 312 sleeping,   0 stopped,   0 zombie
#任务总数		总进程数	  运行数量		睡眠数量		停止数量		僵死数量
%Cpu(s):  0.7 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.3 hi,  0.0 si,  0.0 st
#CPU使用占比  us 用户	sy系统	ni优先级  id空闲	   wa等待   hi硬件		si软件	st 虚拟机
#window 中的IDL 进程即空闲的cpu
MiB Mem :   1800.6 total,    		 119.3 free,   1408.9 used,    272.5 buff/cache
#物理内存:	total总共4G(1800.6*1800.6) free空闲0.4G		used使用		cache缓存硬盘内容
MiB Swap:   2048.0 total,   1813.0 free,    235.0 used.    216.7 avail Mem 
#交换分区

#进程状态
 PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND  
   2170 root      20   0 2651200 104764  47932 S   2.0   5.7   0:11.65 gnome-s+ 
   1845 gdm       20   0 2603968  56800  16212 S   0.3   3.1   0:04.94 gnome-s+ 
   2232 root      20   0  437120   9368   3100 S   0.3   0.5   0:00.33 ibus-ex+ 
   2640 root      20   0  615876  38652  24208 S   0.3   2.1   0:01.00 gnome-t+ 
   3879 root      20   0   64860   4920   4036 R   0.3   0.3   0:00.23 top      
      1 root      20   0  245364   5952   3580 S   0.0   0.3   0:01.58 systemd  
      2 root      20   0       0      0      0 S   0.0   0.0   0:00.00 kthreadd 
      3 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_gp   
      4 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_par+ 
      6 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+ 
      8 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 mm_perc+ 
      9 root      20   0       0      0      0 S   0.0   0.0   0:00.10 ksoftir+ 
     10 root      20   0       0      0      0 I   0.0   0.0   0:00.14 rcu_sch+ 
     11 root      rt   0       0      0      0 S   0.0   0.0   0:00.00 migrati+ 
     12 root      rt   0       0      0      0 S   0.0   0.0   0:00.00 watchdo+ 
     13 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/0  
     15 root      20   0       0      0      0 S   0.0   0.0   0:00.00 kdevtmp+
   
# PID 		USER      PR  		NI   	 	VIRT    RES    
#进程编号	  用户	 优先级	低优先级	虚拟内存	实际内存
	
#SHR 		S     	%CPU  			%MEM     	TIME+ 		COMMAND  
#共享内存	 状态		cpu 占用率		内存占用率		运行时长	命令文件
```

**top 常用内部指令**

在top 命令下显示动态数据时,按如下键:

- h|? 帮助
- M 按内存的使用排序
- P 按CPU 使用排序
- N 按PID 的大小排序
- < 向前
- \>向后
- z 彩色,z 设置彩色,使用数字调整

**top 技巧**

```shell
top			#回车,立刻刷新
top -d 1	#每1s 刷新
top -d 1 -p 10126	#查看指定进程的动态信息
top -d 1 -p 10126,1		#查看多个进程10126和1
```

按q 退出top

#### 3.使用信号控制进程kill

**信号种类**

```shell
kill -l  #列出所有支持的信号,64种信号

#常用信号 
#1)SIGHUP 重新加载配置
#2)SIGINT 键盘中断CTRL+ C
#3)SIGQUIT 键盘退出Ctrl+\ ,类似SIGINT,内核不同
#9)SIGKILL 强制终止,无条件
#15)SIGTERM 终止(正常结束),缺省信号
#18)SIGVONT 继续
#19)SIGSTOP 暂停
#20)SIGTSTP 键盘暂停Ctrl+Z

#发送信号1
kill -1 8843     #kill -信号标识 PID ,发送1 信号 ,8843 重新加载配置
```

tty

```shell
tty			#当前使用终端的名字	/dev/pts/0
```

#### 4.进程优先级nice

**简介**

Linux 进程调度及多任务

每个CPU 在一个时间点上只能处理一个进程,通过时间片技术,来同时运行多个程序

**优先级范围和特性**

Nice 优先级:

> [-20,19],总共40个数字

系统中的两种优先级:

> 在top 种显示的优先级有两个,PR 值和nice 值,top[PR] 的优先级[-99,39] 
>
> NI: 实际nice 值
>
> PR(+20):将nice 级别显示为映射到更大优先级队列,-20 映射到0,+19映射到39

优先级特性:

> nice 值越大:表示优先级越低,例如+19
>
> nice 值越小:表示优先级越高,例如-20

我们自己调的优先级(nice),在系统上会增加20(即我们能修改的优先级范围是很小的,系统的优先级top 范围更大),保证系统的正常工作

**查看进程的nice 级别**

```shell
ps axo pid,command,nice --sort=-nice | head -5

#  PID COMMAND                      NI
     23 [khugepaged]                 19
   2519 /usr/libexec/tracker-miner-   -
   2522 /usr/libexec/tracker-miner-  19
     22 [ksmd]                        5

```

**启动具有不同nice 级别的进程**

默认情况:

> 启动进程时,通常会继承父进程的 nice 级别,默认为0

sleep

```shell
sleep 5     	#系统倒计时,在倒计时时间内不执行任何输入的命令,单位s ,倒计时5s,默认是占用系统前台显示
sleep 10 &		#倒计时10s,在后台显示,不占用前台
```

手动启动不同nice:

```shell
nice -n -5 sleep 1000 &		#设置sleep 程序级别为-5 ,-n 优先级
ps axo pid,command,nice	|grep sleep		#查看sleep 的优先级
#显示
   2989  -5 sleep 1000
   2997   0 grep --color=auto sleep


renice -20 2989		#修改PID 为2989 的进程的nice 级别为-20
```

**更改现有进程的nice 级别**

### 二.作业控制jobs(了解)

作业控制是一个命令功能,也叫后台运行,把一个程序放到后台种运行

**关键词介绍:**

foreground:(fg)

前台进程:是在终端中运行的命令,占领终端

background:(bg)

后台进程:没有控制终端,它不需要终端的交互,看不见,但是在运行

**后台程序控制示例**

```shell
#观察占领前台的现象,运行一个程序,当终端无法输入,观察占领前端的现象,大部分命令行输入已经无效mctrl+c 终止进程
sleep 2000

#运行后台程序
sleep 2100 &		#& and

#ps 查询所有程序
ps aux |grep sleep

#jobs 查看后台进程
jobs
#[1]-  运行中               sleep 2000 &
#[2]+  运行中               sleep 2100 &		#+ 表示最新执行的程序,- 表示较次

#调动后台程序至前台
fg 2				#将jobs 下显示的2标识的进程调至前台
# ctrl+z 可以把前台正在运行的程序调至后台,但是会暂停此进程,jobs 查看会有一个程序从运行中变成已停止

#调动后台停止的程序在后台运行
bg 2			#将jobs 下显示的2标识的停止进程运行起来

#消灭后台进程
kill %1			#消灭1 进程,进程前需要带%
#注意,kill 1  和 kill %1 不同,
#前者终止PID 为1 的进程
#后者杀死作业序号为1 的后台程序

```

### 三.虚拟文件系统proc(了解)

/proc/ 下存储着数字为进程id,会随着进程得出现和消失而出现和消失

**简介:**

虚拟文件系统:

采集服务器自身内核进程运行的状态信息

**CPU 信息:**

```shell
cat /proc/cpuinfo
```

**内存:**

```shell
cat /proc/meminfo
```

**内核:**

```shell
cat /proc/cmdline
```

