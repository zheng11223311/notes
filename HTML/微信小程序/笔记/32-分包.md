# 基础概念

### 什么是分包

分包指的是把一个`完整的小程序项目`,按照需求`划分为不同的子包`,在构建时打包成不同的分包,用户在使用时`按需进行加载`



### 分包的好处

对小程序进行分包的好处主要有以下两点:

- 可以`优化小程序首次启动的下载时间`
- 在`多团队共同开发`时可以更好的`解耦协作`





### 分包前项目的构成

分包前,小程序项目中`所有的页面` 和`资源`都被打包到一块,导致整个`项目体积过大`,影响小程序`首次启动的下载时间`

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-1.png)

### 分包后项目的构成

分包后,小程序项目由`1 个主包+多个分包`组成:

- 主包:一般只包含项目的`启动页面`或`tabBar 页面` ,以及所有分包都需要用到的一些`公共资源`
- 分包:只包含和当前分包有关的页面和私有资源

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-2.png)



### 分包的加载规则

- 在小程序启动时,默认会`下载主包`并`启动主包内页面`
  - tabBar 页面需要放到主包中
- 当用户进入分包内某个页面时,`客户端会把对应分包下载下来`,下载完成后在在进行展示
  - 非tabBar 页面可以按照功能的不同,划分为不同的分包之后,进行按需下载



### 分包的体积限制

目前.小程序分包的大小有以下两个限制:

- 整个小程序所有分包大小不超过16M (主包+所有分包)
- 单个分包/主包 大小不能超过 2M
- 否则会发布失败



# 使用分包

### 配置方法

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-3.png)

在subpackages 中写入路径后,保存,会像pages 一样 自动创建文件夹

name 为整个分包的别名



查看分包的大小

工具栏 详情->基本信息->本地代码





### 打包原则

1. 小程序会按`subpackages`的配置进行分包,subpackages 之外的目录将会被打包到主包中
2. 主包也可以有自己的pages (即最外层的pages 字段)
3. tabBar 页面必须在主主包内
4. 分包之间不能互相嵌套











### 引用原则

- 主包`无法引用`分包内的私有资源
- 分包之间`不能相互引用`私有资源
- 分包`可以引用`主包内的公共资源

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-2.png)



# 独立分包

### 什么是独立分包

独立分包`本质上也是分包`,只不过它比较特殊,`可以独立与主包和其他分包而单独运行`

用户可以通过分包直接打开小程序

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-4.png)

### 独立分包和普通分包的区别

最主要的区别:`是否依赖于主包才能运行`

- 普通分包必须依赖于主包才能运行
- 独立分包可以不下载主包的情况下,独立运行





### 独立分包的应用场景

开发者可以按需,将某些`具有一定功能独立性的页面`配置到`独立分包`中,原因如下:

- 当小程序从普通的分包页面启动时,需要首先下载主包
- 而独立分包`不依赖主包`即可运行,`可以很大程度上提升分包页面的启动速度`

**注意:一个小程序中可以有多个独立分包**



### 独立分包的配置分包

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-5.png)





### 引用原则

独立分包和普通分包以及主分包之间,是`相互隔绝`的,`不能相互引用彼此的资源`! 例如;

- 主包`无法引用`独立分包内的私有资源
- 独立分包之间,`不能相互引用`私有资源
- 独立分包和普通分包之间,`不能相互引用`私有资源
- **特别注意:独立分包中不能引用主包内的公共资源**



# 分包预下载

### 什么是分包预下载

分包预下载指的是:在进入小程序的某个页面时,`由框架自动下载可能需要的分包`,从而提升进入后序分包页面时的启动速度



### 配置分包的预下载

`预下载分包的行为,会在进入指定的页面时触发`,在app.json 中,使用`preloadRule` 节点定义分包的预下载规则,示例代码如下:

```json
{
    "preloadRule":{		//分包预下载规则
        "pages/contact/contact":{	//触发分包预下载的页面路径
            // network 表示在指定的网络模式下进行预下载
            //可选值为: all (不限网路) 和wifi (仅wifi 模式下预下载)
            //默认值为:wifi
            "network":"all",
            //packages 表示进入页面后,预下载那些分包
            //可以通过root 或name 自动预下载那些分包
            "packages":['pakgA']
        }
        
    }
}
```





### 分包预下载的限制

同一个分包中的页面享有`共同的预下载大小限额2M`,例如:

![](D:\学习\wanye\HTML\微信小程序\笔记\img\32-6.png)

