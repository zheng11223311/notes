# 事件绑定

### 什么是事件

事件是`渲染层到逻辑层的通讯方式`,通过事件可以将用户在渲染层产生的行为,反馈到逻辑层进行业务的处理

![](D:\学习\wanye\HTML\微信小程序\笔记\img\13-1.png)





### 小程序中常用的事件

| 类型   | 绑定方式                 | 事件描述                                     |
| ------ | ------------------------ | -------------------------------------------- |
| tap    | bindtap 或bind:tap       | 手指触摸后马上离开,类似于HTML 中的click 事件 |
| input  | bindinput 或bind:input   | 文本框的输入事件                             |
| change | bindchange 或bind:change | 状态改变时触发                               |





### 事件对象的属性列表

当事件回调触发的时候,会收到一个事件对象event ,他的详细属性如下表所示:

| 属性           | 类型    | 说明                                        |
| -------------- | ------- | ------------------------------------------- |
| type           | String  | 事件类型                                    |
| timeStamp      | Integer | 页面打开到触发事件所经过的毫秒数            |
| `target`       | Object  | `触发事件的组件的一些属性值集合`            |
| currentTarget  | Object  | 当前组件的一些属性值集合                    |
| `detail`       | Object  | `额外的信息`                                |
| touches        | Array   | 触摸事件,当前停留在屏幕中的触摸点信息的数组 |
| changedTouches | Array   | 触摸事件,当前变化的触摸点信息的数组         |





### target 和currentTarget 的区别

`target`是`触发该事件的源头组件`,而`currentTarget`则是`当前事件所绑定的组件`,举例如下:

![](D:\学习\wanye\HTML\微信小程序\笔记\img\13-2.png)

点击内部的按钮时,点击事件以`冒泡`的方式向外扩散,也会触发外层view 的tap 事件处理函数

此时,对于外层的view 来说:

- e.target 指向的是触发事件的源头组件,因此,`e.target ` 是内部的按钮组件
- e.currentTarget  指向的是当前正在触发事件的那个组件,因此,`e.currentTarget 是当前的view 组件`



# bindtap 的语法格式

在小程序中,不存在HTML 中的onclick 鼠标点击事件,而是通过`tap 事件`来响应用户的触摸行为

1. 通过`blindtap`,可以为组件绑定tap 触摸事件,语法如下:

   ```html
   <button type="primary" bindtap="btnTapHandler">按钮</button>
   ```

2. 在页面的 .js  文件中定义对应的事件处理函数,事件参数通过形参`event` (一般`简写成e`)来接收:

   ```js
   Page({
       btnTapHandler(e){	//按钮的tap 事件处理函数
           console.log(e)	//事件参数对象e
       }
   })
   ```







### 在事件处理函数中为data 中的数据赋值

通过调用`this.setData(dataObject)`方法,可以给页面data 中的数据重新赋值,示例如下:

```js
// 页面的 .js 文件
Page({
    data:{
        count:0
    },
    //修改count 的值
    changeCount(){
    this.setData({
        count:this.data.count+1
    })
}
})
```





### 事件传参

小程序中的事件传参比较特殊,`不能在绑定事件的同时为事件处理函数传递参数`,例如,下面的代码将不能正常工作:

```html
<button type="primary" bindtap="btnTapHandler(123)">按钮</button>
```

因为小程序会把bindtap 中的属性值,统一当做事件名称来处理,相当于要调用一个名称为`btnTapHandler(123)`的事件处理函数,即将`btnTapHandler(123)`整体当做一个函数名

可以为组件提供`data-*` 自定义属性传参,其中 `* 代表的是参数的名字`,示例代码如下:

```html
<button type="primary" bindtap="btnTapHandler" daya-info="{{2}}">数值类型的2</button>
<button type="primary" bindtap="btnTapHandler" daya-info="2">文本类型的2</button>
```

最终:

- `info `会被解析为`参数的名字`
- 数值 `2` 会被解析为`参数的值`



在事件处理函数中,通过`event.target.dataset.参数名` 即可获取到`具体参数的值`,示例代码如下:

```js
btnTapHandler(event){
    //dataset 是一个对象,包含了所有通过data-* 传递过来的参数项
    console.log(event.target.dataset)
    //通过 dataset 可以访问到具体参数的值
    console.log(event.target.dataset.info)
}
```





# bindinput 的语法格式

在小程序中,通过`input 事件`来响应文本框的输入事件,语法格式如下:

- 通过bindinput ,可以为文本框绑定输入事件:

  ```html
  <input bindinput="inputhandler"></input>
  ```

- 在页面的 .js 文件中的定义事件处理函数:

  ```js
  inputhandler(e){
      //e.detail.value 是变化过后,文本框最新的值 ,即实时监听
      console.log(e.detail.value)
  }
  ```

  



### 实现文本框和data 之间的数据同步

实现步骤

1. 定义数据

   ```js
   Page({
       data:{
           msg:'你好'
       }
   })
   ```

2. 渲染结构

   ```html
   <input bindinput="inputhandler" value={{msg}}></input>
   ```

3. 美化样式

   ```css
   input{
       border:1px solid #eee;
       padding:5px;
       margin:5px;
       border-radius:3px;
   }
   ```

4. 绑定input 事件处理函数

   ```js
   //文本框内容改变的事件
   inputhandler(e){
       this.setData{
           //通过e.detail.value 获取到文本框最新的值
           msg:e.detail.value
       }
   }
   ```

   