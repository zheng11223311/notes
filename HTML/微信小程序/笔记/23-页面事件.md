# 页面事件

### 什么是下拉刷新

`下拉刷新`是移动端的专有名称,指的是通过手指在屏幕上的下拉滑动操作,从而`重新加载页面数据`的行为



### 启用下拉刷新

1. **全局开启下拉刷新**
   1. 在app.json 的window 节点中,将enablePullDownRefresh 设置为true
2. **局部开启下拉刷新**
   1. 在页面的 .json 配置文件中,将enablePullDownRefresh 设置为true

在实际开发中,推荐使用第二种方式,`为需要的页面单独开启下拉刷新的效果`





### 配置下拉刷新窗口的样式

在全局或页面的 .json 配置文件中,通过`backgroundColor` 和`backgroundTextStyle`来配置下拉刷新窗口的样式,其中:

- `backgroundColor`用来配置下拉刷新`窗口的背景颜色`,仅支持16进制的颜色值
- `backgroundTextStyle` 用来配置下拉刷新`loading 的样式`,仅支持dark 和light





### 监听页面的下拉刷新事件

在页面的 .js 文件中,通过`onPullDownrefresh()`函数即可监听当前页面的下拉刷新事件

```js
 /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh() {

  },
```





### 停止下拉刷新的效果

当处理完下拉刷新后,下拉刷新的loading 效果会一直显示,`不会主动消失`,所以需要手动隐藏loading 效果,此时,调用`wx.stopPullDownRefresh() ` 可以停止当前页面的下拉刷新,示例代码如下:

```js
 /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh() {
      // .....
		wx.stopPullDownRefresh()
      //也可以使用回调函数
          wx.stopPullDownRefresh({
              complete:()=>{}
          })
  },
```





# 什么是上拉触底

`上拉触底`是移动端的专有名词,通过手指在屏幕上的上拉滑动操作.从而`加载更多数据`的行为





### 监听页面的上拉触底事件

在页面的 .js 文件中,通过`onReachbottom()`函数即可监听当前页面的上拉触底事件,示例代码如下:

```js
  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom() {

  },

```



### 配置上拉触底距离

上拉触底距离指的是`触发上拉触底事件时,滚动条距离页面底部的距离`

可以在全局或页面的.json 配置文件中,通过`onReachBottomDistance` 属性来配置上拉触底的距离,不需要带单位

小程序默认的触底距离时50px ,在实际开发中,可以根据自己的需求修改这个默认值









# 上拉触底案例

### 案例效果展示

![](D:\学习\wanye\HTML\微信小程序\笔记\img\23-1.png)



### 案例的实现步骤

1. 定义获取随机颜色的方法
2. 在页面加载时获取初始数据
3. 渲染UI 结构并美化页面效果
4. 在上拉触底时调用获取随机颜色的方法
5. 添加loading 提示效果
6. 对上拉触底进行节流处理





### 步骤1 - 定义获取随机颜色的方法

```js
data:{
    colorList:[]	//随机颜色的列表
},

getColor(){		//获取随机颜色的方法
    wx.request({	//发起网络数据请求,获取随机颜色的数组
        url:"https://www.escook.cn/api/color",
        method:"GET",
        success:({data:res})=>{
            this.setData({
                colorList:[...this.data.colorList,...res.data]
            })
        }
    })
},
```



### 步骤2 - 在页面加载时获取初始数据

```js
/**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    this.getColor()
  },

```



### 步骤3 - 渲染UI 结构结构并美化页面效果

```html
<!--wxml 结构 -->
<view wx:for="{{colorList}}" wx:key="index" class="num-item" style="background-color:rgba({{item}})">{{item}}</view>
```

```css
//wxss 样式
.num-item{
    border:1rpx solid #efefef;
    border-radius:8rpx;
    line-height:200rpx;
    margin:15rpx;
    text-align:center;
    text-shadow:0rpx 0rpx 5rpx #fff;
    box-shadow:1rpx 1rpx 6rpx #aaa;
}
```





### 步骤4 - 在上拉触底时调用获取随机颜色的方法

```js
  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom() {
    // 调用获取随机颜色的方法
    this.getColor()
  },
```





### 步骤5 - 添加loading 提示效果

 [wx.showLoading(Object object) | 微信开放文档 (qq.com)](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showLoading.html) 

```js
getColor() { //获取随机颜色的方法
    wx.showLoading({  //  展示loading 效果
      title:'数据加载中...' 
    })
    wx.request({ //发起网络数据请求,获取随机颜色的数组
      url: "https://www.escook.cn/api/color",
      method: "GET",
      success: ({
        data: res
      }) => {
        this.setData({
          colorList: [...this.data.colorList, ...res.data]
        })
      },
      complete:()=>{
        wx.hideLoading({})  //隐藏loading 效果
      }
    })
  },
```





### 步骤6 - 对上拉触底进行节流处理

1. **在data 中定义 isloading 节流阀**
   1. false 表示当前没有进行任何数据请求
   2. true 表示当前正在进行数据请求
2. **在getColor() 方法中修改isloading 节流阀的值**
   1. 在刚调用getColor 时节流阀设置为true
   2. 在网络请求的complete 回调函数中,将节流阀重置为false
3. **在onReachBottom 中判断节流阀的值,从而对数据请求进行节流控制**
   1. 如果节流阀的值为true,则阻止当前请求
   2. 如果节流阀的值为false,则发起数据请求



```js
// pages/contact/contact.js
Page({

  /**
   * 页面的初始数据
   */
  data: {
    colorList: [], //随机颜色的列表
    isloading:false
  },
  getColor() { //获取随机颜色的方法
    this.setData({
      isloading:true
    })
    wx.showLoading({  //  展示loading 效果
      title:'数据加载中...' 
    })
    wx.request({ //发起网络数据请求,获取随机颜色的数组
      url: "https://www.escook.cn/api/color",
      method: "GET",
      success: ({
        data: res
      }) => {
        this.setData({
          colorList: [...this.data.colorList, ...res.data]
        })
      },
      complete:()=>{
        wx.hideLoading({})  //隐藏loading 效果
        this.setData({
          isloading:false
        })
      }
    })
  },
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    this.getColor()
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady() {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow() {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide() {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload() {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh() {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom() {
    if(this.data.isloading) return
    // 调用获取随机颜色的方法
    this.getColor()
  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage() {

  }
})
```

