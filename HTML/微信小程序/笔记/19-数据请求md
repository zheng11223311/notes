# 数据请求

### 小程序中网络数据请求的限制

出于`安全性`方面的考虑,小程序官方对`数据接口的请求`做出如下两个限制:

1. 只能请求`HTTPS`类型的接口
2. 必须将`接口的域名`添加到`信任列表`中

![](D:\学习\wanye\HTML\微信小程序\笔记\img\19-1.png)





### 配置request 合法域名

需求描述:假设在自己的微信小程序中,希望请求https://www.escook.cn/ 域名下的接口

配置步骤:`登入微信小程序管理后台->开发->开发设置->服务器域名->修改request 合法域名`

微信小程序管理后台: [小程序 (qq.com)](https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=1732721771&lang=zh_CN) 

注意:配置的时候填写 https://www.escook.cn ,不要再域名后面加上 / ,  否则无法添加配置

配置完成后,在`微信开发者工具->详情->项目配置`中 可以查看到



**注意事项:**

1. 域名只支持https 协议
2. 域名不能使用IP 地址或localhost
3. 域名必须经过ICP 备案
4. 服务器域名一个月内最多棵申请5 次修改





#### 发起GET 请求

调用微信小程序提供的 `wx.request`() 方法 ,可以发起GET 数据请求,示例代码如下:

```js
wex.request({
    url:'https://www.escook.cn/api/get',	//请求的接口地址,必须基于https 协议
    method:'GET',	//请求方式
    data:{			//发送到服务器的数据
        name:'zs',
        age:22
    },
    success:(res)=>{	//请求成功之后的回调函数
        console.log(res)
    }
})
```





### 发起POST 请求

调用微信小程序提供的 `wx.request`() 方法 ,可以发起POST 数据请求,示例代码如下:

```js
wex.request({
    url:'https://www.escook.cn/api/get',	//请求的接口地址,必须基于https 协议
    method:'POST',	//请求方式
    data:{			//发送到服务器的数据
        name:'zs',
        age:22
    },
    success:(res)=>{	//请求成功之后的回调函数
        console.log(res)
    }
})
```





### 在页面刚加载时请求数据

在很多情况下,我们需要`在页面刚加载的时候,自动请求一些初始化的数据`,此时需要在页面的`onLoad`事件中调用获取数据的函数,示例代码如下:

![](D:\学习\wanye\HTML\微信小程序\笔记\img\19-2.png)







### 跳过request 合法域名校验

如果后端程序员`仅仅提供了http 协议的接口`,`暂时没有提供https 协议的接口`

此时为了不耽误开发的速度,我们可以在微信开发者工具中,临时开启[`开发环境不校验请求域名,TLS 版本及HTTPS 证书`]选项,跳过request 合法域名的校验

**注意:跳过request 合法域名校验的选项,仅限在开发与调试阶段使用**

![](D:\学习\wanye\HTML\微信小程序\笔记\img\19-3.png)





### 关于跨域和 Ajax 的说明

跨域问题`只存在于`基于浏览器的Web 开发,由于`小程序的宿主环境`不是浏览器,而是`微信客户端`,所以`小程序中不存在跨域的问题`

Ajax 技术的核心是依赖于浏览器中的XMLHttpRequest 这个对象,由于`小程序的宿主环境是微信客户端`,所以小程序中`不能叫做`发起Ajax 请求,而是叫做`发起网络数据请求`

