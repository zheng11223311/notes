# 全局数据共享

### 什么是全局数据共享

`全局数据共享`(又叫做L状态管理) 是为了解决`组件之间数据共享`的问题

开发中常用的全局数据共享方案有:Vuex ,Redux, ModX(也是React 的) 等

![](D:\学习\wanye\HTML\微信小程序\笔记\img\30-1.png)

### 小程序中的全局数据共享方案

在小程序中,可使用`mobx-miniprogram` 配合`mobx-miniprogram-bindings` 实现全局数据共享,其中:

- mobx-miniprogram 用来创建`Store 实例对象`
- mobx-miniprogram-bindings 用来`把Store 中的共享数据或方法,绑定到组件中或页面中使用`





### 安装Mobx 相关的包

```
npm install --save mobx-miniprogram@4.13.2 mobx-miniprogram-bindings@1.2.1
```

**注意: Mobx 相关的包安装完毕之后,记得删除 miniprogram_npm 目录后,重新`构建npm`**





### 创建Mobx 的Store 实例

在项目根目录下创建一个store 目录,在目录中创建store.js 文件, .js 文件中写入

```js
//在这个 JS 文件中,专门来创建Store 的实例对象
import {observable,action} from 'mobx-miniprogram'

export const store=observable({
    //数据字段
    numA:1,
    numB:2,
    //计算属性
    get sum(){
        return this.numA+this.numB
    },
    //action 方法,用来修改store 中的数据
    updateNum1:action(function(step)=>{
                      this.numA+=step
                      }),
    updateNum2:action(function(step)=>{
                      this.numB+=step
                      }),
})
```



### 将Store 中的成员绑定页面中

```js
//页面的 .js 文件
import { createStoreBindings } from 'mobx-miniprogram-bindings'
import { store } from '../../store/store'

Page({
    onLoad:function(){		//生命周期函数 --监听页面加载
        this.storeBindings=createStoreBindings(this,{  //将store 绑定到this 上
            store,	//数据源,将store 绑定到页面上
            fields:['numA','numB','sum'],	//需要绑定的字段
            actions:['updateNum1']	//需要将哪些方法绑定到页面上使用
        })
    },
    onUnload:function(){	//生命周期函数--监听页面卸载
        this.storeBindings.destoryStoreBindings()
    }
})
```





### 在页面上使用Store 中的成员

```html
// 页面的 .wxml 结构
<view>{{numA}}+ {{numB}}={{sum}}</view>
<vant-button type="primary" bindtap="btnHandler1" data-step="{{1}}">numA+1</vant-button>
<vant-button type="primary" bindtap="btnHandler1" data-step="{{-1}}">numA-1</vant-button>
```

```js
// 按钮tap 事件处理函数
btnHandler1(e){
    this.updateNum1(e.target.dataset.step)
}
```





### 将Store 中的成员绑定到组件中

```js
import { storeBindsBehavior } from 'mobx-miniprogram-bindings'
import { store } from '../../store/store'

Component({
    behaviors:[storeBindsBehavior], //通过storeBindsBehavior 来实现自动绑定
       storeBindings:{  //将store 绑定到this 上
            store,	//数据源,将store 绑定到页面上
            fields:{  //指定需要绑定的字段
                numA:()=>store.numA,	//绑定字段的第 1 种方式
                numB:(store)=>store.numB,	//绑定字段的第 2 种方式
                sum:'sum'				//绑定字段的第 3 种方式
            },
            actions:{ //需要将哪些方法绑定到页面上使用
           		updateNum1:'updateNum1'
       		}	
        })
})
```



### 在组件中使用Store 中的成员

```html
// 组件的 .wxml 结构
<view>{{numA}}+ {{numB}}={{sum}}</view>
<vant-button type="primary" bindtap="btnHandler1" data-step="{{1}}">numA+1</vant-button>
<vant-button type="primary" bindtap="btnHandler1" data-step="{{-1}}">numA-1</vant-button>
```

```js
//组件的方法列表
methods:{
    btnHandler1(e){
         this.updateNum1(e.target.dataset.step)
    }
}
```

