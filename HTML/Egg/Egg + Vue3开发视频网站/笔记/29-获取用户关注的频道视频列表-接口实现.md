## 获取用户关注的频道视频列表-接口实现

#### 路由新增

```js
// 获取用户关注的频道视频列表-接口实现
router.get('/users/videos/feed', auth, controller.video.getUserFeedVideos);
```



#### video 控制器新增

```js
  async getUserFeedVideos() {
    const { Video, Subscription } = this.app.model;
    let { pageNum = 1, pageSize = 10 } = this.ctx.query;
    const userId = this.ctx.user._id;
    pageNum = Number.parseInt(pageNum);
    pageSize = Number.parseInt(pageSize);

    const channels = await Subscription.find({ user: userId }).populate('channel');
    console.log(channels);
    const getvideos = Video.find({
      user: {
        $in: channels.map(item => item.channel._id), // 包含在channels 内的user
      },
    })
    // .populate('user').sort({
    //   createAt: -1,
    // })
      .skip((pageNum - 1) * pageSize)
      .limit(pageSize);

    const getvideosCount = Video.countDocuments({
      user: {
        $in: channels.map(item => item.channel._id), // 包含在channels 内的user
      },
    }); // 数据总数量
    const [ videos, videosCount ] = await Promise.all([
      getvideos,
      getvideosCount,
    ]);
    this.ctx.body = {
      videos,
      videosCount,
    };
  }
```

