## 修改视频-接口实现

#### 路由新增

```js
  // 修改视频-接口实现
  router.patch('/videos/:videoId', auth, controller.video.updateVideos);
```



#### video.js 控制器新增

```js
  async updateVideos() {
    const body = this.ctx.request.body;
    const { Video } = this.app.model;
    const { videoId } = this.ctx.params;
    const userId = this.ctx.user._id;

    // 数据验证
    this.ctx.validate({
      title: { type: 'string', required: false },
      description: { type: 'string', required: false },
      vodVideoId: { type: 'string', required: false },
      cover: { type: 'string', required: false },
    }, body);

    // 查询视频
    const video = await Video.findById(videoId);
    // console.log(video);
    // console.log( this.ctx.params);
    if (!video) {
      this.ctx.throw(404, 'Video Not Found');
    }

    // 视频作者必须是当前登入用户
    if (!video.user.equals(userId)) {
      this.ctx.throw(403); // 禁止访问"Forbidden"
    }

    // 合并对象数据
    Object.assign(video, this.ctx.helper._.pick(body, [
      'title',
      'description',
      'vodVideoId',
      'cover',
    ]));
    // console.log(video);
    // 把修改保存到数据库中
    await video.save();

    // 发送响应
    this.ctx.body = {
      video,
    };
  }
```

