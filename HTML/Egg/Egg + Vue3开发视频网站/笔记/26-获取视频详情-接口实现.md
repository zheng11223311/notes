## 获取视频详情-接口实现

#### 路由新增

```js
 // 获取视频详情-接口实现
  router.get('/videos/:videoId', app.middleware.auth({ required: false }), controller.video.getVideo);
```



#### 控制器新增

```js
  async getVideo() {
    const { Video, Like, Subscription } = this.app.model;
    const { videoId } = this.ctx.params; // 路由 :videoId 传递的值
    let video = await Video.find({
      title: videoId,
    }).populate('user', '_id username avatar subscribersCount'); // 关联 user 字段,查找user 字段所关联的表的_id username 等字段
    if (!video) {
      this.ctx.throw(404, 'Video Not Found');
    }
    // console.log(this.app.model);
    // console.log(Video);
    // console.log(Like);
    // console.log(Subscription);
    video = video[0].toJSON();
    video.isLiked = false; // 是否喜欢
    video.isDisLiked = false; // 是否不喜欢
    video.user.isSubscribed = false; // 是否已订阅视频作者

    // this.ctx.user = {};
    // this.ctx.user._id = '62d9097b03166e1c1cdea254';
    // console.log(this.ctx.user, 1111111);
    if (this.ctx.user) {
      const userId = this.ctx.user._id;
      // const userId = '62d9097b03166e1c1cdea254';
      if (await Like.findOne({ user: userId, video: videoId, like: 1 })) {
        video.isLiked = true;
      }
      if (await Like.findOne({ user: userId, video: videoId, like: -1 })) {
        video.isDisLiked = true;
      }
      if (await Subscription.findOne({ user: userId, channel: video.user._id })) {
        video.user.isSubscribed = true;
      }
    }
    this.ctx.body = {
      video,
    };
  }
```

