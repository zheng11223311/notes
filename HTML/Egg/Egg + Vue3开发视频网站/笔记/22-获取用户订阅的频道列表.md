## 获取用户订阅的频道列表

#### 路由新增

```js
 // 获取用户订阅的频道列表
router.get('/user/:userId/subscriptions', auth, controller.user.getSubscriptions); // 路径 要经过的中间件 控制器 http://127.0.0.1:7001/api/v1/user/62d9097b03166e1c1cdea254/subscriptions
```



#### 控制器新增

```js
async getSubscriptions() {
    const { Subscription } = this.app.model;
    // console.log(this.ctx.params.userId);
    //   await Subscription.find 模型查找是异步的,不使用await 只会返回query 对象,而不是数据
    let subscription = await Subscription.find({
      user: this.ctx.params.userId,
    }, (e, doc) => {
      // console.log(doc);
    }).populate('channel'); // populate('channel') 关联查询User 表的channel 字段,populate 居住于; 生活于; 移民于; 占据;

    // subscription.exec((err, docs) => {
    //   if (err) {
    //     console.log('err: ' + err);
    //     return;
    //   }
    //   console.log(JSON.stringify(docs));
    // });
    subscription = subscription.map(item => {
      return this.ctx.helper._.pick(item.channel, [  // 选择使用对象中指定的字段
        '_id',
        'username',
        'avatar',
      ]);
    // return {
    //   _id: item.channel._id,
    //   username: item.channel.username,
    //   avatar: item.channel.avatar,
    // };
    });
    this.ctx.body = {
      subscription,
    };
    console.log(subscription);
  }
```

