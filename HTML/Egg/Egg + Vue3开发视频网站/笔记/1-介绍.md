## 1-介绍

官网 :  [快速入门 - Egg (eggjs.org)](https://www.eggjs.org/zh-CN/intro/quickstart) 



# 快速入门

本文将从实例的角度，一步步地搭建出一个 Egg.js 应用，让你能快速的入门 Egg.js。



## 环境准备

- 操作系统：支持 macOS，Linux，Windows
- 运行环境：建议选择 [LTS 版本](http://nodejs.org/)，最低要求 8.x。



## 快速初始化

我们推荐直接使用脚手架，只需几条简单指令，即可快速生成项目（`npm >=6.1.0`）:

```bash
mkdir egg-example && cd egg-example
npm init egg --type=simple
npm i
```

启动项目:

```bash
npm run dev
open http://localhost:7001
```





## 逐步搭建

通常你可以通过上一节的方式，使用 `npm init egg` 快速选择适合对应业务模型的脚手架，快速启动 Egg.js 项目的开发。

但为了让大家更好的了解 Egg.js，接下来，我们将跳过脚手架，手动一步步的搭建出一个 [Hacker News](https://github.com/eggjs/examples/tree/master/hackernews)。

**注意：实际项目中，我们推荐使用上一节的脚手架直接初始化。**

![Egg HackerNews Snapshoot](https://cloud.githubusercontent.com/assets/227713/22960991/812999bc-f37d-11e6-8bd5-a96ca37d0ff2.png)



### 初始化项目

先来初始化下目录结构：

```bash
mkdir egg-example   #创建文件夹
cd egg-example
npm init -y
npm i egg --save
npm i egg-bin --save-dev  #egg 的工具
```

添加 `npm scripts` 到 `package.json`：

```json
{  
    "name": "egg-example", 
    "scripts":
    {   
        "dev": "egg-bin dev" 
    }
}
```

默认监听 7001 端口



### 编写 Controller

如果你熟悉 Web 开发或 MVC，肯定猜到我们第一步需要编写的是 [Controller](https://www.eggjs.org/zh-CN/basics/controller) 和 [Router](https://www.eggjs.org/zh-CN/basics/router)。

```js
// app/controller/home.js  文件夹自己创建
const Controller = require('egg').Controller;  //控制器

class HomeController extends Controller {
  async index() {
      //设置响应体数据
    this.ctx.body = 'Hello world';
  }
}

module.exports = HomeController;
```

配置路由映射：

```js
// app/router.js  路由配置模块
module.exports = (app) => { //app 是Egg.js 应用实例,就像koa 的app 一样
  const { router, controller } = app;
    //配置路由规则
  router.get('/', controller.home.index); //get 请求http://localhost:7001/  ,返回controller 下home.js 中index 返回的数据
};
```

加一个[配置文件](https://www.eggjs.org/zh-CN/basics/config)：

```js
// config/config.default.js
exports.keys = <此处改为你自己的 Cookie 安全字符串>;
//exports.keys = 'asdasda';  // Cookie 安全字符串,使用唯一的uuid 等,确保安全,必须配置,否则可能应用启动不了.必须是字符串
```

此时目录结构如下：

```bash
egg-example
├── app
│   ├── controller
│   │   └── home.js
│   └── router.js
├── config
│   └── config.default.js
└── package.json
```

完整的目录结构规范参见[目录结构](https://www.eggjs.org/zh-CN/basics/structure)。

好，现在可以启动应用来体验下

```bash
npm run dev			#启动应用默认会创建出public 文件夹
open http://localhost:7001   #dos 命令,在浏览器打开
```

> 注意：
>
> - Controller 有 `class` 和 `exports` 两种编写方式，本文示范的是前者，你可能需要参考 [Controller](https://www.eggjs.org/zh-CN/basics/controller) 文档。
> - Config 也有 `module.exports` 和 `exports` 的写法，具体参考 [Node.js modules 文档](https://nodejs.org/api/modules.html#modules_exports_shortcut)。

### 

### 静态资源

Egg 内置了 [static](https://github.com/eggjs/egg-static) 插件，线上环境建议部署到 CDN，无需该插件。

static 插件默认映射 `/public/* -> app/public/*` 目录

此处，我们把静态资源都放到 `app/public` 目录即可：

```bash
app/public
├── css
│   └── news.css
└── js
    ├── lib.js
    └── news.js
```

```css
/* 

 //public/css/main.css

 通过访问 http://localhost:7001/public/css/main.css 获取到此内容
  */
  body{
    background-color: #fff;
  }
```



### 模板渲染

绝大多数情况，我们都需要读取数据后渲染模板，然后呈现给用户。故我们需要引入对应的模板引擎。

框架并不强制你使用某种模板引擎，只是约定了 [View 插件开发规范](https://www.eggjs.org/zh-CN/advanced/view-plugin)，开发者可以引入不同的插件来实现差异化定制。

更多用法参见 [View](https://www.eggjs.org/zh-CN/core/view)。

在本例中，我们使用 [Nunjucks](https://mozilla.github.io/nunjucks/) 来渲染，先安装对应的插件 [egg-view-nunjucks](https://github.com/eggjs/egg-view-nunjucks) ：

```bash
npm i egg-view-nunjucks --save
```

开启插件：

```js
// config/plugin.js

//配置插件
exports.nunjucks = {
  enable: true,		//启用插件
  package: 'egg-view-nunjucks', //使用的npm 包
};
```

```js
// config/config.default.js
exports.keys = <此处改为你自己的 Cookie 安全字符串>;
// 添加 view 配置
exports.view = {
  defaultViewEngine: 'nunjucks',	//默认的视图引擎
  mapping: {
    '.tpl': 'nunjucks',  //当以.tpl 结尾的模板文件,使用nunjucks 模板引擎解析
  },
};
```

**注意：是 `config` 目录，不是 `app/config`!**

为列表页编写模板文件，一般放置在 `app/view` 目录下

```html
<!-- app/view/news/list.tpl -->
<html>
  <head>
    <title>Hacker News</title>
    <link rel="stylesheet" href="/public/css/news.css" />
  </head>
  <body>
    <ul class="news-view view">
      {% for item in list %}
      <li class="item">
        <a href="{{ item.url }}">{{ item.title }}</a>
      </li>
      {% endfor %}
    </ul>
  </body>
</html>
```

添加 Controller 和 Router

```js
// app/controller/news.js
const Controller = require('egg').Controller;

class NewsController extends Controller {
  async list() {
    const dataList = {
      list: [
        { id: 1, title: 'this is news 1', url: '/news/1' },
        { id: 2, title: 'this is news 2', url: '/news/2' },
      ],
    };
    await this.ctx.render('news/list.tpl', dataList);  //渲染模板,将数据提供给模板,渲染是异步的,需要await  访问http://localhost:7001/news
  }
}

module.exports = NewsController;

```

```js
// app/router.js
module.exports = (app) => {
  const { router, controller } = app;
  router.get('/', controller.home.index);
  router.get('/news', controller.news.list);
};
```

启动浏览器，访问 http://localhost:7001/news 即可看到渲染后的页面。

**提示：开发期默认开启了 [development](https://github.com/eggjs/egg-development) 插件，修改后端代码后，会自动重启 Worker 进程。**

