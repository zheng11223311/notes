## 获取用户喜欢的视频列表-接口实现

#### 路由新增

```js
  // 获取用户喜欢的视频列表-接口实现
  router.get('/user/videos/like', auth, controller.video.getUserLikedVideos);
```



#### video.js 控制器新增

```js
  async getUserLikedVideos() {
    const { Like, Video } = this.app.model;
    let { pageNum = 1, pageSize = 10 } = this.ctx.query;
    const userId = this.ctx.user._id;
    pageNum = Number.parseInt(pageNum);
    pageSize = Number.parseInt(pageSize);

    const filterDoc = {
      user: userId,
      like: 1,
    };

    const like = await Like.find(filterDoc).sort({ createAt: -1 })
      .skip((pageNum - 1) * pageSize)
      .limit(pageSize);

    // console.log(like);
    const getVideos = Video.find({
      _id: {
        $in: like.map(item => item.video),
      },
    }).populate('user');
    const getVideosCount = Like.countDocuments(filterDoc);
    const [ videos, videosCount ] = await Promise.all([
      getVideos,
      getVideosCount,
    ]);
    this.ctx.body = {
      videos,
      videosCount,
    };
  }
```





