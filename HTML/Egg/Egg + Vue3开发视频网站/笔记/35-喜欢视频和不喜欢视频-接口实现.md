## 喜欢视频和不喜欢视频-接口实现

#### 路由新增

```js
  // 喜欢视频-接口实现
  router.post('/videos/:videoId/like', auth, controller.video.likeVideo);
  // 不喜欢视频-接口实现
  router.post('/videos/:videoId/dislike', auth, controller.video.dislikeVideo);
```



#### video.js 新增

```js
  async likeVideo() {
    const { Video, Like } = this.app.model;
    const { videoId } = this.ctx.params;
    const userId = this.ctx.user._id;
    const video = await Video.findById(videoId);

    if (!video) {
      this.ctx.throw(404, 'Video Not Found');
    }

    const doc = await Like.findOne({
      user: userId,
      video: videoId,
    });

    let isLiked = true;

    if (doc && doc.like === 1) {
      await doc.remove(); // 取消点赞
      isLiked = false;
    } else if (doc && doc.like === -1) {
      doc.like = 1;
    } else {
      await new Like({
        user: userId,
        video: videoId,
        like: 1,
      }).save();
    }

    // 更新喜欢视频的数量
    video.likesCount = await Like.countDocuments({
      video: videoId,
      like: 1,
    });

    // 更新不喜欢视频的数量
    video.likesCount = await Like.countDocuments({
      video: videoId,
      like: -1,
    });

    // 将修改保存到数据库中
    await video.save();

    this.ctx.body = {
      video: {
        ...video.toJSON(),
        isLiked,
      },
    };
  }
  async dislikeVideo() {
    const { Video, Like } = this.app.model;
    const { videoId } = this.ctx.params;
    const userId = this.ctx.user._id;
    const video = await Video.findById(videoId);

    if (!video) {
      this.ctx.throw(404, `Not Video Found For ID - ${videoId}`);
    }

    const doc = await Like.findOne({
      user: userId,
      video: videoId,
    });

    let isdisLiked = true;

    if (doc && doc.like === -1) {
      await doc.remove(); // 取消点赞
      isdisLiked = false;
    } else if (doc && doc.like === 1) {
      doc.like = -1;
      await doc.save();
    } else {
      await new Like({
        user: userId,
        video: videoId,
        like: -1,
      }).save();
    }

    // 更新喜欢视频的数量
    video.likesCount = await Like.countDocuments({
      video: videoId,
      like: 1,
    });

    // 更新不喜欢视频的数量
    video.likesCount = await Like.countDocuments({
      video: videoId,
      like: -1,
    });

    // 将修改保存到数据库中
    await video.save();

    this.ctx.body = {
      video: {
        ...video.toJSON(),
        isdisLiked,
      },
    };
  }
```

