### 1.创建项目

**项目接口地址**

[注册--ShowDoc](https://www.showdoc.com.cn/1207745568269674/6090123481636428)

**卸载vue2 脚手架**

```bash
npm uninstall -g vue-cli
```

**全局安装vue3 脚手架**

```bash
npm install -g @vue/cli
如果不成功,使用强制安装,或者卸载脚手架2.从新安装
npm install -g @vue/cli --force   //强制安装
```

**创建ewshop 项目**

```bash
vue create electron-music		//vue3 执行命令
```

**提示**

```
Your connection to the default npm registry seems to be slow.
Use https://registry.npm.taobao.org for faster installation?
   你连接默认的npm 似乎比较慢,是否使用淘宝镜像的npm,加快安装? --> ×
   
Vue CLI v4.5.15
? Please pick a preset:	请选择操作
  Default ([Vue 2] babel, eslint)	使用vue2 和 解析运行ES6代码 和语法检查
  Default (Vue 3) ([Vue 3] babel, eslint)	使用vue3 和 解析运行ES6代码 和语法检查
> Manually select features	手动配置√

? Check the features needed for your project: (Press <space> to select, <a> to toggle all, <i> to invert selection)
选择你需要的配置(按空格 选择/取消单个,按 a 全选/反选 按 i 全选/反选)
>(*) Choose Vue version		选择vue 版本√
 (*) Babel		解析运行ES6代码 √
 ( ) TypeScript	 TP脚本×
 ( ) Progressive Web App (PWA) Support	支持移动端×
 (*) Router		路由√
 (*) Vuex		vuex 共享仓库 √
 (*) CSS Pre-processors  css 预处理√
 ( ) Linter / Formatter		语法限制(严格控制语法) ×
 ( ) Unit Testing	单元测试×
 ( ) E2E Testing    End to End 黑盒测试×
 
 ? Choose a version of Vue.js that you want to start the project with
 选择一个你想要的vue 版本开始制作你的项目
  2.x
> 3.x	vue3 版本√

? Use history mode for router? (Requires proper server setup for index fallback in production) (Y/n)
对路由使用历史模式?  √

? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): (Use arrow keys)
选择一个css 预处理器
> Sass/SCSS (with dart-sass)	√
  Sass/SCSS (with node-sass)
  Less
  Stylus

? Where do you prefer placing config for Babel, ESLint, etc.? (Use arrow keys)
你在哪喜欢放置配置
> In dedicated config files	在专用配置文件中
  In package.json		记录到package.json 文件 √

Save this as a preset for future projects? (y/N)
保存这个项目的配置便于下次直接使用这个配置?  √

Save preset as:ewshop  保存项目配置名为:ewshop	

一切ok,开始运行项目
```

```bash
cd book   切换到项目文件
npm run serve 运行项目
```

在根目录下(book) 下新建一个vue.config.js 配置文件

```js
//修改配置文件后必须重启项目
module.exports={
    configureWebpack:{
        //打包的配置文件
        resolve:{
            //起别名
            alias:{
                'assets':'@/assets',
                'components':'@/components',
                'network':'@/network',  //网络
                'utils':'@/utils',  //第三方工具
                'views':'@/views',
            }
        }
    },
}
```

别名只有在script 中有效,其他需要在路径前面加~ 启用别名

## 添加electron插件

创建完项目后，进入项目然后再插件管理中选择添加插件
查询：electron-builder，安装一下就好了
当然如果你是命令行操作的，直接`vue add electron-builder`安装就行了

```bash
vue add electron-builder
```

**安装axios**

```bash
npm i axios -S    -S运行时依赖
```

**安装ant ui 库**

```bash
npm install ant-design-vue --save
```

**main.js 文件**

```js
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import store from './store'

import { Button } from 'ant-design-vue';

import 'ant-design-vue/dist/antd.css'; // or 'ant-design-vue/dist/antd.less'

const app=createApp(App)

/* 挂载全局对象 start */
app.config.globalProperties.$http = Axios
app.config.globalProperties.$utils = Utils
/* 挂载全局对象 end */


app.use(Button)
app.use(store).use(router).mount('#app')
```

- 在`vue3`的`setup`中使用`getCurrentInstance`API获取全局对象：

```vue
<template>
  <div class="box"></div>
</template>
<script>
  import { ref, reactive, getCurrentInstance } from 'vue'
  export default {
    setup(props, cxt) {
      // 方法一 start
      const currentInstance = getCurrentInstance()
      const { $http, $message, $route } = currentInstance.appContext.config.globalProperties
      
      function getList() {
        $http({
          url: '/api/v1/posts/list'
        }).then(res=>{
          let { data } = res.data
          console.log(data)
        })
      }
      // 方法一 end

      // 方法二 start
      const { proxy } = getCurrentInstance()
      
      function getData() {
        proxy.$http({
          url: '/api/v1/posts/list'
        }).then(res=>{
          let { data } = res.data
          console.log(data)
        })
      }
      // 方法二 end

    }  
  }
</script>
```

> 1. 方法一：通过`getCurrentInstance`方法获取当前实例，再根据当前实例找到全局实例对象`appContext`，进而拿到全局实例的`config.globalProperties`。
> 2. 方法二：通过`getCurrentInstance`方法获取上下文，这里的`proxy`就相当于`this`。
>
> **提示：** 可以通过打印`getCurrentInstance()`看到其中有很多全局对象，如：`$route`、`$router`、`$store`。如果全局使用了`ElementUI`后，还可以拿到`$message`、`$dialog`等等。



作者：天問
链接：https://www.jianshu.com/p/f8b14062337a

# 取消electron默认菜单栏

**先引入Menu模块**

```js
import {
  app,
  protocol,
  BrowserWindow,
  globalShortcut,
  Menu
} from 'electron'


Menu.setApplicationMenu(null) //取消菜单栏
```



### Electron 文件: /src/background.js ,electron 的主文件

**修改图标**

```js
async function createWindow() {
  //创建浏览器窗口
  const win = new BrowserWindow({
    // 设置窗口图标
    icon: `${__static}/favicon.ico`,    //指向public/

    width: 800,		//窗体宽度
    height: 600,
    webPreferences: {
      
      // 使用pluginOptions.nodeIntegration，不要管这个了
      // 更多信息请参见 nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration
      nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,
      contextIsolation: !process.env.ELECTRON_NODE_INTEGRATION,
      webSecurity:false,    //解决跨域问题
        devTools: false,	//禁止使用调试工具,在应用界面无法调用调试工具
    }
  })
    if (process.env.WEBPACK_DEV_SERVER_URL) {
    // 如果处于开发模式，请加载开发服务器的url
    await win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)
    // if (!process.env.IS_TEST) win.webContents.openDevTools()  //打开应用时同时打开调试工具
  } else {
    createProtocol('app')
    // 在未开发时加载index.html
    win.loadURL('app://./index.html')
  }
}
```

**运行时报 Vue Devtools failed to install: **

```js
app.on('ready', async () => {		//将一下内容注释掉
  // if (isDevelopment && !process.env.IS_TEST) {
  //   // Install Vue Devtools
  //   try {
  //     await installExtension(VUEJS3_DEVTOOLS)
  //   } catch (e) {
  //     console.error('Vue Devtools failed to install:', e.toString())
  //   }
  // }
  createWindow()
})
```

**打包时不能打开项目中的文件,否则报错**

**打包的文件路由不能使用history 模式**

> Electron 只在 路由模式 为 hash 时，才可以正常运行。否则，就会无法找到匹配的路径，故而选择 path: * 对应的路由；
>
> 如果你的 router 文件中，设置了 path: * ，那么 首页，就是path: * 对应的界面，比如刚才的首页弹出 404 ；而如果没有设置 path: * ，那么，就不出现首页blank！
> ————————————————
> 版权声明：本文为CSDN博主「RaySunWHUT」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
> 原文链接：https://blog.csdn.net/qq_40994260/article/details/107440478
>
> ```js
> import {
>   createRouter,
>   createWebHistory,
>   createWebHashHistory
> } from 'vue-router'
> 
> const router = createRouter({
>     //vue3.x router4.x 路由hash与History的设置
>   history: createWebHashHistory(process.env.BASE_URL),
>   // history: createWebHistory(process.env.BASE_URL),
>   routes
> })
> ```
>
> 

**打包时路径不能有中文**

Electron-Builder打包时报错could not find: “C:\Users\XX\AppData\Local\Temp\t-bDWVX6\0-messages.nsh”
项目情况
项目基于VUE，使用VUE-cli 3创建，然后执行

```bash
vue add electron-builder
```

添加Electron-Builder

问题描述
在执行

```bash
npm run electron:build
```

的时候，会打包失败，错误日志如下（敏感信息已打码），



    { Error: C:\Users\{我的windows账户名}\AppData\Local\electron-builder\Cache\nsis\nsis-3.0.4.1\Bin\makensis.exe exited with code ERR_ELECTRON_BUILDER_CANNOT_EXECUTE
    Output:
    
    Output:
    Command line defined: "APP_ID=com.electron.{我的项目名称}"
    Command line defined: "APP_GUID=c587bd21-8cd2-5b34-93a3-ad3ca404cd06"
    Command line defined: "UNINSTALL_APP_KEY=c587bd21-8cd2-5b34-93a3-ad3ca404cd06"
    Command line defined: "PRODUCT_NAME={我的项目名称}"
    Command line defined: "PRODUCT_FILENAME={我的项目名称}"
    Command line defined: "APP_FILENAME={我的项目名称}"
    Command line defined: "APP_DESCRIPTION="
    Command line defined: "VERSION=0.1.0"
    Command line defined: "PROJECT_DIR=D:\Test\{我的项目名称}"
    Command line defined: "BUILD_RESOURCES_DIR=D:\Test\{我的项目名称}\build"
    Command line defined: "APP_PACKAGE_NAME={我的项目名称}"
    Command line defined: "APP_64=D:\Test\{我的项目名称}\dist_electron\{我的项目名称}-0.1.0-x64.nsis.7z"
    Command line defined: "APP_64_NAME={我的项目名称}-0.1.0-x64.nsis.7z"
    Command line defined: "APP_64_HASH=8EE6D7EDADFDD46851BD6424FB67BD9E98CD6B405D6B319E3DD582FF7DED068210BD65C46FD93EB98D0DBD012D447DA4E0AD599DFC6A2BD62993EACC16BD3F64"
    Command line defined: "APP_INSTALLER_STORE_FILE={我的项目名称}-updater\installer.exe"
    Command line defined: "COMPRESSION_METHOD=7z"
    Command line defined: "ONE_CLICK"
    Command line defined: "RUN_AFTER_FINISH"
    Command line defined: "SHORTCUT_NAME={我的项目名称}"
    Command line defined: "UNINSTALL_DISPLAY_NAME={我的项目名称} 0.1.0"
    Command line defined: "ESTIMATED_SIZE=159797"
    Command line defined: "COMPRESS=auto"
    Command line defined: "BUILD_UNINSTALLER"
    Command line defined: "UNINSTALLER_OUT_FILE=D:\Test\{我的项目名称}\dist_electron\__uninstaller-nsis-{我的项目名称}.exe"
    Processing config: C:\Users\��\AppData\Local\electron-builder\Cache\nsis\nsis-3.0.4.1\nsisconf.nsh
    Processing script file: "<stdin>" (ACP)
    
    Error output:
    
    Error output:
    !include: could not find: "C:\Users\{我的windows账户名}\AppData\Local\Temp\t-bDWVX6\0-messages.nsh"
    Error in script "<stdin>" on line 75 -- aborting creation process
    at ChildProcess.childProcess.once.code (D:\Test\{我的项目名称}\node_modules\builder-util\src\util.ts:243:14)
    at Object.onceWrapper (events.js:273:13)
    at ChildProcess.emit (events.js:182:13)
    at maybeClose (internal/child_process.js:978:16)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:265:5)
      exitCode: 1,
      alreadyLogged: false,
      code: 'ERR_ELECTRON_BUILDER_CANNOT_EXECUTE' }
    npm ERR! code ELIFECYCLE
    npm ERR! errno 1
    npm ERR! {我的项目名称}@0.1.0 electron:build: `vue-cli-service electron:build`
    npm ERR! Exit status 1
    npm ERR!
    npm ERR! Failed at the {我的项目名称}@0.1.0 electron:build script.
    npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
    
    npm ERR! A complete log of this run can be found in:
    npm ERR!     C:\Users\{我的windows账户名}\AppData\Roaming\npm-cache\_logs\2020-12-16T05_39_35_234Z-debug.log


从错误日志上来看，产生此错误的原因是，nsis插件找不到了。但是我打开对应目录，很明显，nsis是存在的。然后我发现一个关键点，那就是路径中出现了乱码

```bash
Processing config: C:\Users\��\AppData\Local\electron-builder\Cache\nsis\nsis-3.0.4.1\nsisconf.nsh
```

显然，是因为我的windows账户名是中文，但是在打包过程中，有某些插件不能正确识别中文导致的。
问题的根源已经找到了。怎么办呢。别人出现这个问题，都是项目名称或者路径里出现了中文，改掉就是了，我这个是AppData文件夹路径出现中文，怎么改？

处理办法我想到了以下几个

改windows用户名，改成英文，此办法一劳永逸。一次修改终身受益。后来发现，工程量有点大，并不是简单的改名字就能解决的，还要去修改对应的很多注册表的键值，风险有点高。我没敢尝试。
修改环境变量的，使AppData文件夹路径中不存在中文即可。后来发现，工程量也不小，而且修改环境变量的风险也不小，可能会导致其他的一下项目出现问题。也没敢尝试。
剩下的办法，那就只能是让插件支持中文了。问题是怎么改才能让它支持中文。
经过一系列的baidu，google，bing。终于，在一篇博文中发现了解决方案。

打开 node_module/app-builder-lib/out/targets/nsis/NsisTarget.js文件，在 executeMakensis 方法中加入我们所需的参数。



```js
//node_module/app-builder-lib/out/targets/nsis/NsisTarget.js
async executeMakensis(defines, commands, script) {
    const args = this.options.warningsAsErrors === false ? [] : ["-WX"];
    //此处新增
    args.push("-INPUTCHARSET", "UTF8");
    //结束
    for (const name of Object.keys(defines)) {
      const value = defines[name];  
  if (value == null) {
    args.push(`-D${name}`);
  } else {
    args.push(`-D${name}=${value}`);
  }
}
```
经测试，问题完美解决

附原博文地址：https://www.azimiao.com/6250.html
————————————————
版权声明：本文为CSDN博主「Teastears」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/kyq0417/article/details/111266776

**打包后出现项目下出现dist_electron/**

> 其下的 xxx Setup 0.1.0.exe 为安装包,
>
> ./win-unpacked/ 下的为直接运行的包
>
> ./bundled/ 下的为html 形式的项目

### 2.项目上线

**运行项目**
在项目根目录下，打开cmd或者vscode编辑器
若项目调试运行下述代码：

```bash
vue-cli-service electron:serve
或
npm run electron:serve		//package.json有相关配置
```

若项目打包成exe运行下述代码：

```bash
npm run electron:build
```

然后这里可能会报错，会说你的electron安装不正确，请删除node_modules文件夹下的electron，这时候直接去删了，然后用cnpm安装electron就能解决

```bash
cnpm install electron --save-dev
```

**注意事项**
如果出现了报错，但是乱码的话，这个是因为你的cmd没有设置utf-8，在根目录下打开package.json，找到然后electron:build和electron:serve修改为下述代码：

```json
"electron:build": "chcp 65001 && vue-cli-service electron:build",
"electron:serve": "chcp 65001 && vue-cli-service electron:serve",
```
65001就是utf-8的编号，到此继续运行就能启动啦！

```bash
vue-cli-service electron:serve
```

**五、使用Node.js**
在项目跟目录创建一个vue.config.js文件，写入代码：

```js
module.exports = {
  pluginOptions: {
    electronBuilder: {
      nodeIntegration: true,
         contextIsolation: false, //同上一起配置,窗口的环境隔离
         webSecurity:false,    //解决跨域问题
    }
  }
}
```

也可以在background.js 中配置(即 electron 的文件)

```js
async function createWindow() {
  //创建浏览器窗口
  const win = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      
      // 使用pluginOptions.nodeIntegration，不要管这个了
      // 更多信息请参见 nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration
      nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,
      contextIsolation: !process.env.ELECTRON_NODE_INTEGRATION,
      webSecurity:false,    //解决跨域问题
    }
  })

  if (process.env.WEBPACK_DEV_SERVER_URL) {
    // 如果处于开发模式，请加载开发服务器的url
    await win.loadURL(process.env.WEBPACK_DEV_SERVER_URL)
    if (!process.env.IS_TEST) win.webContents.openDevTools()
  } else {
    createProtocol('app')
    // 在未开发时加载index.html
    win.loadURL('app://./index.html')
  }
}
```

然后在对应的Vuex文件中导入fs文件模块，使用即可，非常方便！

```js
import fs from 'fs'
```

————————————————
版权声明：本文为CSDN博主「孤城氵客栈」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/qq_41003479/article/details/123806597

