### 1.模块联邦(Module Federation)

**1.应用案例**

本案例模拟三个应用:`Nav`,`Home`及`Search`,每个应用都是独立的,用通过模块联邦联系到了一起

每个应用都有自己的dist,node_modules 等文件

```
npx webpack serve --port 3030		//开启3030端口的服务器
```

nav 应用的`webpack.config.js` 应用开启的端口为3001

```js
const HtmlWebpackPlugin=require('html-webpack-plugin')
const {ModuleFederationPlugin}=require('webpack').container

module.exports={
    mode:'production',
    entry:'./src/index.js',
	plugins:[
        new HtmlWebpackPlugin(),
        new ModuleFederationPlugin({
            name:'nav',		//模块联邦的名字,其他应用通过这个名字来访问
            filename:"reomteEntry.js",	//其他模块对此的访问路径
            remotes:{		//引用其他应用暴露的组件

            },
            exposes:{		//暴露组件给其他应用使用
               './Header':'./src/Header.js'	//'./Header' 其他应用访问的地址,'./src/Header.js' 指向的本地地址
           },
           shared:{	//共享的模块,比如lodash
                    
           }
        })
    ]   
}
```

Home 应用的`webpack.config.js`

```js
const HtmlWebpackPlugin=require('html-webpack-plugin')
const {ModuleFederationPlugin}=require('webpack').container

module.exports={
    mode:'production',
    entry:'./src/index.js',
	plugins:[
        new HtmlWebpackPlugin(),
        new ModuleFederationPlugin({
            name:'home',		//模块联邦的名字,其他应用通过这个名字来访问
            filename:"reomteEntry.js",	//访问路径
            remotes:{		//引用其他应用暴露的组件
              nav:'nav@http://localhost:3003/reomteEntry.js'			//nav 本地模块的前缀,'nav' 是nav 应用的webpack 配置的name 值,后面接地址
            },
            exposes:{		//暴露组件给其他应用使用
               './home':'./src/Home.js'
            },
            shared:{	//共享的模块,比如lodash
                    
            }
        })
    ]   
}
```

Home 应用的`index.js`

```js
import('nav/Header').then((Header)=>{		//nav 为Home 应用的`webpack.config.js` 的remotes 中的键nav,Header 为Nav 应用的`webpack.config.js` 的exposes 的键'./Header'
    document.body.append(Header.default())	//因为Header 组件使用export default 暴露出去,才使用default
})	


//也可以多个同时引入
Promise.all([import('nav/Header'),import('home/Home')]).then(([
    {
        default:Header			//解构出default,赋值给Header
    },
    {
        default:Home
    }
])=>{
    document.body.append(Header())
    document.body.append(Home())
})
```

使用时,需要将所有的应用都开启服务

Search 应用的`webpack.config.js`

```js
const HtmlWebpackPlugin=require('html-webpack-plugin')
const {ModuleFederationPlugin}=require('webpack').container

module.exports={
    mode:'production',
    entry:'./src/index.js',
	plugins:[
        new HtmlWebpackPlugin(),
        new ModuleFederationPlugin({
            name:'search',		//模块联邦的名字,其他应用通过这个名字来访问
            filename:"reomteEntry.js",	//访问路径
            remotes:{		//引用其他应用暴露的组件
              nav:'nav@http://localhost:3003/reomteEntry.js',			//nav 本地模块的前缀,'nav' 是nav 应用的webpack 配置的name 值,后面接地址
              home:'home@http://localhost:3001/reomteEntry.js',
            },
            exposes:{		//暴露组件给其他应用使用
               
            },
            shared:{	//共享的模块,比如lodash
                    
            }
        })
    ]   
}
```

