### 1.source-map

****

作为一个开发工程师--无论时什么开发,要求开发环境最不可少的一点功能就是--debug 功能,之前我们通过`webpack`,将我们额的源码打包成了`bundle.js`.试想:实际上客户端(浏览器)读取的是打包后的`bundle.js`,那么当浏览器执行代码报错的时候,报错的信息自然也是`bundle.js`的内容,我们如何将报错信息(bundle 错误的语句及其所在行列)映射到源码上?

是的,source-map

webpack 已经内置了sourcemap 的功能,我们只需要通过简单的配置,将可以开启它.

```js
module.exports={
    //开启source-map
    //开发中推荐使用source-map
    //生产环境一般不开启sourcemap
    devtool:'source-map'
}
```

当我们执行打包命令之后,我们发现bundle 的最后一行总是会多出一行注释,指向打包出的bundle.map.js(sourcemap 文件).sourcemap 文件用来描述 源码文件和bundle 文件的代码位置映射关系,基于它,我们将bundle 文件的错误信息映射到源码文件上

除开'source-map'外,还可以基于我们的需求设置其他值,webpack--devtool 一共提取了7种SourceMap 模式:

| 模式                    | 解释                                                         |
| ----------------------- | ------------------------------------------------------------ |
| eval                    | 每个module 会封装到eval 里包裹起来执行,并且会在末尾追加注释//@sourceURL,source-map 的默认值 |
| source-map              | 生成一个SourceMap 文件                                       |
| hidden-source-map       | 和source-map 一样,但不会在bundle 末尾追加注释                |
| inline-source-map       | 生成一个DataUrl 形式的SourceMap 文件                         |
| eval-source-map         | 每个module 会通过eval() 来执行,并且生成一个DataUrl 形式的SourceMap |
| cheap-source-map        | 生成一个没有列信息(column-mappings) 的SourceMaps 文件,不包含loader 的sourcemap (譬如babel 的sourcemap) |
| cheap-module-source-map | 生成一个没有列信息(column-mappings) 的SourceMaps 文件,同时loader 的ssourcemap 也会被简化为只包含对应的行 |

要注意的是,生产环境我们一般不会开启sourcemap 功能,主要有两点原因:

1. 通过bundle 和sourcemap 文件,可以反编译出源码----也就是说,线上产物有sourcemap 文件的话,就意味着有暴漏源码的风险
2. 我们可以观察到,sourcemap 文件的体积相对比较巨大,这跟我们生产环境的追求不同(生产环境追求更小更轻量的bundle)

```
一道思考题:有时候我们期望能第一时间通过线上的错误信息,来追踪到源码位置,从而快速解决掉bug 以减轻损失,但是又不希望sourcemap 文件暴漏在生产环境,有比较好的方案吗?
```

**安装插件**

```
npm install webpack webpack-cli webpack-dev-server html-webpack-plugin -D
```

**安装babel 的loader(ES6 语法转化为ES5 语法)**

```
npm install babel-loader @babel/core @babel/present-env -D
```

配置`webpack.config.js`

```js
const HtmlWebpackPlugin=require("html-webpack-plugin")

modlue.exports={
	mode:"development",
	entry:'./app.js',
    
    //devtool:false,  //关闭sourcemap
    //devtool:'eval',	//默认就是eval,错误提示时,指向源文件的行数,而不是打包后的文件行数
    //devtool:'source-map',	//除了eval 的功能外还生成main.js.map 文件,即输出文件output 的map 文件
   // devtool:'hidden-source-map', //没有 eval 的指向错误的源文件位置功能,但是生成main.js.map 文件,即输出文件output 的map 文件,输出的map 文件不会和源文件做关联了
     //devtool:'inline-source-map',//不会生成map 文件,有 eval 的指向错误的源文件位置功能
    //devtool:'eval-source-map',//不会生成map 文件,有 eval 的指向错误的源文件位置功能,把source 放在了打包后的eval 的注释后面
     //devtool:'cheap-source-map',//生成map 文件,有 eval 的指向错误的源文件位置功能,生成的main.js.map 文件内表明版本,文件名,mappings 记录行数,但是没有记录列数,而source-map 会记录列数,cheap-source-map 相对于source-map,打包产生的map 文件更小
     devtool:'cheap-module-source-map',//会将loader 的列数记录,生成map 文件,有 eval 的指向错误的源文件位置功能,map 记录行数,但是没有记录列数,开发环境推荐使用
    
	plugins:[
		new HtmlWebpackPlugin()
	],
    output:{
        clear:true,		//每次打包都清除之前的dist 目录
    }
    module:{
    	rules:[
    		{
    			test:/\.js$/,
    			exclude:/node_modules/,  //排除文件夹
    			use:{
    					loader:'babel-laoder',
    					options:{	//插件集
    								presets:['@babel/preset-env'] //预设配置
								}
					}
			}
    	]
	}
}
```

**打包**

```
npx webpack 
```

**打开热加载**

```
npx webpack serve
```

浏览器输入:localhost:8080

