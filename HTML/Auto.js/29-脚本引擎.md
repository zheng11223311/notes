### 1.脚本引擎(类似虚拟机,互不干扰)

地址:[脚本引擎 - Engines (autojs.org)](https://pro.autojs.org/docs/#/zh-cn/engines?id=engines)

# [Engines](https://pro.autojs.org/docs/#/zh-cn/engines?id=engines)

> Stability: 2 - Stable

engines模块包含了一些与脚本环境、脚本运行、脚本引擎有关的函数，包括运行其他脚本，关闭脚本等。

例如，获取脚本所在目录：

```
toast(engines.myEngine().cwd());
```

## [engines.execScript(name, script[, config\])](https://pro.autojs.org/docs/#/zh-cn/engines?id=enginesexecscriptname-script-config)

- `name` {string} 要运行的脚本名称。这个名称和文件名称无关，只是在任务管理中显示的名称。

- `script` {string} 要运行的脚本内容。

- ```
  config
  ```

   

  {Object} 运行配置项

  - `delay` {number} 延迟执行的毫秒数，默认为0
  - `loopTimes` {number} 循环运行次数，默认为1。0为无限循环。
  - `interval` {number} 循环运行时两次运行之间的时间间隔，默认为0
  - `path` {Array} | {string} 指定脚本运行的目录。这些路径会用于require时寻找模块文件。

在新的脚本环境中运行脚本script。返回一个[ScriptExecution](https://pro.autojs.org/docs/#/zh-cn/engines?id=engines_scriptexecution)对象。

所谓新的脚本环境，指定是，脚本中的变量和原脚本的变量是不共享的，并且，脚本会在新的线程中运行。

最简单的例子如下：

```
engines.execScript("hello world", "toast('hello world')");
```

如果要循环运行，则：

```
//每隔3秒运行一次脚本，循环10次
engines.execScript("hello world", "toast('hello world')", {
    loopTimes: 10,
    interval: 3000
});
```

用字符串来编写脚本非常不方便，可以结合 `Function.toString()`的方法来执行特定函数:

```
function helloWorld(){
    //注意，这里的变量和脚本主体的变量并不共享
    toast("hello world");
}
engines.execScript("hello world", "helloWorld();\n" + helloWorld.toString());
```

如果要传递变量，则可以把这些封装成一个函数：

```
function exec(action, args){
    args = args || {};
    engines.execScript(action.name, action.name + "(" + JSON.stringify(args) + ");\n" + action.toString());
}

//要执行的函数，是一个简单的加法
function add(args){
    toast(args.a + args.b);
}

//在新的脚本环境中执行 1 + 2
exec(add, {a: 1, b:2});
```

**示例:**

```js

// jsname 起一个脚本名称,在开发工具中看到
// 25-脚本引擎运行结束,开始jsname 脚本文件的执行,jsname 相当于一个脚本文件
// engines.execScript('jsname','toast("脚本内容,返回桌面");home()')

// engines.execScript('jsname','toast("脚本内容,返回桌面")',{
//     delay:0, //延迟
//     loopTimes:3,   //循环次数,0为无限
//     interval:2000,  //两次输出间隔时间

// })


function fun(){
    toast('调用函数')
}
// 脚本引擎互不干扰,所以jsname 不能调用外部的fun 函数
// 可以将函数转换为字符串,传递进去
engines.execScript('jsname','fun();'+fun.toString(),{
    delay:0, //延迟
    loopTimes:3,   //循环次数,0为无限
    interval:2000,  //两次输出间隔时间

})





toast('启动服务器')
```

