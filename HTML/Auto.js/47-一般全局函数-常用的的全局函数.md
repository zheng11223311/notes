### 1.一般全局函数-常用的的全局函数

地址:[一般全局函数 - Globals (autojs.org)](https://pro.autojs.org/docs/#/zh-cn/globals?id=全局变量与函数)

# [全局变量与函数](https://pro.autojs.org/docs/#/zh-cn/globals?id=全局变量与函数)

全局变量和函数在所有模块中均可使用。 但以下变量的作用域只在模块内，详见 [module](https://pro.autojs.org/docs/#/modules.html)：

- exports
- module
- require() 以下的对象是特定于 Auto.js 的。 有些内置对象是 JavaScript 语言本身的一部分，它们也是全局的。

一些模块中的函数为了使用方便也可以直接全局使用，这些函数在此不再赘述。例如timers模块的setInterval, setTimeout等函数。

## [sleep(n)](https://pro.autojs.org/docs/#/zh-cn/globals?id=sleepn)

- `n` {number} 毫秒数

暂停运行n**毫秒**的时间。1秒等于1000毫秒。

```
//暂停5秒
sleep(5000);
```

## [currentPackage()](https://pro.autojs.org/docs/#/zh-cn/globals?id=currentpackage)

- 返回 {string}

返回最近一次监测到的正在运行的应用的包名，一般可以认为就是当前正在运行的应用的包名。

此函数依赖于无障碍服务，如果服务未启动，则抛出异常并提示用户启动。

## [currentActivity()](https://pro.autojs.org/docs/#/zh-cn/globals?id=currentactivity)

- 返回 {string}

返回最近一次监测到的正在运行的Activity的名称，一般可以认为就是当前正在运行的Activity的名称。

此函数依赖于无障碍服务，如果服务未启动，则抛出异常并提示用户启动。

## [setClip(text)](https://pro.autojs.org/docs/#/zh-cn/globals?id=setcliptext)

- `text` {string} 文本

设置剪贴板内容。此剪贴板即系统剪贴板，在一般应用的输入框中"粘贴"既可使用。

```
setClip("剪贴板文本");
```

## [getClip()](https://pro.autojs.org/docs/#/zh-cn/globals?id=getclip)

- 返回 {string}

返回系统剪贴板的内容。

```
toast("剪贴板内容为:" + getClip());
```

## [toast(message)](https://pro.autojs.org/docs/#/zh-cn/globals?id=toastmessage)

- message {string} 要显示的信息

以气泡显示信息message几秒。(具体时间取决于安卓系统，一般都是2秒)

注意，信息的显示是"异步"执行的，并且，不会等待信息消失程序才继续执行。如果在循环中执行该命令，可能出现脚本停止运行后仍然有不断的气泡信息出现的情况。 例如:

```
for(var i = 0; i < 100; i++){
  toast(i);
}
```

运行这段程序以后，会很快执行完成，且不断弹出消息，在任务管理中关闭所有脚本也无法停止。 要保证气泡消息才继续执行可以用：

```
for(var i = 0; i < 100; i++){
  toast(i);
  sleep(2000);
}
```

或者修改toast函数：

```
var _toast_ = toast;
toast = function(message){
  _toast_(message);
  sleep(2000);
}
for(var i = 0; i < 100; i++){
  toast(i);
}
```

## [toastLog(message)](https://pro.autojs.org/docs/#/zh-cn/globals?id=toastlogmessage)

- message {string} 要显示的信息

相当于`toast(message);log(message)`。显示信息message并在控制台中输出。参见console.log。

## [waitForActivity(activity[, period = 200\])](https://pro.autojs.org/docs/#/zh-cn/globals?id=waitforactivityactivity-period-200)

- `activity` Activity名称
- `period` 轮询等待间隔（毫秒）

等待指定的Activity出现，period为检查Activity的间隔。

## [waitForPackage(package[, period = 200\])](https://pro.autojs.org/docs/#/zh-cn/globals?id=waitforpackagepackage-period-200)

- `package` 包名
- `period` 轮询等待间隔（毫秒）

等待指定的应用出现。例如`waitForPackage("com.tencent.mm")`为等待当前界面为微信。

## [exit()](https://pro.autojs.org/docs/#/zh-cn/globals?id=exit)

立即停止脚本运行。

立即停止是通过抛出`ScriptInterruptedException`来实现的，因此如果用`try...catch`把exit()函数的异常捕捉，则脚本不会立即停止，仍会运行几行后再停止。

## [random(min, max)](https://pro.autojs.org/docs/#/zh-cn/globals?id=randommin-max)

- `min` {number} 随机数产生的区间下界
- `max` {number} 随机数产生的区间上界
- 返回 {number}

返回一个在[min...max]之间的随机数。例如random(0, 2)可能产生0, 1, 2。

## [random()](https://pro.autojs.org/docs/#/zh-cn/globals?id=random)

- 返回 {number}

返回在[0, 1)的随机浮点数。

## [requiresApi(api)](https://pro.autojs.org/docs/#/zh-cn/globals?id=requiresapiapi)

- `api` Android版本号

表示此脚本需要Android API版本达到指定版本才能运行。例如`requiresApi(19)`表示脚本需要在Android 4.4以及以上运行。

调用该函数时会判断运行脚本的设备系统的版本号，如果没有达到要求则抛出异常。

可以参考以下Android API和版本的对照表:

平台版本： API级别

Android 7.0： 24

Android 6.0： 23

Android 5.1： 22

Android 5.0： 21

Android 4.4W： 20

Android 4.4： 19

Android 4.3： 18

## [requiresAutojsVersion(version)](https://pro.autojs.org/docs/#/zh-cn/globals?id=requiresautojsversionversion)

- `version` {string} | {number} Auto.js的版本或版本号

表示此脚本需要Auto.js版本达到指定版本才能运行。例如`requiresAutojsVersion("3.0.0 Beta")`表示脚本需要在Auto.js 3.0.0 Beta以及以上运行。

调用该函数时会判断运行脚本的Auto.js的版本号，如果没有达到要求则抛出异常。

version参数可以是整数表示版本号，例如`requiresAutojsVersion(250)`；也可以是字符串格式表示的版本，例如"3.0.0 Beta", "3.1.0 Alpha4", "3.2.0"等。

可以通过`app.autojs.versionCode`和`app.autojs.versionName`获取当前的Auto.js版本号和版本。

## [runtime.requestPermissions(permissions)](https://pro.autojs.org/docs/#/zh-cn/globals?id=runtimerequestpermissionspermissions)

- `permissions` {Array} 权限的字符串数组

动态申请安卓的权限。例如：

```
//请求GPS权限
runtime.requestPermissions(["access_fine_location"]);
```

尽管安卓有很多权限，但必须写入Manifest才能动态申请，为了防止权限的滥用，目前Auto.js只能额外申请两个权限：

- `access_fine_location` GPS权限
- `record_audio` 录音权限

您可以通过APK编辑器来增加Auto.js以及Auto.js打包的应用的权限。

安卓所有的权限列表参见[Permissions Overview](https://developer.android.com/guide/topics/permissions/overview)。（并没有用）

## [runtime.loadJar(path)](https://pro.autojs.org/docs/#/zh-cn/globals?id=runtimeloadjarpath)

- `path` {string} jar文件路径

加载目标jar文件，加载成功后将可以使用该Jar文件的类。

```
// 加载jsoup.jar
runtime.loadJar("./jsoup.jar");
// 使用jsoup解析html
importClass(org.jsoup.Jsoup);
log(Jsoup.parse(files.read("./test.html")));
```

(jsoup是一个Java实现的解析Html DOM的库，可以在[Jsoup](https://jsoup.org/download)下载)

## [runtime.loadDex(path)](https://pro.autojs.org/docs/#/zh-cn/globals?id=runtimeloaddexpath)

- `path` {string} dex文件路径

加载目标dex文件，加载成功后将可以使用该dex文件的类。

因为加载jar实际上是把jar转换为dex再加载的，因此加载dex文件会比jar文件快得多。可以使用Android SDK的build tools的dx工具把jar转换为dex。

## [context](https://pro.autojs.org/docs/#/zh-cn/globals?id=context)

全局变量。一个android.content.Context对象。

注意该对象为ApplicationContext，因此不能用于界面、对话框等的创建。

**示例:**

```js

// 活动/包名 可在悬浮窗中 设置 查看,也可以在布局中查看
// 返回最近一次监测到的正在运行的应用的包名，一般可以认为就是当前正在运行的应用的包名。
// 此函数依赖于无障碍服务，如果服务未启动，则抛出异常并提示用户启动。
// 有的app 需要重启才能获取到包名
// 相当于每个 app 的标识
// console.log(currentPackage()); //com.tencent.mobileqq

// 返回最近一次监测到的正在运行的Activity的名称，一般可以认为就是当前正在运行的Activity的名称。
// 此函数依赖于无障碍服务，如果服务未启动，则抛出异常并提示用户启动。
// 相当于app 内每个界面的特定标识
// 用于app 内界面的跳转(也可以从其他软件跳转,比如分享跳转到QQ 的分享界面)
// console.log(currentActivity()); //com.mrpoid.app.EmulatorActivity

// // 等待并轮询查看特定界面是否出现
// waitForActivity("com.mrpoid.app.EmulatorActivity",200)
// toast('没有查询到,下边代码不会执行')

// // 轮询查看是否进入app 才查询到,只有进入app 才会显示包名
// waitForPackage('com.tencent.mobileqq',200)
// toast('没有查询到,下边代码不会执行')

// 复制/获取
// 如果运行复制同一个字符串,会缓存下来,f5 不会执行复制/获取
// setClip('1复制文字111')
// 没有root,需要在autojs 内才能获取到
// log('内瓤:'+getClip());

// 粘贴
// 打开输入框,F5 运行即可粘贴
// paste()
//也可以获取输入框进行粘贴
// id('cc').findOne().paste()

// 随机数
// log(random()) //[0,1)  0.12367916255484013
// log(random(0,1)) //0 或 1  取整数  
// log(random(0,100)) //[0,100]  0 到 100  取整数 

// 案例 随机点击图标
// var 桌面控件=id('桌面的id').find()
// var 控件数量=桌面控件.size()
// var ra=random(0,控件数量-1)
// var 坐标=桌面控件.get(ra).bounds()
// click(坐标.centerX(),坐标.centerY())



// try{
//     requiresApi(19)   //安卓是否达到了7.0 版本,不报错就是达到了,否则无法执行该函数
//     requiresApi(29)   //安卓是否达到了  版本,不报错就是达到了,否则无法执行该函数
//     requiresApi(33)   //rapped com.stardust.autojs.runtime.exception.ScriptException: 本脚本需要此安卓版本以上才能运行:Unknown

// }catch(error){
//     // 捕获到错误,这样就不会报错了
//     console.log(error);
//     toast('安卓版本不符合要求')
//     // 结束脚本
//     exit()
// }
// 版本号
// console.log(app.autojs.versionCode);  //461
// // 版本
// console.log(app.autojs.versionName);  //4.1.1 Alpha2

// requiresAutojsVersion(app.autojs.versionCode)
// requiresAutojsVersion(app.autojs.versionName)
// { major: 4, minor: 1, revision: 1, buildType: 0, build: 2 } { major: 4, minor: 1, revision: 1, buildType: 0, build: 2 }

try{
    requiresAutojsVersion(20)
    requiresAutojsVersion(30)
    requiresAutojsVersion(300)
    
    requiresAutojsVersion(500)
}catch(error){
    console.log(error);
    toast('autojs 版本不符合要求')
    // 结束脚本
    exit()
}
```

