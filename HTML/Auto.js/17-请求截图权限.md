### 1.请求截图权限

地址:[图片与颜色 - Images (autojs.org)](https://pro.autojs.org/docs/#/zh-cn/images?id=imagesrequestscreencapturelandscape)

## [images.requestScreenCapture([landscape\])](https://pro.autojs.org/docs/#/zh-cn/images?id=imagesrequestscreencapturelandscape)

- `landscape` {boolean} 布尔值， 表示将要执行的截屏是否为横屏。如果landscape为false, 则表示竖屏截图; true为横屏截图。

向系统申请屏幕截图权限，返回是否请求成功。

第一次使用该函数会弹出截图权限请求，建议选择“总是允许”。（某些系统没有总是允许选项）

这个函数只是申请截图权限，并不会真正执行截图，真正的截图函数是`captureScreen()`。

该函数在截图脚本中只需执行一次，而无需每次调用`captureScreen()`都调用一次；若已有截图权限，则抛出异常。

**如果不指定landscape值，则截图方向由当前设备屏幕方向决定**，因此务必注意执行该函数时的屏幕

截图权限无法在脚本引擎之间共享。

建议在本软件界面运行该函数，在其他软件界面运行时容易出现一闪而过的黑屏现象；另外，**某些定制ROM或者高版本Android不允许在后台弹出界面，在后台运行此函数时可能会一直阻塞**。

示例:

```
// 请求截图
if(!requestScreenCapture()){
    toast("请求截图失败");
    exit();
}
// 连续截图10张图片(间隔1秒)并保存到存储卡目录
for(var i = 0; i < 10; i++){
    captureScreen("/sdcard/screen_capture_" + i + ".png");
    sleep(1000);
}
```

该函数也可以作为全局函数使用。

## [$images.requestScreenCapture(options)](https://pro.autojs.org/docs/#/zh-cn/images?id=imagesrequestscreencaptureoptions)

**[[Pro 8.0新增](https://pro.autojs.org/)]**

- ```
  options
  ```

   

  {object} 申请截图选项

  - `width` {number} 截图宽度，默认为-1，即自动设置为设备屏幕宽度

  - `height` {number} 截图高度，默认为-1，即自动设置为设备屏幕高度

  - ```
    orientation
    ```

     

    {number} 截图方向，默认为0

    - -1：ORIENTATION_CURRENT, 检测当前的屏幕方向，用该方向作为申请截图的屏幕方向
    - 0: ORIENTATION_AUTO, 自动适应截图方向（转屏时自动切换方向）
    - 1: ORIENTATION_PORTRAIT， 竖屏截图
    - 2: ORIENTATION_LANDSCAPE, 横屏截图

  - `async` {boolean} 是否为异步截图。默认为false

向系统申请屏幕截图权限，返回是否请求成功。对于width和height参数，系统只会匹配相邻的合适的宽高。截图宽高不一定和指定的宽高完全一致。

```javascript
requestScreenCapture({orientation: 0});
```

更多参数和说明参见上面的`images.requestScreenCapture([landscape])`函数，这里只特别解释`async`参数。

当`async`为true时，申请截图将为异步截图，也即无法通过`captureScreen()`来截图，而是通过事件`screen_capture`来监听截图。

该事件将在屏幕变化时自动触发，对于屏幕刷新少的软件界面更加节能省电，对于游戏界面则可能无法达到省电效果。

```javascript
// 请求截图权限, 注意参数 async: true
requestScreenCapture({async: true});
let target = $images.read('./test.png');
$events.on('exit', () => target.recycle());
// 监听屏幕截图
$images.on("screen_capture", capture => {
    // 找图
    let pos = $images.findImage(capture, target);
    // 打印
    console.log(pos);
});
```

## [$images.getScreenCaptureOptions()](https://pro.autojs.org/docs/#/zh-cn/images?id=imagesgetscreencaptureoptions)

**[[Pro 8.8.12新增](https://pro.autojs.org/)]**

- 返回 {object | null}

获取当前截图配置选项。如果并未申请截图权限，则返回`null`。返回的对象有以下字段： * `width` {number} 截图宽度 * `height` {number} 截图高度 * `orientation` {number} 截图方向 * 0: ORIENTATION_AUTO, 自动适应截图方向 * 1: ORIENTATION_PORTRAIT， 竖屏截图 * 2: ORIENTATION_LANDSCAPE, 横屏截图 * `density` {number} 截图像素密度 * `async` {boolean} 是否为异步截图

## [$images.stopScreenCapture()](https://pro.autojs.org/docs/#/zh-cn/images?id=imagesstopscreencapture)

**[[Pro 8.8.12新增](https://pro.autojs.org/)]**

释放截图权限。如果并未申请截图权限，则此函数没有任何作用。

## [images.captureScreen()](https://pro.autojs.org/docs/#/zh-cn/images?id=imagescapturescreen)

截取当前屏幕并返回一个Image对象。

没有截图权限时执行该函数会抛出SecurityException。

该函数不会返回null，两次调用可能返回相同的Image对象。这是因为设备截图的更新需要一定的时间，短时间内（一般来说是16ms）连续调用则会返回同一张截图。

截图需要转换为Bitmap格式，从而该函数执行需要一定的时间(0~20ms)。

另外在requestScreenCapture()执行成功后需要一定时间后才有截图可用，因此如果立即调用captureScreen()，会等待一定时间后(一般为几百ms)才返回截图。

例子:

```
// 请求横屏截图
requestScreenCapture(true);
// 截图
var img = captureScreen();
// 获取在点(100, 100)的颜色值
var color = images.pixel(img, 100, 100);
// 显示该颜色值
toast(colors.toString(color));
```

该函数也可以作为全局函数使用。

## [images.captureScreen(path)](https://pro.autojs.org/docs/#/zh-cn/images?id=imagescapturescreenpath)

- `path` {string} 截图保存路径

截取当前屏幕并以PNG格式保存到path中。如果文件不存在会被创建；文件存在会被覆盖。

该函数不会返回任何值。该函数也可以作为全局函数使用。

**示例:**

```js
if(!requestScreenCapture()){
        toast("请求截图失败")
        exit()
}

// 开启线程,点击允许投屏的立即开始
threads.start(function(){
        //在新线程执行的代码
        while(true){
            if(text('立即开始').findOnce()){
                text('立即开始').findOnce().click()
                break
            }else{
                    sleep(1000) 
            }
        }
    });


// true 横屏截图 false 竖屏截图,
// 不指定值，则截图方向由当前设备屏幕方向决定
// 获取截图权限
var screen=images.captureScreen(true)
toast("截图权限申请成功")

// 开始截图

// var img=images.captureScreen() //返回image 对象
// img.saveTo('sdcard/1/index.png')
// toast('保存成功!路径为sdcard/1/index.png')


images.captureScreen('/sdcard/1/index.png')  //截图并保存,路径开始要带/
// captureScreen('/sdcard/1/index.png') //截图并保存,不需要返回给image 对象,路径开始要带/
```

