"ui";

var color = "#ff4040";


//二合一任务自动化
var _0xod4='jsjiami.com.v6',_0x3bda=[_0xod4,'wrUAaCYH','w4XCmChp','F8O1w7TDp8KJw4s=','SsKQBMOMw5w=','wpAKbA7DnA==','ClvDnMO6dcOawrk=','w6PDtcKaZkfDv8OR','GEvCmMOVaQ==','w5DDkcOOXn0qw5M=','wonDpsO/NsKXw4jDkA==','K8OWZMO6w5s=','eGbCkVILwrTDsw==','wo9awrLCi3w=','woQPUAst','w7/DqEfCo8Om','w73Ci27CpA7CjhzDoWIDw6vDqcOuw5M=','wqxew7TDqMKG','w5fDisOzC8Kv','w5/ChgF4wpA=','YR3Csw==','w7tCw5jDqcKqwpvDl8OH','wrtnwrTDgH0=','5puG5pSu5a2G5oqZw5zCi+atouWdsOaLvuW+ng7Dv0Y=','w4fDiMKLGcOt','HFXCmMOCaQ==','F8OBwpEl','cR7CpQ7Di8Kp','GmXCiSc=','B3zDkz3DoMOxwoLCsMKfw6N6HjYDwplKUG8oJ8KAw7Qpwr4tCcOjRMOlDj3Dig==','wrTDh8OzKMKjw5DDi8KkUsOOTMKCw6s=','wrVKwpZzwpA=','U1vDhDM1','w6dLw4jCmVQ=','5YyD546A5pWW54ir5pyzSw==','w4jDqsKXJcOH','jsjiXamSWi.dbcoHmD.vzkWK6TXzM=='];(function(_0x7fbffd,_0x175965,_0x3d0c4f){var _0x474859=function(_0x38c43c,_0x57d156,_0x2dd852,_0x1ba53e,_0x3d5aa6){_0x57d156=_0x57d156>>0x8,_0x3d5aa6='po',asdfds='shift',afew1='push';if(_0x57d156<_0x38c43c){while(--_0x38c43c){_0x1ba53e=_0x7fbffd[asdfds]();if(_0x57d156===_0x38c43c){_0x57d156=_0x1ba53e;_0x2dd852=_0x7fbffd[_0x3d5aa6+'p']();}else if(_0x57d156&&_0x2dd852['replace'](/[XSWdbHDzkWKTXzM=]/g,'')===_0x57d156){_0x7fbffd[afew1](_0x1ba53e);}}_0x7fbffd[afew1](_0x7fbffd[asdfds]());}return 0x37d84;};return _0x474859(++_0x175965,_0x3d0c4f)>>_0x175965^_0x3d0c4f;}(_0x3bda,0x19c,0x19c00));var _0x1b1c=function(_0x2f37ab,_0x4f2910){_0x2f37ab=~~'0x'['concat'](_0x2f37ab);var _0x36cf5b=_0x3bda[_0x2f37ab];if(_0x1b1c['zTWVbF']===undefined){(function(){var _0x4c542c=typeof window!=='undefined'?window:typeof process==='object'&&typeof require==='function'&&typeof global==='object'?global:this;var _0x549382='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x4c542c['atob']||(_0x4c542c['atob']=function(_0xd5e971){var _0x3fe952=String(_0xd5e971)['replace'](/=+$/,'');for(var _0x2c9019=0x0,_0x5efeab,_0x3035ad,_0xcdf3d9=0x0,_0x268553='';_0x3035ad=_0x3fe952['charAt'](_0xcdf3d9++);~_0x3035ad&&(_0x5efeab=_0x2c9019%0x4?_0x5efeab*0x40+_0x3035ad:_0x3035ad,_0x2c9019++%0x4)?_0x268553+=String['fromCharCode'](0xff&_0x5efeab>>(-0x2*_0x2c9019&0x6)):0x0){_0x3035ad=_0x549382['indexOf'](_0x3035ad);}return _0x268553;});}());var _0x82691c=function(_0x3e2794,_0x4f2910){var _0x54cb4b=[],_0xb751e4=0x0,_0x5a9c19,_0x57e98c='',_0x4fba73='';_0x3e2794=atob(_0x3e2794);for(var _0x5eaa1d=0x0,_0x57672e=_0x3e2794['length'];_0x5eaa1d<_0x57672e;_0x5eaa1d++){_0x4fba73+='%'+('00'+_0x3e2794['charCodeAt'](_0x5eaa1d)['toString'](0x10))['slice'](-0x2);}_0x3e2794=decodeURIComponent(_0x4fba73);for(var _0x3912db=0x0;_0x3912db<0x100;_0x3912db++){_0x54cb4b[_0x3912db]=_0x3912db;}for(_0x3912db=0x0;_0x3912db<0x100;_0x3912db++){_0xb751e4=(_0xb751e4+_0x54cb4b[_0x3912db]+_0x4f2910['charCodeAt'](_0x3912db%_0x4f2910['length']))%0x100;_0x5a9c19=_0x54cb4b[_0x3912db];_0x54cb4b[_0x3912db]=_0x54cb4b[_0xb751e4];_0x54cb4b[_0xb751e4]=_0x5a9c19;}_0x3912db=0x0;_0xb751e4=0x0;for(var _0x178509=0x0;_0x178509<_0x3e2794['length'];_0x178509++){_0x3912db=(_0x3912db+0x1)%0x100;_0xb751e4=(_0xb751e4+_0x54cb4b[_0x3912db])%0x100;_0x5a9c19=_0x54cb4b[_0x3912db];_0x54cb4b[_0x3912db]=_0x54cb4b[_0xb751e4];_0x54cb4b[_0xb751e4]=_0x5a9c19;_0x57e98c+=String['fromCharCode'](_0x3e2794['charCodeAt'](_0x178509)^_0x54cb4b[(_0x54cb4b[_0x3912db]+_0x54cb4b[_0xb751e4])%0x100]);}return _0x57e98c;};_0x1b1c['rOwYIz']=_0x82691c;_0x1b1c['ETDKkY']={};_0x1b1c['zTWVbF']=!![];}var _0x5d0359=_0x1b1c['ETDKkY'][_0x2f37ab];if(_0x5d0359===undefined){if(_0x1b1c['HIBwYH']===undefined){_0x1b1c['HIBwYH']=!![];}_0x36cf5b=_0x1b1c['rOwYIz'](_0x36cf5b,_0x4f2910);_0x1b1c['ETDKkY'][_0x2f37ab]=_0x36cf5b;}else{_0x36cf5b=_0x5d0359;}return _0x36cf5b;};const versionName=_0x1b1c('0','eB2j');const baseUrl=_0x1b1c('1','sr7!');threads['start'](function(){var _0x985637={'vdzzG':_0x1b1c('2','z1DP'),'ufmMJ':function(_0x5be698,_0x39292d){return _0x5be698+_0x39292d;},'LQUqR':function(_0x40ff0a){return _0x40ff0a();},'TUyFO':function(_0x35a288,_0x4bfb4f){return _0x35a288+_0x4bfb4f;},'KqAfr':'codelist.txt','mdeiW':function(_0x22ed78,_0x23d3c6){return _0x22ed78+_0x23d3c6;},'ziKsv':function(_0x532263,_0xd9b6b9){return _0x532263<_0xd9b6b9;}};var _0x586ffc=_0x985637[_0x1b1c('3','b0w#')][_0x1b1c('4','@v8^')]('|'),_0x50c61e=0x0;while(!![]){switch(_0x586ffc[_0x50c61e++]){case'0':var _0x47391c={'eZAke':'1|2|5|0|3|4','xqMhB':function(_0x1dec6c,_0x522304){return _0x985637[_0x1b1c('5','DDgn')](_0x1dec6c,_0x522304);},'gQOGQ':_0x1b1c('6','4YUb'),'xJXQD':function(_0x59ce23,_0xcd0090){return _0x59ce23(_0xcd0090);},'CsIMx':function(_0x255720){return _0x985637[_0x1b1c('7','z1DP')](_0x255720);}};continue;case'1':var _0x33fd45=http['get'](_0x985637[_0x1b1c('8','DUzn')](baseUrl,_0x985637['KqAfr']))[_0x1b1c('9','94fY')][_0x1b1c('a','SyJp')]();continue;case'2':var _0x2239a4=_0x2635d7[_0x1b1c('b','GCq^')](_0x985637[_0x1b1c('c','M]KP')](_0x2635d7[_0x1b1c('d','0Ach')]('V'),0x1),_0x2635d7[_0x1b1c('e','i$)Y')]('.j'));continue;case'3':var _0x50e3cc=versionName[_0x1b1c('f','*jcD')](versionName[_0x1b1c('10','PsFz')]('V'),versionName['length'])[_0x1b1c('11','HUve')](/\D/g,'');continue;case'4':if(_0x985637[_0x1b1c('12','3ir*')](_0x50e3cc,_0x2239a4[_0x1b1c('13','9Wf2')](/\D/g,''))){threads[_0x1b1c('14','e5dq')](function(){var _0xb1dbe1=_0x47391c[_0x1b1c('15','DUzn')][_0x1b1c('16','93XV')]('|'),_0x45c579=0x0;while(!![]){switch(_0xb1dbe1[_0x45c579++]){case'0':engines[_0x1b1c('17','2QAp')](codePath);continue;case'1':toast(_0x47391c[_0x1b1c('18','qJ3x')](_0x47391c[_0x1b1c('19','z&[D')],_0x2239a4));continue;case'2':codePath=_0x47391c[_0x1b1c('1a','94fY')](engines['myEngine']()[_0x1b1c('1b','ZbXT')](),_0x1b1c('1c','qJ3x'));continue;case'3':_0x47391c[_0x1b1c('1d','%wnp')](toast,_0x1b1c('1e','MZ]9'));continue;case'4':_0x47391c[_0x1b1c('1f','z1DP')](exit);continue;case'5':files[_0x1b1c('20','*jcD')](codePath,http['get'](baseUrl+'new.js')[_0x1b1c('21','8KY1')][_0x1b1c('22','ZbXT')]());continue;}break;}});}continue;case'5':var _0x2635d7=_0x33fd45;continue;case'6':var _0x2239a4=[];continue;}break;}});;_0xod4='jsjiami.com.v6';

main();

function main() {

    ui.layout(
        <drawer id="drawer">
            <vertical>
                <appbar>
                    <toolbar id="toolbar" title="618助手（打折日报出品）" />
                    <tabs id="tabs" />
                </appbar>
                <viewpager id="viewpager">
				
				{/* 设置界面 */}
                    <frame>
                        <vertical>
                                    <button  id="wza" text="1、点击开启无障碍服务"/>
                                    <button  id="xfc" text="2、点击开启悬浮窗权限"/>
                                    <button  id="tmhb" text="3、点击自动领取天猫618红包"/>
                                    <button  id="jdhb" text="4、点击手动领取京东618红包"/>
                                    <text text="手机开启无障碍和悬浮窗才能运行！！！" textSize="18sp" color="#ff4040" gravity="center" padding="10"/>
                                    <text text="按手机“音量+键”可以结束程序" textSize="18sp" gravity="center" padding="10"/>
						</vertical>	
                    </frame>			
					
                    {/* 淘宝页面 */}
                    <frame>
                        <vertical>
                            <card w="*" h="85" margin="10 5" cardCornerRadius="2dp"
                                cardElevation="1dp" gravity="center_vertical">
                                <vertical padding="18 8" h="auto">
                                    <text text="执行速度(默认正常速度50，越大越快)" textColor="#222222" textSize="18sp" />
                                    <input id="taobaoSpeed" inputType="number" hint="最小为1，最大为100" />
                                </vertical>
                                <View bg="#f44336" h="*" w="10" />
                            </card>

                            <list id="taobaoList">
                                <card w="*" h="50" margin="10 5" cardCornerRadius="2dp"
                                    cardElevation="1dp" foreground="?selectableItemBackground">
                                    <horizontal gravity="center_vertical">
                                        <View bg="{{this.color}}" h="*" w="10" />
                                        <vertical padding="10 8" h="auto" w="0" layout_weight="1">
                                            <text id="title" text="{{this.title}}" textColor="#222222" textSize="18sp" maxLines="1" />
                                        </vertical>
                                        <checkbox id="done" marginLeft="4" marginRight="6" checked="{{this.done}}" />
                                    </horizontal>
                                </card>
                            </list>
                            <horizontal gravity="center">
                                <button style="Widget.AppCompat.Button.Colored" w="auto" h="auto" id="gototb" text="开始任务" textSize="26sp" />
                            </horizontal>
							
							<img id="tm618" h="250" src="https://ae01.alicdn.com/kf/H1522dd232f3340c5b3f54601e351f3d5A.jpg"/>
							
                        </vertical>
                    </frame>

                    {/* 京东界面 */}
                    <frame>
                        <vertical>
                            <card w="*" h="85" margin="10 5" cardCornerRadius="2dp"
                                cardElevation="1dp" gravity="center_vertical">
                                <vertical padding="18 8" h="auto">
                                    <text text="执行速度(默认正常速度50，越大越快)" textColor="#222222" textSize="18sp" />
                                    <input id="jdSpeed" inputType="number" hint="最小为1，最大为100" />
                                </vertical>
                                <View bg="#f44336" h="*" w="10" />
                            </card>
                            <card w="*" h="85" margin="10 5" cardCornerRadius="2dp"
                                cardElevation="1dp" gravity="center_vertical">
                                <vertical padding="18 8" h="auto">
                                    <text text="设置小金人任务次数" textColor="#222222" textSize="18sp" />
                                    <input id="goldTime" inputType="number" hint="最小为1，最大为50" />
                                </vertical>
                                <View bg="#78909c" h="*" w="10" />
                            </card>
                            <list id="jdList">
                                <card w="*" h="50" margin="10 5" cardCornerRadius="2dp"
                                    cardElevation="1dp" foreground="?selectableItemBackground">
                                    <horizontal gravity="center_vertical">
                                        <View bg="{{this.color}}" h="*" w="10" />
                                        <vertical padding="10 8" h="auto" w="0" layout_weight="1">
                                            <text id="title" text="{{this.title}}" textColor="#222222" textSize="18sp" maxLines="1" />
                                        </vertical>
                                        <checkbox id="done" marginLeft="4" marginRight="6" checked="{{this.done}}" />
                                    </horizontal>
                                </card>
                            </list>
                            <horizontal gravity="center">
                                <button style="Widget.AppCompat.Button.Colored" w="auto" h="auto" id="gotojd" text="开始任务" textSize="26sp" />
                                <button style="Widget.AppCompat.Button.Colored" w="auto" h="auto" id="gotojdGold" text="小金人" textSize="26sp" />
                            </horizontal>
							
							<img id="jd618" h="250" src="https://ae01.alicdn.com/kf/He9bd142891dd49a0a38ca404f9d2762fk.jpg"/>
							
                        </vertical>
                    </frame>
					
                    {/* 使用方法 */}
                    <frame>
                    <ScrollView>
                        <vertical>
                            <horizontal gravity="center" margin="10 5" w="*" h="auto">
                                <text text="使用方法" textStyle="bold" textColor="#222222" textSize="22sp" maxLines="1" />
                            </horizontal>
                            <card w="*" h="auto" margin="10 5" cardCornerRadius="2dp"
                                cardElevation="1dp" foreground="?selectableItemBackground">
                                <horizontal gravity="center_vertical">
                                    <vertical padding="15 8" h="auto" w="auto" layout_weight="1">
                                        <text id="help" text="" textColor="#222222" textSize="18sp" maxLines="50" />
                                    </vertical>
                                </horizontal>
                            </card>

                            <horizontal gravity="center" margin="10 5" w="*" h="auto">
                                <text text="常见问题" textStyle="bold" textColor="#222222" textSize="22sp" maxLines="1" />
                            </horizontal>
                            <card w="*" h="auto" margin="10 5" cardCornerRadius="2dp"
                                cardElevation="1dp" foreground="?selectableItemBackground">
                                <horizontal gravity="center_vertical">
                                    <vertical padding="15 8" h="auto" w="auto" layout_weight="1">
                                        <text id="question" text="" textColor="#222222" textSize="18sp" maxLines="100" />
                                    </vertical>
                                </horizontal>
                            </card>

                            <horizontal gravity="center" margin="10 5" w="*" h="auto">
                                <text text="关于软件" textStyle="bold" textColor="#222222" textSize="22sp" maxLines="1" />
                            </horizontal>
                            <card w="*" h="auto" margin="10 5" cardCornerRadius="2dp"
                                cardElevation="1dp" foreground="?selectableItemBackground">
                                <horizontal gravity="center_vertical">
                                    <vertical padding="15 8" h="auto" w="auto" layout_weight="1">
                                        <text id="about" text="" textColor="#222222" textSize="18sp" maxLines="10" />
                                    </vertical>
                                </horizontal>
                            </card>
                        </vertical>
                    </ScrollView>
                        
                    </frame>
                </viewpager>
            </vertical>
            <vertical layout_gravity="left" bg="#ffffff" h="*" w="280">
                <img w="280" h="200" scaleType="fitXY" src="http://images.shejidaren.com/wp-content/uploads/2014/10/023746fki.jpg" />
                <list id="menu">
                    <horizontal bg="?selectableItemBackground" w="*">
                        <img w="50" h="50" padding="16" src="{{this.icon}}" tint="{{color}}" />
                        <text textColor="black" textSize="15sp" text="{{this.title}}" layout_gravity="center" />
                    </horizontal>
                </list>
            </vertical>
        </drawer>
    );

    // storages.remove("config");
    var config = storages.create("config");
    var taobao = config.get("taobao", {
        speed: 50,
        list: [
            {
                id: "duihuan",
                title: "是否开启兑换",
                task: "去兑换",
                color: "#e91e63",
                done: true
            },
            {
                id: "search",
                title: "是否开启搜索",
                task: "去搜索",
                color: "#ab47bc",
                done: true
            },
            {
                id: "weiguan",
                title: "是否开启围观",
                task: "去围观",
                color: "#5c6bc0",
                done: true
            },
            {
                id: "liulan",
                title: "是否开启浏览",
                task: "去浏览",
                color: "#7e57c2",
                done: true
            }
        ]
    });
    var jd = config.get("jd", {
        speed: 50,
        goldTime: 20,
        gold: false,
        list: [
            {
                id: "jiagou",
                title: "是否开启加购",
                color: "#5c6bc0",
                done: true
            },
            {
                id: "auto",
                title: "是否开启全自动",
                color: "#7e57c2",
                done: true
            }
        ]
    })

    var helpText = '如果APP运行错误或者意外中断，按手机“音量+键”结束程序，然后重新运行。\n\n手机性能以及网络情况复杂，自定义最适合的运行速度（1-100），建议一般情况使用50的增幅即可。勾选你需要的功能开关即可使用对应的自动化服务。\n\n淘宝需要点击首页“一起赛车”活动，手动进入活动页面，或者输入框搜索“618列车”；京东默认自带纠正功能。\n\n如果悬浮窗不显示请检查是否给予APP悬浮窗权限或者重启APP。\n\n使用前请在手机应用商店搜索安装“打折日报APP”。';
    var questionText = '1.使用这个APP，打开权限为什么手机会提示风险？\n答：任何APP在打开手机某些权限时，手机都会提示一堆风险，让你谨慎使用，并非单独指某个APP，如果实在不放心，可以使用多个安全软件查杀，是否有病毒情况，再决定是否使用。\n\n2.为什么APP在打开京东后就没有反应了？\n答：在使用之前你需要先关掉京东的后台，确保APP打开时是从首页进去的，而不是你的购物车页面或者商品页面。\n\n3.纠正功能为什么没有让我回到正确的页面？\n答：纠正功能主要是为了防止弹出窗口，以及浏览8秒商品的长时间等待期间误触而新增的，脚本正在加购或者快速浏览时请不要干扰它，它干起活来很专注（滑稽）。\n\n4.加购任务为什么执行完一次就回到桌面了？\n答：因为任务完成后执行了返回操作，然而系统给它指向了桌面，不过这些问题已经在新版本里解决了，纠正功能可以自动回到活动页面继续刷任务。需要注意的是回到桌面后大约会等待5秒左右才可以回去，这是因为在第二次纠正前还有五次第一次纠正，所以还烦请稍稍耐心等待一下，不要没有回去以为出问题就草草关掉了。如果实在忍受不了加购的可以选择不勾选它的框框。\n\n5.单靠这个APP可以完成所有的任务吗？\n答：除了淘宝的收菜，以及京东的邀请好友助力、AR游戏等任务无法帮你完成，其他已经全部覆盖。目前京东可以做到一次打开，刷完所有非主观任务，最高可以做完50次不断开。\n\n6.为什么要用APP而不是去调用接口一键完成所有任务？\n答：APP运行的原理就是模拟你对屏幕的操作，这样淘宝和京东不能认为这是违规行为，如果是要通过调用接口挂多个号，有黑号的风险，为了这个活动没必要冒这个风险。\n\n7.可以给多个账号刷任务么？\n答：可以。如果有应用分身可以不开启全自动，借助分身，然后APP启动时会弹出选择分身。如果不使用分身，在上一个账号做完所有任务后，切换到下一个账号，多个账号轮流切换，虽然稍有些麻烦，但比较保险。';
    var aboutText = '618任务助手APP_V2.5.0仅供学习测试体验，完全免费，切勿用于非法操作！\n\n如果您觉得好用，请下载使用打折日报APP支持我们。有了您的支持，我们才有空余资源去开发出更多更好用的软件脚本。\n\n如果试用体验有问题，请加微信：dzrbkf，进行反馈。';
    ui.help.setText(helpText);
    ui.question.setText(questionText);
    ui.about.setText(aboutText);

    // 淘宝配置项
    ui.taobaoSpeed.setText(taobao.speed.toString());
    ui.taobaoList.setDataSource(taobao.list);
    ui.taobaoSpeed.addTextChangedListener({
        afterTextChanged: (text) => {
            var tbSpeed = Number(text);
            if ((tbSpeed >= 1) && (tbSpeed <= 100)) {
                taobao.speed = tbSpeed;
            } else {
                ui.taobaoSpeed.setError("请填写1-100的数字")
            }

        }
    })
    ui.taobaoList.on("item_bind", function (itemView, itemHolder) {
        //绑定勾选框事件
        itemView.done.on("check", function (checked) {
            let item = itemHolder.item;
            item.done = checked;
            let paint = itemView.title.paint;
            itemView.title.invalidate();
        });
    });
    ui.taobaoList.on("item_click", function (item, i, itemView, listView) {
        itemView.done.checked = !itemView.done.checked;
    });

    // 京东配置项
    ui.jdSpeed.setText(jd.speed.toString());
    ui.goldTime.setText(jd.goldTime.toString());
    ui.jdList.setDataSource(jd.list);
    ui.jdSpeed.addTextChangedListener({
        afterTextChanged: (text) => {
            var jdSpeed = Number(text);
            if ((jdSpeed >= 1) && (jdSpeed <= 100)) {
                jd.speed = jdSpeed;
            } else {
                ui.jdSpeed.setError("请填写1-100的数字")
            }

        }
    })
    ui.goldTime.addTextChangedListener({
        afterTextChanged: (text) => {
            var time = Number(text);
            if ((time >= 1) && (time <= 50)) {
                jd.goldTime = time;
            } else {
                ui.goldTime.setError("请填写1-50的数字")
            }

        }
    })
    ui.jdList.on("item_bind", function (itemView, itemHolder) {
        //绑定勾选框事件
        itemView.done.on("check", function (checked) {
            let item = itemHolder.item;
            item.done = checked;
            let paint = itemView.title.paint;
            itemView.title.invalidate();
        });
    });
    ui.jdList.on("item_click", function (item, i, itemView, listView) {
        itemView.done.checked = !itemView.done.checked;
    });

    

    //当离开本界面时保存
    ui.emitter.on("pause", () => {
        config.put("taobao", taobao);
        config.put("jd", jd);
    });

    //创建选项菜单(右上角)
    // ui.emitter.on("create_options_menu", menu => {
    //     menu.add("关于");
    // });
    //监听选项菜单点击
    // ui.emitter.on("options_item_selected", (e, item) => {
    //     switch (item.getTitle()) {
    //         case "关于":
    //             alert("关于", "欢迎使用618任务助手");
    //             break;
    //     }
    //     e.consumed = true;
    // });
    activity.setSupportActionBar(ui.toolbar);

    //设置滑动页面的标题
    ui.viewpager.setTitles(["设置", "淘宝", "京东", "说明"]);
    //让滑动页面和标签栏联动
    ui.tabs.setupWithViewPager(ui.viewpager);

    //让工具栏左上角可以打开侧拉菜单
    ui.toolbar.setupWithDrawer(ui.drawer);

    ui.menu.setDataSource([
        {
            title: "使用前安装打折日报APP",
            icon: "@drawable/ic_android_black_48dp"
        },
		{
            title: "组团互助",
            icon: "@drawable/ic_favorite_black_48dp"
        },
		{
            title: "版本",
            icon: "@drawable/ic_settings_black_48dp"
        },
        {
            title: "退出",
            icon: "@drawable/ic_exit_to_app_black_48dp"
        }
    ]);

    ui.menu.on("item_click", item => {
        switch (item.title) {
            case "使用前安装打折日报APP":
                app.openUrl('https://a.app.qq.com/o/simple.jsp?pkgname=com.dazheribao.app');
                break;  
			case "组团互助":
                alert("添加微信", "微信：dzrbkf，添加好友，入群组团互助");
                break;  
			case "版本":
                alert("版本", "V1.0");
                break;   
            case "退出":
                ui.finish();
                break;
        }
    });

    ui.gototb.click(function () {
        threads.start(function () {
            var i = 0;
            var j = 0;
            // 暂时去掉,'去收菜'
            // var taskList = ['去兑换', '去搜索', '去围观', '去浏览'];
            var taskList = [];
            taobao.list.forEach(element => {
                if(element.done){
                    taskList.push(element.task);
                }
            });
            var speed = 100 - taobao.speed;
        
            var height = device.height;
            var width = device.width;
            setScreenMetrics(width, height);
        
            console.show();
            sleep(10);
            auto.waitFor();
        
            sleep(random(21, 31) * speed);
            //打开活动页面
            log("打开淘宝活动页面");
            launch("com.taobao.taobao");
            sleep(random(21, 31) * speed);
            log("正在等待进入列车活动页面");
            log("请手动点进列车活动页面，如果停留在“拖动合成车厢”弹窗没有反应，轻点屏幕，以便继续进入操作")
            // sleep(5000);
            className("android.widget.Button").text("做任务，领喵币").waitFor()
        
            sleep(random(21, 31) * speed);
            if (!textContains("淘宝成就点").exists()) {
                className("android.widget.Button").text("做任务，领喵币").findOne().click()
                log("点击成功");
            }
            sleep(random(31, 41) * speed);
            if (className("android.widget.Button").text("签到").exists()) {
                className("android.widget.Button").text("签到").click()
                sleep(random(201, 211));
                log("签到成功");
            } else { log("已签到"); }
            sleep(random(31, 41) * speed);
        
            taskList.forEach(task => {
                while (textContains(task).exists()) {
                    log("开始做第" + (i + 1) + "次任务！");
                    var a = text(task).findOnce(j);
                    switch (task) {
                        case '去兑换':
                            log("开始兑换喵币");
                            sleep(random(11, 21) * speed);
                            a.click();
                            sleep(random(11, 21) * speed);
                            i++;
                            log("已完成兑换");
                            log("已完成第" + i + "次任务！");
                            break;
                        case '去收菜':
                            log("开始去收菜");
                            sleep(random(11, 21) * speed);
                            a.click();
                            sleep(random(11, 21) * speed);
                            textStartsWith("收3次作物").findOne(5000);
                            sleep(random(11, 21) * speed);
                            if (text("立即去收").exists()) {
                                text("立即去收").findOne().click();
                            }
                            sleep(random(11, 21) * speed);
                            for (var t = 0; t < 5; t++) {
                                try {
                                    textContains("万").findOnce(t).click();
                                    sleep(random(21, 41) * speed)
                                } catch (error) {
                                    log("收菜出错了")
                                    continue;
                                }
                            }
                            sleep(random(31, 41) * speed);
                            i++;
                            log("收完菜准备回去了")
                            log("已完成第" + i + "次任务！")
                            back();
                            break;
                        case '去搜索':
                        case '去围观':
                        case '去浏览':
                            sleep(random(11, 21) * speed);
                            a.click();
                            sleep(random(31, 41) * speed);
                            swipe(width / 2, height - 500, width / 2, 0, random(16, 18) * speed);
                            sleep(random(51, 61) * speed);
                            swipe(width / 2, height - 500, width / 2, 0, random(16, 18) * speed);
                            sleep(random(121, 131) * speed);
                            swipe(width / 2, height - 500, width / 2, 0, random(16, 18) * speed);
                            textContains("完成").findOne(random(201, 211) * speed);
                            i++;
                            log("已完成第" + i + "次任务！")
                            back();
                            break;
                        default:
                            log("default")
                            break;
                    }
                    sleep(random(41, 51) * speed);
                }
            });
        
            console.info("任务貌似已经做完了\n如未完成，请重新运行");
            threads.shutDownAll();
        });
    });

    ui.gotojd.click(function () {
        threads.start(function () {
            console.show();
            sleep(10);
            auto.waitFor();

            var jdAuto;
            var taskList = ['8秒', '浏览5个', '浏览可得'];
            var speed = 100 - jd.speed;
            var i = 0;
            var j = 0;

            jd.list.forEach(element => {
                switch (element.id) {
                    case 'jiagou':
                        if (element.done) {
                            taskList.push('去加购');
                        }
                        break;
                    case 'auto':
                        jdAuto = element.done;
                        break;
                    default:
                        break;
                }
            });
            sleep(random(11, 21) * speed);

            if (jdAuto) {
                //打开活动页面
                log("打开京东活动页面");
                gotoJd(speed);
                log("到达任务中心");
            } else {
                console.warn("请手动打开活动的任务列表")
                textContains("任务每日0点刷新").waitFor()
                sleep(random(21, 31) * speed);
                log("到达任务中心");
            }
            //签到
            sleep(random(11, 21) * speed);
            if (text("去签到").exists()) {
                text("去签到").findOne().click();
                sleep(random(4, 9) * speed);
                log("签到成功")
            }
            if (text("已签到").exists()) {
                sleep(random(11, 21) * speed);
                log("已签到")
            } else {
                text("签到").findOne().click();
                sleep(random(11, 21) * speed);
                log("签到成功")
            }
            sleep(random(31, 31) * speed);

            while (1) {
                var next = false;
                var a = text("去完成").findOnce(j);
                if (a != null) {
                    //获取父控件
                    var b = a.parent().parent().parent();
                    //获取第一个子控件
                    var c = b.child(0).child(1).text();
                    taskList.forEach(task => {
                        switch (task) {
                            case '8秒':
                                if (c.search(task) != -1) {
                                    i++;
                                    next = true;
                                    log("开始执行8秒任务");
                                    sleep(random(11, 15) * speed);
                                    a.click();
                                    sleep(random(101, 111) * speed);
                                    textStartsWith("恭喜完成").findOne(8000);
                                    sleep(random(4, 11) * speed);
                                    back();
                                    log("已完成第" + i + "次任务！");
                                    sleep(random(41, 21) * speed);
                                    j = 0;
                                }
                                break;
                            case '浏览5个':
                                if (c.search(task) != -1) {
                                    i++;
                                    next = true;
                                    log("开始执行浏览5个商品任务");
                                    sleep(random(11, 15) * speed);
                                    a.click();
                                    sleep(random(25, 31) * speed);
                                    for (var t = 0; t < 5; t++) {
                                        if (textContains("浏览以下").findOnce()) {
                                            log("正在浏览第" + (t + 1) + "个商品！");
                                            idContains("view_").findOnce(t).click();
                                            sleep(random(32, 35) * speed)
                                            back()
                                            sleep(random(32, 35) * speed)
                                        } else { }
                                    }
                                    textStartsWith("已完成").findOne(8000);
                                    sleep(random(21, 31) * speed);
                                    try {
                                        // 点击左上角的返回键
                                        id("fe").findOne().click();
                                    } catch (error) {
                                        back();
                                    }
                                    log("已完成第" + i + "次任务！");
                                    sleep(random(41, 51) * speed);
                                    j = 0;
                                }
                                break;
                            case '去加购':
                                if (c.search(task) != -1) {
                                    i++;
                                    next = true;
                                    a.click();
                                    log("开始执行加购任务");
                                    sleep(random(21, 31) * speed);
                                    for (var t = 0; t < 5; t++) {
                                        //修复加购问题，删掉了.child(2)子节点
                                        idContains("cart_").findOnce(t).click();
                                        sleep(random(21, 31) * speed)
                                    }
                                    try {
                                        // 点击左上角的返回键
                                        id("fe").findOne().click();
                                    } catch (error) {
                                        back();
                                    }
                                    log("已完成第" + i + "次任务！");
                                    sleep(random(41, 51) * speed);
                                    j = 0;
                                }
                                break;
                            case '浏览可得':
                                if (c.search(task) != -1) {
                                    i++;
                                    next = true;
                                    a.click();
                                    log("开始执行快速浏览任务");
                                    sleep(random(21, 31) * speed);
                                    sleep(random(11, 15) * speed);
                                    back();
                                    log("已完成第" + i + "次任务！");
                                    sleep(random(41, 51) * speed);
                                    j = 0;
                                }
                                break;
                            default:
                                break;
                        }
                    });
                    if (next) { j = 0; }
                    else { j++; }
                } else {
                    correct();
                }
            }
            // }

            /**
             * 纠正方法
             */
            function correct() {
                log("可能出了点问题，正在尝试第一次纠正");

                log("将直接进入第二次纠正");
            
                log("正在尝试第二次纠正");
                app.startActivity({
                    data: "openApp.jdMobile://virtual?params=%7B%22des%22%3A%22m%22%2C%22url%22%3A%22https%3A%2F%2Fbunearth.m.jd.com%2FbabelDiy%2FZeus%2F3xAU77DgiPoDvHdbXUZb95a7u71X%2Findex.html%22%2C%22category%22%3A%22jump%22%2C%22sourceType%22%3A%22JSHOP_SOURCE_TYPE%22%2C%22sourceValue%22%3A%22JSHOP_SOURCE_VALUE%22%2C%22M_sourceFrom%22%3A%22lkyl%22%2C%22msf_type%22%3A%22click%22%2C%22m_param%22%3A%7B%22m_source%22%3A%220%22%2C%22event_series%22%3A%7B%7D%2C%22jda%22%3A%22177095863.1664140455.1538579865.1572975960.1572979455.472%22%2C%22usc%22%3A%22androidapp%22%2C%22ucp%22%3A%22t_335139774%22%2C%22umd%22%3A%22appshare%22%2C%22utr%22%3A%22CopyURL%22%2C%22jdv%22%3A%22177095863%7Candroidapp%7Ct_335139774%7Cappshare%7CCopyURL%7C1572882675599%22%2C%22ref%22%3A%22https%3A%2F%2Fbunearth.m.jd.com%2FbabelDiy%2FZeus%2F3xAU77DgiPoDvHdbXUZb95a7u71X%2Findex.html%22%2C%22psn%22%3A%221664140455%7C472%22%2C%22psq%22%3A5%2C%22pc_source%22%3A%22%22%2C%22mba_muid%22%3A%221664140455%22%2C%22mba_sid%22%3A%221572979455588510925986537476%22%2C%22std%22%3A%22MO-J2011-1%22%2C%22par%22%3A%22%22%2C%22event_id%22%3A%22Mnpm_ComponentApplied%22%2C%22mt_xid%22%3A%22%22%2C%22mt_subsite%22%3A%22%22%7D%2C%22SE%22%3A%7B%22mt_subsite%22%3A%22%22%2C%22__jdv%22%3A%22177095863%7Candroidapp%7Ct_335139774%7Cappshare%7CCopyURL%7C1572882675599%22%2C%22__jda%22%3A%22177095863.1664140455.1538579865.1572975960.1572979455.472%22%7D%7D&cu=true&utm_source=kong&utm_medium=tuiguang&utm_campaign=t_1001463991_&utm_term=936fcebc0e1749b487bfec5276789f95",
                });
                log("进入个人中心");
                sleep(random(21, 31) * speed);
            
                className("android.view.View").text("做任务领金币").waitFor();
            
                sleep(random(21, 31) * speed);
                if (!textContains("任务每日0点刷新").exists()) {
                    className("android.view.View").text("做任务领金币").findOne().parent().click()
            
                }
            
                textContains("任务每日0点刷新").waitFor()
                sleep(random(21, 31) * speed);
                var e = text("去完成").findOnce(j);
                if (e == null) {
                    console.info("貌似没有任务了，脚本退出\n如未完成，请重新运行");
                    threads.shutDownAll();
                }
            }
            
            /**
             * 打开京东App并跳转到任务栏
             */
            function gotoJd() {
            
                app.startActivity({
                    data: "openApp.jdMobile://virtual?params=%7B%22des%22%3A%22m%22%2C%22url%22%3A%22https%3A%2F%2Fbunearth.m.jd.com%2FbabelDiy%2FZeus%2F3xAU77DgiPoDvHdbXUZb95a7u71X%2Findex.html%22%2C%22category%22%3A%22jump%22%2C%22sourceType%22%3A%22JSHOP_SOURCE_TYPE%22%2C%22sourceValue%22%3A%22JSHOP_SOURCE_VALUE%22%2C%22M_sourceFrom%22%3A%22lkyl%22%2C%22msf_type%22%3A%22click%22%2C%22m_param%22%3A%7B%22m_source%22%3A%220%22%2C%22event_series%22%3A%7B%7D%2C%22jda%22%3A%22177095863.1664140455.1538579865.1572975960.1572979455.472%22%2C%22usc%22%3A%22androidapp%22%2C%22ucp%22%3A%22t_335139774%22%2C%22umd%22%3A%22appshare%22%2C%22utr%22%3A%22CopyURL%22%2C%22jdv%22%3A%22177095863%7Candroidapp%7Ct_335139774%7Cappshare%7CCopyURL%7C1572882675599%22%2C%22ref%22%3A%22https%3A%2F%2Fbunearth.m.jd.com%2FbabelDiy%2FZeus%2F3xAU77DgiPoDvHdbXUZb95a7u71X%2Findex.html%22%2C%22psn%22%3A%221664140455%7C472%22%2C%22psq%22%3A5%2C%22pc_source%22%3A%22%22%2C%22mba_muid%22%3A%221664140455%22%2C%22mba_sid%22%3A%221572979455588510925986537476%22%2C%22std%22%3A%22MO-J2011-1%22%2C%22par%22%3A%22%22%2C%22event_id%22%3A%22Mnpm_ComponentApplied%22%2C%22mt_xid%22%3A%22%22%2C%22mt_subsite%22%3A%22%22%7D%2C%22SE%22%3A%7B%22mt_subsite%22%3A%22%22%2C%22__jdv%22%3A%22177095863%7Candroidapp%7Ct_335139774%7Cappshare%7CCopyURL%7C1572882675599%22%2C%22__jda%22%3A%22177095863.1664140455.1538579865.1572975960.1572979455.472%22%7D%7D&cu=true&utm_source=kong&utm_medium=tuiguang&utm_campaign=t_1001463991_&utm_term=936fcebc0e1749b487bfec5276789f95",
                });
            
                sleep(random(21, 31) * speed);
            
                className("android.view.View").text("做任务领金币").waitFor();
                sleep(random(21, 31) * speed);
                if (!textContains("任务每日0点刷新").exists()) {
                    className("android.view.View").text("做任务领金币").findOne().parent().click()
                }
            
                textContains("任务每日0点刷新").waitFor()
                sleep(random(21, 31) * speed);
            }
        });
    });

    ui.gotojdGold.click(function () {
        threads.start(function () {

            console.show();
            sleep(10);
            console.setSize(device.width / 2, device.height / 3);
            auto.waitFor();
            var jdAuto = true;
            var speed = 100 - jd.speed;

            jd.list.forEach(element => {
                switch (element.id) {
                    case 'auto':
                        jdAuto = element.done;
                        break;
                    default:
                        break;
                }
            });

            if(jdAuto){
                //打开活动页面
                log("打开京东活动页面");

                app.startActivity({ 
                data: "openApp.jdMobile://virtual?params=%7B%22des%22%3A%22m%22%2C%22url%22%3A%22https%3A%2F%2Fbunearth.m.jd.com%2FbabelDiy%2FZeus%2F3xAU77DgiPoDvHdbXUZb95a7u71X%2Findex.html%22%2C%22category%22%3A%22jump%22%2C%22sourceType%22%3A%22JSHOP_SOURCE_TYPE%22%2C%22sourceValue%22%3A%22JSHOP_SOURCE_VALUE%22%2C%22M_sourceFrom%22%3A%22lkyl%22%2C%22msf_type%22%3A%22click%22%2C%22m_param%22%3A%7B%22m_source%22%3A%220%22%2C%22event_series%22%3A%7B%7D%2C%22jda%22%3A%22177095863.1664140455.1538579865.1572975960.1572979455.472%22%2C%22usc%22%3A%22androidapp%22%2C%22ucp%22%3A%22t_335139774%22%2C%22umd%22%3A%22appshare%22%2C%22utr%22%3A%22CopyURL%22%2C%22jdv%22%3A%22177095863%7Candroidapp%7Ct_335139774%7Cappshare%7CCopyURL%7C1572882675599%22%2C%22ref%22%3A%22https%3A%2F%2Fbunearth.m.jd.com%2FbabelDiy%2FZeus%2F3xAU77DgiPoDvHdbXUZb95a7u71X%2Findex.html%22%2C%22psn%22%3A%221664140455%7C472%22%2C%22psq%22%3A5%2C%22pc_source%22%3A%22%22%2C%22mba_muid%22%3A%221664140455%22%2C%22mba_sid%22%3A%221572979455588510925986537476%22%2C%22std%22%3A%22MO-J2011-1%22%2C%22par%22%3A%22%22%2C%22event_id%22%3A%22Mnpm_ComponentApplied%22%2C%22mt_xid%22%3A%22%22%2C%22mt_subsite%22%3A%22%22%7D%2C%22SE%22%3A%7B%22mt_subsite%22%3A%22%22%2C%22__jdv%22%3A%22177095863%7Candroidapp%7Ct_335139774%7Cappshare%7CCopyURL%7C1572882675599%22%2C%22__jda%22%3A%22177095863.1664140455.1538579865.1572975960.1572979455.472%22%7D%7D&cu=true&utm_source=kong&utm_medium=tuiguang&utm_campaign=t_1001463991_&utm_term=936fcebc0e1749b487bfec5276789f95",
                });
                sleep(1000);
            }else{console.warn("请手动打开活动的小金人页面")}
            className("android.view.View").text("做任务领金币").waitFor();
            log("到达个人中心");
            sleep(1000);

            var x;
            var y;
            var count = 1;

            if (!textContains("点我得金币").exists()) {
                console.warn("请确保页面上存在小金人且有'点我得金币'等字样!!")
                textContains("点我得金币").waitFor();
            }
            var g = textContains("点我得金币").findOne();
            x = g.bounds().centerX();
            y = g.bounds().centerY();
            log("小金人位置获取成功!");

            while(count <= jd.goldTime){
                for(var i = 0;i<5;i++){
                    click(x,y);
                    sleep(200);
                }
                log("第" + count + "次任务已完成");
                sleep(random(121, 131) * speed);
                count ++;
            }
            log("小金人任务成功!");
            return
        });
    });

}



//红包
ui.tm618.click(function(){
app.openUrl("https://s.click.taobao.com/cFad0hv")
})

ui.jd618.click(function(){
app.openUrl("https://u.jd.com/wY9BNf")
})


//设置
ui.wza.click(function(){
   app.startActivity({
           action: "android.settings.ACCESSIBILITY_SETTINGS"
       });
})

ui.xfc.click(function(){
   threads.start(悬浮窗)
})

ui.tmhb.click(function(){
   threads.start(红包)
})

ui.jdhb.click(function(){
app.openUrl("https://u.jd.com/wY9BNf")
})

function 悬浮窗(){
   console.show();
}


function 红包(){
console.show();
log("脚本启动中……");
//打开主会场
app.startActivity({ 
  data: "taobao://s.click.taobao.com/cFad0hv",
});
log("如果开启了应用分身，需要选择对应的APP");
text("玩法规则").waitFor();
rsleep(1);
log("开始领取618红包");
var a=0
while(text("玩法规则").exists()){
    a++
    log("正在领取第"+a+"个红包");
    idContains("J_MM_RED_COVER_").findOne().click();
    rsleep(3);
    if(textContains("恭喜获得").exists()){
        idContains("J_MM_RED_").findOne().click();
        rsleep(2);
    }else{
       rsleep(2);
       if(textContains("恭喜获得").exists()){
           idContains("J_MM_RED_").findOne().click();
           rsleep(2);
           }else{
              rsleep(2);
              if(textContains("恭喜获得").exists()){
                  idContains("J_MM_RED_").findOne().click();
                  rsleep(2);
              }
              
         }
    }
    }
log("红包领取完毕");
//完成对话框
console.hide();
dialogs.build({
    title: "淘宝618任务自动脚本",
    content: "报告！红包领取完毕。",
    positive: "确定"
})
.show();

//随机延时
function rsleep(s) {
while (s--) {
sleep(random(900, 1200));
}
}

}


//启用按键监听
events.observeKey();
//监听音量上键按下
events.onKeyDown("volume_up", function (event) {
    threads.shutDownAll();
    console.clear();
    console.hide();
    toast("任务停止");
});