**1.store.js**

> ​	1.引入redux 中的createStore 函数，创建一个store
>
> ​	2。createStore 调用时要传入一个为其服务的reducer
>
> ​	3.记得暴露store 对象

**2.count_render.js**

> ​	1.reducer 的本质是一个函数，接收：preState，action，返回加工过后的状态
>
> ​	2.reducer 有两个作用：初始化状态，加工状态

**3.reducer 被第一次调用时，是store 自动触发的**

> ​			传递的preState 是undefined·，
>
> ​			传递的action 是：{type:'@@REDUX/INIT+随机数'}

**4。在index.js 中检测store 中的状态的改变，一旦发送改变重新渲染\<App/>**

**备注：reducex 只负责管理状态，至于状态的改变驱动着页面的展示，则需要我们自己写**



**创建store**

```js
import {createStore} from 'redux'
store=createStore(countReducer)
```

**发送通知**

```js
store.dispatch({ type: 'increment', data: value * 1 })
```

**接受reducer 传来的值**

```js
store.getState()
```

**App.js 文件**

```js
import Count from './compoments/Count/Count'

function App() {
  return (
    <div className="App">
      <Count/>
    </div>
  );
}

export default App;
```

**src/components/redux/store.js 文件**

```js
/* 
    该文件专门用于暴露一个store 对象，整个应用只有一个store 对象
*/

//引入createStore，专门用于创建redux 中最为核心的store 对象
import {createStore} from 'redux'
//引入为Count 组件服务的reducer
import countReducer from './count_rducer'

// const store=createStore(countReducer)
// export default store

//暴露store
export default createStore(countReducer)
```

**src/components/redux/count_reducer.js 文件**

```js
/* 
    1.该文件时用于创建一个为Count 组件服务的reducer，reducer 的本质就是一个函数
    2.reducer 函数会接受两个参数，分别为：之前的状态（preState），动作对象（action）
    reducer 只会负责加减，不负责其他的异步加载等杂乱事情，就像厨师一样，只负责做菜，
    不会去考虑是否加小料
*/

const initState=0       //初始化状态，等于if(preState===undefined) preState=0
export default  function countReducer(preState=initState,action){
    console.log(preState,action);
    // action 的type 属性为@@init+随机数字，防止与自定义的type 冲突
    //初始化时没有参数传进来
    // if(preState===undefined) preState=0
    //从action 对象中获取：type，data
    const {type,data}=action
    //根据type 决定如何技工数据
    switch (type) {
        case 'increment':   //如果是加
         return  preState+data
        case 'decrement':   //如果是减
         return  preState-data
    
        default:
            return preState
    }
}

```

**src/components/Count/Count.jsx 文件**

```js
import React, { Component } from 'react'
//引入store，用于获取redux 中保存的状态
import store from '../../redux/store'

export default class Count extends Component {
    state = { count: 0 }

    // 每个组件调用reducer 都要使用componentDidMount，不如放到index.js 文件里面
    // componentDidMount() {
    //     // 组件挂载后
    //     // 检测redux 中状态的变化，只要变化，就调用render
    //     //render 不能手动调用
    //     // store.subscribe(() => {
    //     //     console.log('redux 状态改变了');
    //     //     // this.render()
    //     //     this.setState({})
    //     // })
    // }
    // 加法
    increment = () => {
        const { value } = this.selectNumber
        // 通知redux  加value
        store.dispatch({ type: 'increment', data: value * 1 })
        // reduce 不会像state 一样，每次更新就会更新页面
    }
    //减法
    decrement = () => {
        const { value } = this.selectNumber
        // 通知redux  加value
        store.dispatch({ type: 'decrement', data: value * 1 })
    }
    // 奇数再加
    incrementIfOdd = () => {
        const { value } = this.selectNumber
        let count = store.getState()
        if (count % 2 !== 0) {
            store.dispatch({ type: 'increment', data: value * 1 })
        }

    }
    incrementAsync = () => {
        const { value } = this.selectNumber
        setTimeout(() => {
            store.dispatch({ type: 'increment', data: value * 1 })
        }, 500)

    }
    render() {
        return (
            <div>
                <h1>当前求和为：{store.getState()}</h1>
                <select ref={c => this.selectNumber = c} name="" id="">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
                {/* alt 键多选 */}
                <button onClick={this.increment}>+</button>
                <button onClick={this.decrement}>-</button>
                <button onClick={this.incrementIfOdd}>当前和为奇数再加</button>
                <button onClick={this.incrementAsync}>异步加</button>
            </div>
        )
    }
}

```

